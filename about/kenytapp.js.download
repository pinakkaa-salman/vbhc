"use strict";var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(a=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e});var B,D,F,_,U,H,W,z,V,q,G,j,K,Y,J,Z,Q,X,ee,te,ne,ae,oe,ie,re,o,l,se,le,de,h,ce,e,ue,p,t,pe,me,ge,fe,ve,he,ye,d,r,b,n,Ce,T,E,be,Te,m,Ee,Se,i,we,Ie,xe,Me,s,c,u,g={},v=13,y=27,C="_kenytUserId_",S="_kenytIsNewUserId_",ke="_kenytviewstate_",w="MessageHub",Le="_kenytsessionstate_",I=":",x={CONTACT_FORM:{Trigger:"Open Lead Form"},APPOINTMENT_FORM:{Trigger:"Open Appointment Form"},ADDRESS_FORM:{Trigger:"Open Address Form"},LATLONG_FORM:{Trigger:"Open GeoLocation Form"},FIREBASE_FORM:{Trigger:"Open Firebase Form"},FILE_UPLOAD:{Trigger:"Open Upload Form"},CALLER:{Trigger:"Open Caller"},OTP:{Trigger:"Open OTP Form"},GENERIC_FORM:{Trigger:"Open Generic Form"},NAVIGATE:{Trigger:"NavigateTo",Pattern:/^NavigateTo\s*:\s*\[.*\]\(.*\)$/i},SETTINGS_OVERRIDE:{Trigger:"UpdateUxSettings",Pattern:/^UpdateUxSettings\s*:\s*.*$/i},SET_LANGUAGE:{Trigger:"Set Language"},SET_SESSION:{Trigger:"Set Session"},NOTIFY_LEAD_CAPTURE:{Trigger:"Notify Lead Capture"},NOTIFY_TYPING:{Trigger:"Notify Typing"},OPEN_RAZORPAY_BUTTON:{Trigger:"Open Razorpay Button"},OPEN_CASHFREE_BUTTON:{Trigger:"Capture Cashfree Payment"},PRINT:{Trigger:"Print"},IMAGE_CAPTURE:{Trigger:"Capture Image"}},M="phone::",k="Intl Tel Input Plugin",L="../ChatbotUI/external/IntlTelInput/utils.js",A="_EMPTY_",N="en",P="kenytUnreadMessage",R=/(http|https):\/\/([\w_-]+(?:(?:\.[\w_-]+)+))([\w.,@?^=%&:/~+#-]*[\w@?^=%&/~+#-])?/i,O=/\[.*\]\(.*\)/,Ae=/[\d]{4,}/,Ne={TRACKING_ID:"UA-64989543-27",EVENT_INITIAL_LOAD:"initial_event",EVENT_DOCUMENT_READY:"document_ready",EVENT_COOKIES_DISABLED:"cookies_disabled",EVENT_LOAD_CHAT_REQUESTED:"load_chatbot_requested",EVENT_LOAD_CHAT_RECEIVED:"load_chatbot_received",EVENT_LOAD_CHAT_INTIME:"load_chatbot_intime",EVENT_VALID_BOT_ID:"valid_botid",EVENT_AUTO_MESSAGE_REQUESTED:"auto_message_requested",EVENT_AUTO_MESSAGE_SKIPPED:"auto_message_skipped",EVENT_AUTO_MESSAGE_RECEIVED:"auto_message_received",EVENT_FIRST_USER_REQUEST:"first_user_request",EVENT_INITIALIZE_CONNECTION:"initialize_connection",EVENT_FIRST_BOT_RESPONSE:"first_bot_response",EVENT_MESSAGE_SENT:"client_message_sent",EVENT_MESSAGE_RECEIVED:"client_message_received",EVENT_MESSAGE_DELAY:"reply_delay",EVENT_MESSAGE_UNSUCCESSFUl:"client_message_unsuccessful",EVENT_MESSAGE_ABANDONED:"client_message_abandoned",EVENT_MESSAGE_FAILED:"client_message_failed",EVENT_LOCATION_OBTAINED:"location_obtained",EVENT_LOCATION_DENIED:"location_denied",DISCONNECT_IDLE_USER:"disconnect_idle_user"},Pe=750,Re="/signalr",Oe="/api/botsetup/loadchatwindow",Be="",De="",Fe="/botapp",_e={PROD:"/dashboard",LOCAL:"http://localhost:4200"},Ue=5,He=3,We=1440,ze={TYPING_INDICATOR:"TypingIndicator",SENDER_DETAILS:"MessageSenderInfo",OTP_FORM:"OTPForm",PHONE_NUMBER_FORM:"PhoneNumberForm",SHOW_MORE_BUTTON:"ShowMoreButton",SMALL_BUTTON_CARD:"SmallButtonCard",MEDIUM_BUTTON_CARD:"MediumButtonCard",VISITING_CARD:"VisitingCard",VERTICAL_CARD:"VerticalCard",CARD_BUTTON:"CardButton",HEADER_MENU_ITEM:"HeaderMenuItem",FILE_CARD:"FileCard",LOCATION_CARD:"LocationCard",FOOTER_MENU:"FooterMenu",INTERACTIVE_CARD:"InteractiveList",INTERACTIVE_MENU_CARD:"ShowInteractiveMenuButton"},Ve="enable-on-bot-reply",qe=[{text:"Afrikaans",value:"af",displayText:"Afrikaans"},{text:"Albanian",value:"sq",displayText:"shqipe"},{text:"Amharic",value:"am"},{text:"Arabic",value:"ar",displayText:"العَرَبِيَّة"},{text:"Armenian",value:"hy",displayText:"Հայերեն"},{text:"Azerbaijani",value:"az",displayText:"azərbaycan dili"},{text:"Basque",value:"eu",displayText:"euskara"},{text:"Belarusian",value:"be",displayText:"беларуская мова"},{text:"Bengali",value:"bn",displayText:"বাংলা"},{text:"Bosnian",value:"bs",displayText:"Bosanski Jezik"},{text:"Bulgarian",value:"bg",displayText:"български език"},{text:"Catalan",value:"ca",displayText:"català"},{text:"Cebuano",value:"ceb",displayText:"Cebuano"},{text:"Chadic",value:"ha",displayText:"Harshen Hausa"},{text:"Chinese (Mandarin)",value:"zh-CN",displayText:"中文"},{text:"Chinese(Traditional)",value:"zh-TW"},{text:"Corsican",value:"co",displayText:"Espanol - CO"},{text:"Croatian",value:"hr",displayText:"Hrvatski Jezik"},{text:"Czech",value:"cs",displayText:"český jazyk"},{text:"Danish",value:"da",displayText:"Dansk"},{text:"Dutch",value:"nl",displayText:"Nederlands"},{text:"English",value:"en"},{text:"Esperanto",value:"eo",displayText:"Esperanto"},{text:"Estonian",value:"et",displayText:"Eesti"},{text:"Filipino",value:"fl",displayText:"Pilipino"},{text:"Finnish",value:"fi",displayText:"Suomi"},{text:"French",value:"fr",displayText:"Français"},{text:"Frisian",value:"fy"},{text:"Galician",value:"gl",displayText:"Galego"},{text:"Georgian ",value:"ka",displayText:"ქართული"},{text:"German",value:"de",displayText:"Deutsch"},{text:"Greek",value:"el",displayText:"ελληνικά"},{text:"Gujarati",value:"gu",displayText:"ગુજરાતી"},{text:"Haitian Creole",value:"ht",displayText:"Kreyol Ayisyen"},{text:"Hausa",value:"ha ",displayText:"هَوُسَ"},{text:"Hawaiian",value:"haw"},{text:"Hebrew",value:"he",displayText:"עברית"},{text:"Hindi",value:"hi",displayText:"हिन्दी"},{text:"Hmong",value:"hmn",displayText:"Hmong"},{text:"Hungarian",value:"hu",displayText:"magyar"},{text:"Icelandic",value:"is",displayText:"Islenka"},{text:"Igbo",value:"ig",displayText:"Ásụ̀sụ̀"},{text:"Indonesian",value:"id",displayText:"Indonesia"},{text:"Irish",value:"ga",displayText:"Gaeilge"},{text:"Italian",value:"it",displayText:"Italiano"},{text:"Japanese",value:"ja",displayText:"日本語"},{text:"Javanese",value:"jv",displayText:"Basa Jawa"},{text:"Javanese",value:"jw"},{text:"Kannada",value:"kn",displayText:"ಕನ್ನಡ"},{text:"Kazakh",value:"kk",displayText:"қазақ тілі"},{text:"Khmer",value:"km    ",displayText:"ខ្មែរ,"},{text:"Korean",value:"ko",displayText:"한국어"},{text:"Kurdish",value:"ku"},{text:"Kyrgyz",value:"ky"},{text:"Lao",value:"lo",displayText:"ພາສາລາວ"},{text:"Latin",value:"la",displayText:"Latine"},{text:"Latvian",value:"lv",displayText:"latviešu valoda"},{text:"Lithuanian",value:"lt",displayText:"lietuvių kalba"},{text:"Luxembourgish",value:"lb"},{text:"Macedonian",value:"mk",displayText:"македонски јазик"},{text:"Malagasy",value:"mg",displayText:"Malagasy"},{text:"Malay",value:"ms",displayText:"Bahasa Melayu"},{text:"Malayalam",value:"ml",displayText:"മലയാളം"},{text:"Maltese",value:"mt",displayText:"Malti"},{text:"Maori",value:"mi",displayText:"Māori"},{text:"Marathi",value:"mr",displayText:"मराठी"},{text:"Mongolian",value:"mn",displayText:"монгол"},{text:"Myanmar(Burmese)",value:"my"},{text:"Nepali",value:"ne",displayText:"नेपाली"},{text:"Norwegian",value:"no",displayText:"Norsk"},{text:"Nyanja",value:"ny",displayText:"Chichewa"},{text:"Odia",value:"or",displayText:"ଓଡିଆ"},{text:"Pashto",value:"ps"},{text:"Persian",value:"fa"},{text:"Polish",value:"pl",displayText:"Polski"},{text:"Portuguese(Portugal, Brazil)",value:"pt",displayText:"Português"},{text:"Punjabi",value:"pa",displayText:"ਪੰਜਾਬੀ"},{text:"Romanian",value:"ro",displayText:"limba română "},{text:"Russian",value:"ru",displayText:"русский язык"},{text:"Samoan",value:"sm"},{text:"Scots Gaelic",value:"gd",displayText:"Gàidhlig na h-Alba"},{text:"Serbian",value:"sr",displayText:"српски језик"},{text:"Shona",value:"sn"},{text:"Sindhi",value:"sd"},{text:"Sinhala(Sinhalese)",value:"si",displayText:"සිංහල"},{text:"Slovak",value:"sk",displayText:"slovenčina"},{text:"Slovenian",value:"sl",displayText:"Slovenski Jezik"},{text:"Somali",value:"so",displayText:"Soomaali"},{text:"Spanish",value:"es",displayText:"Español"},{text:"Southern Sotho",value:"st",displayText:"Sesotho"},{text:"Sundanese",value:"su",displayText:"Basa Sunda"},{text:"Swahili",value:"sw",displayText:"Kiswahili"},{text:"Swedish",value:"sv",displayText:"Sverige"},{text:"Tagalog(Filipino)",value:"tl"},{text:"Tajik",value:"tg",displayText:"тоҷикӣ"},{text:"Tamil",value:"ta",displayText:"தமிழ்"},{text:"Telugu",value:"te",displayText:"తెలుగు"},{text:"Thai",value:"th",displayText:"ไทย"},{text:"Turkish",value:"tr",displayText:"Türkçe"},{text:"Ukrainian",value:"uk",displayText:"українська мова"},{text:"Urdu",value:"ur",displayText:"اُردُو"},{text:"Uzbek",value:"uz",displayText:"Oʻzbek"},{text:"Vietnamese",value:"vi",displayText:"Tiếng Việt"},{text:"Welsh",value:"cy"},{text:"Xhosa",value:"xh"},{text:"Yiddish",value:"yi",displayText:"ייִדיש"},{text:"Yoruba",value:"yo",displayText:"Ede Yorùbá"},{text:"Zulu",value:"zu",displayText:"isiZulu"}],Ge={EMAIL_VALIIDATION_PATTERN:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,PHONE_VALIDATION_SOURCE:k,URL_VALIIDATION_PATTERN:/^(http[s]?:\/\/)?(www\.)?(\w)+\.(\w)+([\/.][\w-#]*)*$/},je=detectAppName(),Ke=je+Re,$e=je+Oe,Ye=je+"/api/file/upload",Je=je+"/api/file/proxy",Ze=je+"/api/tracking/ingestevents",Qe=je+"/api/tracking/ping",Xe=je+"/api/genericbot/<botId>/updatefcmtoken",et={None:0,Thumbnail:1,Hero:2,Image:3,Gif:4,Video:5,QuickLink:6,SmallButton:7,MediumButton:8,VisitingCard:9,VerticalCard:10,Location:11,File:12,FooterMenu:13,InteractiveList:101},tt=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHF","CLP","CNY","COP","CRC","CUP","CVF","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ESK","ETB","EUR","FJD","FKP","GBP","GEL","GGP","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRO","MRU","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","SSP","STN","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VEF","VND","VUV","WST","XAF","XAG","XAU","XCD","XDR","XOF","XPF","YER","ZAR","ZMK","ZMW","ZWD"],nt={UserMessage:1,AutoMessage:2,ManualMessage:3},at={SetCustomContext:"kenytSetCustomContext",UnreadMessage:"kenytUnreadMessage",ChatWindowClose:"kenytChatWindowClose",ChatWindowBack:"kenytChatWindowBack",ChatWindowOpen:"kenytChatWindowOpen",FullScreenImage:"kenytFullScreenImage",NavigateToPage:"kenytNavigateToPage",ToggleFullScreen:"kenytToggleFullscreen",ForceFullHeight:"kenytForceFullHeight",TextColor:"kenytTextColor",IsWindowMinimizedResponse:"kenytIsWindowMinimizedResponse",WindowHover:"kenytWindowHover",GetPageTitle:"kenytPageTitle",GetReferrer:"kenytPageReferrer",Initialize:"kenytInitialize",FirebaseToken:"kenytFirebaseToken",PageInfoRequest:"kenytPageInfoRequest",PageInfoResponse:"kenytPageInfoResponse",CustomEventDispatch:"kenytCustomEventDispatch",SettingsUpdate:"kenytSettingsUpdate",UpdateChatBubbleColor:"kenytUpdateChatBubbleColor",UpdateAttentionMessage:"kenytUpdateAttentionMessage",UpdateBotPosition:"kenytUpdateBotPosition",MediaStreamingCommand:"kenytMediaStreamingCommand",SendMessage:"kenytSendMessage",ReportGoogleAnalyticsEvent:"reportGoogleAnalyticsEvent",OpenRazorpayForm:"kenytOpenRazorpayForm",SubmitRazorpayPayment:"kenytSubmitRazorpayPayment",FormSubmission:"kenytFormSubmission",OpenCashfreeForm:"kenytOpenCashfreeForm",SubmitCashfreePayment:"kenytSubmitCashfreePayment",UserGeneratedEvent:"user_generated_event",UpdateSssionPing:"update_session_ping"},ot={Load:"kenyt_Load",ChatStart:"kenyt_ChatStart",ContactFormSubmit:"kenyt_ContactFormSubmit",GenericFormSubmit:"kenyt_GenericFormSubmit",UserMessage:"kenyt_UserMessage",UserQueryResponse:"kenyt_UserQueryResponse",ChatWindowClose:"Kenyt_ChatWindowClose",ChatWindowBack:"Kenyt_ChatWindowBack",BotMessage:"Kenyt_BotMessage"},it={Form:"Form"},rt={show:!0,name:"Kenyt.AI",website:"https://www.kenyt.ai"},st={SessionCount:1,ManualModeAtStart:!1},lt=!1,dt={},ct={},ut=!0,pt={},mt=!1,gt={pageStartAt:null,isSkipped:!0,isSent:!1,isSentAck:!1,isReceived:!1,sentAt:null,receivedAt:null},ft={FrameColor:"",FrameColorGradient:"",BubbleBackgroundColor:"",HeaderTitle:"Automated Live Chat",HeaderSubTitle:"Online",EnableSpeech:"False",EnableQRFeature:"False",ManualModeAtStart:"False",HeaderFontSize:"",HeaderTextColor:"#ffffff",FontSize:"",FontFamily:"",UserChatBubbleColor:"",UserChatBubbleColorGradient:"",BotChatBubbleColor:"#ffffff",PlaceholderText:"Type your message...",ShowPoweredBy:"True",PoweredBy:{},BotTextColor:"#000",UserTextColor:"#000",BackgroundImage:"",BackgroundColor:"",CustomPanelCss:"",HeaderImage:"/api/botsetup/getimage?imagetype=chatbubble-icon&botid=",HeaderShowOnline:"False",DesktopMinimizeBotAtStart:"True",MobileMinimizeBotAtStart:"True",OpenWindowAfterMilliSeconds:"0",Languages:"",UserPersona:"you",BotPersona:"chatbot",AttentionMessage:"",LiveAgentCall:"False",HideMenuInHeader:"False",IdleTimeoutSeconds:0,WindowStyle:"style1",Announcement:"",EnableAgentChatFeedback:"False"},vt={adaptiveHeight:!0,dots:!1,mobileFirst:!0,arrows:!0,autoplay:!0,autoplaySpeed:5e3,rtl:!1},ht=[],yt={},Ct={headerMenu:{container:null,content:null},footerMenu:{container:null,content:null}},bt=[],Tt=!1,Et=!0,St=1,wt=1,It=!1,xt=!1,Mt=!1,kt={senderDetailsView:null,indicatorView:null},Lt={"See Details":"See Details",Submit:"Submit","None of the above":"None of the above","Contact Information":"Contact Information","Please enter your contact details":"Please enter your contact details",Name:"Name",Email:"Email",Phone:"Phone",Mobile:"Mobile"},At={},Nt={},Pt="style1";function updateButtonTexts(e){if(e)for(var t in e)Nt[t]=e[t]}updateButtonTexts(Lt);var Rt,Ot,Bt,Dt,Ft={audio:!0},_t=null,Ut={},Ht=null,Wt={lastFocusedAt:null,idleTimeSec:0,isActiveSignalSent:!1,stopTimingTimeOut:null},zt=!1;function capitalizeKeys(e){if(null===e||"object"!==(void 0===e?"undefined":a(e)))return e;var t=Array.isArray(e)?[]:{};for(var n in e){if(e.hasOwnProperty(n))t[n.charAt(0).toUpperCase()+n.slice(1)]=capitalizeKeys(e[n])}return t}window.dataLayer=window.dataLayer||[],initializeGoogleAnalytics();var Vt=!(window.KENYT_API={currentForm:null,onFormInputChange:null});function notifyParentKenytLoad(){gtag("event",Ne.EVENT_DOCUMENT_READY);var e=new URLSearchParams(window.location.search),t=e.get("setuserdataforbot"),P=e.get("enablePortal"),R="true"===e.get("hideChatHistory"),O="null"===e.get("kenytStartIntent")?null:e.get("kenytStartIntent");notifyParentAndListenCallback(at.CustomEventDispatch,{EventName:ot.Load,EventData:{botId:ce}},t,function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,i=O;if(o&&(fe||(fe={}),o.name&&(fe.name=o.name),o.mobile&&(fe.mobile=o.mobile),o.email&&(fe.email=o.email),o.hasOwnProperty("selectedConversationId")&&null!==o.selectedConversationId&&(de=null)),St=1,B=document.querySelector("#chatWindow"),D=document.querySelector("#chatWindowHeader"),F=document.querySelector("#headerIconContainer"),_=document.querySelector("#headerImage"),U=document.querySelector("#headerOnlineIcon"),H=document.querySelector("#headerTitle"),W=document.querySelector("#headerSubTitle"),z=document.querySelector("#chatWindowBody"),q=document.querySelector("#chatInput"),G=document.querySelector("#chatActions"),j=document.querySelector("#sendButton"),K=document.querySelector("#speechButton"),Y=document.querySelector("#cameraButton"),J=document.querySelector("#cameraOverlay"),Z=document.querySelector("#callButton"),be=document.querySelector("#announcement"),Ct.headerMenu.container=document.querySelector("#menuContainer"),Ct.footerMenu.container=document.querySelector("#footer-menu"),Ct.footerMenu.optionsContainer=document.querySelector("#footer-menu-options"),Ct.footerMenu.menuline=document.querySelector(".menu-line"),Ct.footerMenu.hidden=!0,Ct.footerMenu.container.addEventListener("click",function(){if(Ct.footerMenu.container.classList.contains("footer-minimized"))renderInteractiveMenu(Ct.footerMenu.contentElement),Ct.footerMenu.menuline.style.display="none";else{if(Ct.footerMenu.container.classList.remove("open"),Ct.footerMenu.container.classList.add("footer-minimized"),B.classList.remove("footer-menu"),Ct.footerMenu.isOpen=!1,Ct.footerMenu.referenceElement){var e=Ct.footerMenu.optionsContainer.getElementsByClassName("interactive-menu-options");e&&0<e.length&&((e=e[0]).classList.add("d-none"),Ct.footerMenu.referenceElement.appendChild(e))}Ct.footerMenu.hidden&&Ct.footerMenu.container.classList.add("footer-hidden"),Ct.footerMenu.menuline.style.display="block"}}),Ct.footerMenu.closeElement=document.querySelector("#footer-menu-closed"),Ct.footerMenu.contentElement=document.querySelector("#footer-menu-content"),Q=document.querySelector("#languageButton"),V=document.querySelector("#messageContainer"),X=document.querySelector("#poweredByText"),ee=X.children[0],te=document.querySelector("#chatWindowFooter"),ne=document.querySelector("#headerMaximizeMinimizeButton"),ae=document.querySelector("#additionalOptions"),oe=document.querySelector("#headerCloseButton"),ie=document.querySelector("#headerBackButton"),Ce=document.querySelector("#stopSpeech"),Te=document.querySelector("#announcementCloseButton"),re={},chatwindowHeaderTitleFix(),"true"!==P&&ie.classList.add("k-hide"),me=getParentUrl(),ce=getUrlParam("botid"),pe="1"===getUrlParam("test")||0<ce.indexOf("-test"),ue=getUrlParam("userid",me),ve=getUrlParam("hash"),ft.HeaderImage.includes("botid=")){var e=ft.HeaderImage.split("botid=")[1];e&&""!==e.trim()||(ft.HeaderImage=(isLocalEnvironment()?"":"/botapp")+ft.HeaderImage+ce)}ft.backgroundImage&&(ft.BackgroundImage=(isLocalEnvironment()?"":"/botapp")+ft.BackgroundImage+ce),Me=!1,ye=ke+ce+"_"+ve,he=Le+ce+"_"+ve,we=[],o&&o.hasOwnProperty("conversationMessages")&&null!==o.conversationMessages&&(o.conversationMessages=o.conversationMessages.map(function(e){return e.message&&(e.message=capitalizeKeys(e.message)),e}),we=o.conversationMessages),xe=testLocalStorage(),disableLoggingIfProduction(xt=isLocalEnvironment()),xe||isLocalEnvironment()||gtag("event",Ne.EVENT_COOKIES_DISABLED,eventData("browser_info")),restoreUserIdIfExists();var t=retrieveLocalStateIfExists();st=t&&t.botUserWebContext?t.botUserWebContext:st,yt.previousStateLoaded=!1,t?o&&(o.hasOwnProperty("conversationMessages")&&null!==o.conversationMessages||o.hasOwnProperty("selectedConversationId")&&null!==o.selectedConversationId)?""!==o.conversationMessages&&(t.messages=o.conversationMessages,restoreState(t,R)):(console.debug("Found previous state, restoring.."),restoreState(t,R)):(we=[],console.debug("No previous state found")),yt.previousStateLoaded=!0;var n=retrieveSessionStateIfExists();n?(console.debug("Found previous session state, restoring..."),restoreSessionState(n),Et=!1,n.queryUserDenied&&(ue=null)):console.debug("No previous session state found");var a=!1,r=!1;if(we&&0!=we.length){if(we.forEach(function(e){e.isUserMessage&&(Me=!0)}),Me?r=!(a=!1):(r=!(a=!0),clearChat()),me&&!me.includes("?")&&n){var s=n.pageUrl,l=s.indexOf("?");0<l&&(me+=s.substring(l))}}else r=!(a=!0);var d=$e+"?botId="+ce;if(!ge){ge={};var c=(y=new URL(window.location.href)).searchParams.keys(),u=!0,p=!1,m=void 0;try{for(var g,f=c[Symbol.iterator]();!(u=(g=f.next()).done);u=!0){var v=g.value,h=v;h.startsWith("context-")&&(h=h.substring(8),ge[h]=y.searchParams.get(v))}}catch(e){p=!0,m=e}finally{try{!u&&f.return&&f.return()}finally{if(p)throw m}}}if(!fe){fe={};var y,C=(y=new URL(window.location.href)).searchParams.keys(),b=!0,T=!1,E=void 0;try{for(var S,w=C[Symbol.iterator]();!(b=(S=w.next()).done);b=!0){var I=S.value,x=I;x.startsWith("user-")&&(x=x.substring(5),fe[x]=y.searchParams.get(I))}}catch(e){T=!0,E=e}finally{try{!b&&w.return&&w.return()}finally{if(T)throw E}}}null!=i&&(a=!1);var M={IsTest:pe,SessionUserId:se,IsNewSessionUserId:le,QueryClientUserId:ue,ConversationId:de,ConversationLanguage:Ie||"",TimezoneOffsetMinutes:-1*(new Date).getTimezoneOffset(),SourceUrl:me,TriggerAutoMessage:a,InitializeConnection:r,ConversationContext:ge,User:fe};o&&o.hasOwnProperty("selectedConversationId")&&(""===(de=o.selectedConversationId.split("_").pop())&&(de=null),M={IsTest:pe,SessionUserId:se,IsNewSessionUserId:!1,QueryClientUserId:ue,ConversationId:de,ConversationLanguage:Ie||"",TimezoneOffsetMinutes:-1*(new Date).getTimezoneOffset(),SourceUrl:me,TriggerAutoMessage:null===de,InitializeConnection:r,ConversationContext:ge,User:fe});var k,L,A,N=JSON.stringify(M);!function loadConfigWithRetry(n){1===n&&(gtag("event",Ne.EVENT_LOAD_CHAT_REQUESTED),Ut.requestedAt=new Date,document.getElementById("chatLoader").style.display="flex");var a=new XMLHttpRequest;a.open("POST",d,!0),a.setRequestHeader("Content-type","application/json"),a.onload=function(e){var t=a.status;200<=t&&t<300?(document.getElementById("chatLoader").style.display="none",o&&o.hasOwnProperty("userData")&&o.userData?handleLoadChatWindowResponse(e,o.userData):handleLoadChatWindowResponse(e),i&&sendMessageToServer(i,i)):n<3?setTimeout(function(){loadConfigWithRetry(n+1)},1e3):document.getElementById("chatLoader").style.display="none"},a.onerror=function(){n<3?setTimeout(function(){loadConfigWithRetry(n+1)},1e3):document.getElementById("chatLoader").style.display="none"},a.send(N)}(1),gtag("event",a?Ne.EVENT_AUTO_MESSAGE_REQUESTED:Ne.EVENT_AUTO_MESSAGE_SKIPPED),(window.hasOwnProperty("webkitSpeechRecognition")||window.hasOwnProperty("SpeechRecognition"))&&((Ee=new(window.webkitSpeechRecognition||window.SpeechRecognition)).lang="en-IN",Ee.onerror=function(e){"no-speech"===e.error?console.warn("No speech detected"):(trackError({message:"Speech recognition error: "+e},!1),console.warn(e))},Ee.onstart=function(e){setInputPlaceholderText("Listening... say something"),K.classList.add("blink")},Ee.onend=function(e){setInputPlaceholderText(re.PlaceholderText||ft.PlaceholderText),K.classList.remove("blink")},Ee.onnomatch=function(e){console.warn("Failed to recognize speech")},Ee.onresult=function(e){var t=e.results[0][0].transcript;isNonEmptyString(t)&&(It=!0,sendMessageToServer(t,t))},window.speechSynthesis&&(window.speechSynthesis.onerror=function(e){console.error("Error in speech synthesis"),console.error(e),trackError({message:"Text to speech error: "+e},!1)})),window.navigator&&(window.navigator.browserInfo=(L=navigator.userAgent,A=L.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(A[1])?"IE "+((k=/\brv[ :]+(\d+)/g.exec(L)||[])[1]||""):"Chrome"===A[1]&&null!=(k=L.match(/\b(OPR|Edge)\/(\d+)/))?k.slice(1).join(" ").replace("OPR","Opera"):(A=A[2]?[A[1],A[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(k=L.match(/version\/(\d+)/i))&&A.splice(1,1,k[1]),A.join(" ")))),registerEventListeners(),Se={isInitializing:!1,isConnected:!1,tryingToReconnect:!1},isMobileDevice()&&showElements(ne)})}function handleInput(){sendTypingResponse()}$(document).ready(function(){var e=new URLSearchParams(window.location.search);Vt="true"===e.get("enableMessageFeedback"),"false"===e.get("enablePortal")&&notifyParentKenytLoad()});var qt=!1,Gt=null;function sendTypingResponse(){var e={BotClientId:T?T.BotId:0,ConversationId:de,UserId:se,IsTyping:"true",Description:document.getElementById("chatInput").value};Se&&Se.isConnected?(qt||l.invoke("UserTypingIndicator",e),Gt&&clearTimeout(Gt),Gt=setTimeout(function(){return stopTypingResponse(e)},3e3)):initializeServerConnection()}function stopTypingResponse(e){qt=!1,e.IsTyping=!1,Se&&Se.isConnected?l.invoke("UserTypingIndicator",e):initializeServerConnection()}function handleLoadChatWindowResponse(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;gtag("event",Ne.EVENT_LOAD_CHAT_RECEIVED),Ut.receivedAt=new Date;var n=!1;try{var a=JSON.parse(e.target.response);if(a){if(pe=a.IsTest,a.OrgBot&&(T=a.OrgBot,gtag("event",Ne.EVENT_VALID_BOT_ID)),a.ConversationId&&handleConversationId(a.ConversationId),a.Response&&(handleBotResponse(a.Response),gtag("event",Ne.EVENT_AUTO_MESSAGE_RECEIVED)),a.InitializeConnection&&(n=!0),applyWindowStyling(ft),a.WindowConfiguration&&(a.WindowConfiguration.Properties&&(applyWindowStyling(re=extractWindowConfig(a.WindowConfiguration.Properties)),At.HeaderTitle=re.HeaderTitle||ft.HeaderTitle,At.HeaderSubTitle=re.HeaderSubTitle||ft.HeaderSubTitle,h=re.EnableAgentChatFeedback),a.WindowConfiguration.Javascript&&a.WindowConfiguration.Javascript.forEach(function(e){var t=document.createElement("script");t.setAttribute("src",e),t.type="text/javascript",document.head.appendChild(t)})),a.QueryUserDetails){var o=document.createElement("div"),i=document.createElement("p");if(i.innerText="Would you like to continue as",o.appendChild(i),a.QueryUserDetails.MaskedEmail){var r=document.createElement("p");r.innerText=a.QueryUserDetails.MaskedEmail,o.appendChild(r)}if(a.QueryUserDetails.MaskedPhone){var s=document.createElement("p");s.innerText=a.QueryUserDetails.MaskedPhone,o.appendChild(s)}var l=document.createElement("div");l.classList.add("card-thumbnail","text-center","mt-1"),o.appendChild(l);var d=document.createElement("div");d.classList.add("option-pill","pointer"),d.innerText="Yes",l.appendChild(d);var c=document.createElement("div");c.classList.add("option-pill","pointer"),c.innerText="No",l.appendChild(c),d.addEventListener("click",function(e){a&&a.QueryUserId&&handleUserId(a.QueryUserId),window.setTimeout(function(){sendMessageToServer("",null,!0,!0)},0),d.disabled=!0,c.disabled=!0}),c.addEventListener("click",function(e){p=!0,a&&a.SessionUserId&&handleUserId(a.SessionUserId),window.setTimeout(function(){sendMessageToServer("",null,!0,!0)},0),d.disabled=!0,c.disabled=!0});var u=createBotChatBubble();u.classList.add("w-95"),u.appendChild(o),addToChatWindow(u)}else a.SessionUserId&&handleUserId(a.SessionUserId,a.IsNewSessionUserId);a.LanguageSettings&&handleLanguageSettings(a.LanguageSettings)}}catch(e){e.message="load chatbot error:: "+(e&&e.message||""),trackError(e)}(n&&initializeServerConnection(),Ut.requestedAt&&Ut.receivedAt)&&((Ut.receivedAt.valueOf()-Ut.requestedAt.valueOf())/1e3<He&&gtag("event",Ne.EVENT_LOAD_CHAT_INTIME));(z.classList.remove("d-none"),re.Announcement&&showAnnouncement(),t)&&sendMessageToServer(Object.entries(t).map(function(e){var t=f(e,2);return t[0]+"::"+t[1]}).join(", "),null,!1,!1,!1,void 0,void 0,void 0)}function requestGeoLocation(){window.navigator.geolocation&&window.navigator.geolocation.getCurrentPosition(function(e){u=e.coords,gtag("event",Ne.EVENT_LOCATION_OBTAINED),sendMessageToServer("Coordinates::"+e.coords.latitude+" "+e.coords.longitude)},function(e){sendMessageToServer("Coordinates denied by user"),console.warn("[Kenyt.AI] Location permission denied"),gtag("event",Ne.EVENT_LOCATION_DENIED)},{enableHighAccuracy:!0})}function requestFirebaseNotification(){notifyParent(at.FirebaseToken)}function getUrlParam(e,t){return t=t||window.location.href,new URL(t).searchParams.get(e)}function gtag(){window.dataLayer.push(arguments)}function trackError(e,t){var n=e&&e.lineno||"0",a=e&&e.colno||"0",o="["+(e&&e.filename||"unknown-file")+":"+n+":"+a+"] "+(e&&e.message||"null");isLocalEnvironment()||gtag("event","exception",{description:o,fatal:t||!1})}function initializeGoogleAnalytics(){var e=getUrlParam("botid");isLocalEnvironment()&&(window["ga-disable-"+Ne.TRACKING_ID]=!0),gtag("js",new Date);var t=getUrlParam("googleAnalyticsId");t||(t=Ne.TRACKING_ID),gtag("config",t,{custom_map:{dimension1:"botClientId"}}),e&&gtag("event",Ne.EVENT_INITIAL_LOAD,{botClientId:e}),window.addEventListener("error",function(e){trackError(e,!1)})}function initializeServerConnection(){if(Se&&!Se.isInitializing){Se.isInitializing=!0,notifyConnectionIssues("Initializing connection");(o=$.hubConnection(Ke)).qs="botid="+ce,isLocalEnvironment()&&(o.logging=!0),o.connectionSlow(function(){console.warn("[Kenyt.AI] Connection is slow, may get disconnected"),gtag("event","connection_slow",eventData("connection"))}),o.reconnecting(function(){Se.tryingToReconnect=!0,Se.isConnected=!1,Se.reason="Reconnecting",notifyConnectionIssues("Reconnecting..."),console.warn("[Kenyt.AI] Lost connection to server, trying to reconnect..."+new Date),gtag("event","connection_lost",eventData("connection"))}),o.reconnected(function(){Se.tryingToReconnect=!1,Se.isConnected=!0,notifyConnectionIssues(Se.reason="Reconnected"),clearConnectionIssues(),console.warn("[Kenyt.AI] Reconnected to server..."+new Date),gtag("event","reconnected",eventData("connection")),sendSuspendedMessagesIfAny()}),(l=o.createHubProxy(w)).on("MessageReceived",handleMessageReceived),l.on("BotReply",handleBotResponse),l.on("ManualReply",handleManualReply),l.on("Error",handleError),l.on("NotifyAgentJoin",handleAgentJoin),l.on("NotifyAgentExit",handleAgentExit),l.on("NotifyWebRtcSignal",relayWebRtcSignalToParent),l.on("ChangeLanguage",handleLanguageSettings),l.on("RestartChat",restartSession),startConnection(onSuccessfulServerConnection,onFailedServerConnection,!1),o.disconnected(function(){if(o.lastError){var e=new Date;console.log("Disconnected at "+e),console.log("Disconnected. Reason: "+o.lastError.message);var t=void 0;t=Se.tryingToReconnect?"Disconnected after reconnecting failed;":"Disconnected without reconnecting;",t=o.lastError.message||t,console.error("[Kenyt.AI] "+t),Se.isConnected=!1,Se.tryingToReconnect=!1,Se.reason="disconnected",clearConnectionIssues(),Me&&(notifyConnectionIssues("Connection disconnected, Reconnecting in 5 secs..."),window.setTimeout(function(){initializeServerConnection()},5e3),t="(Reconnecting) "+t),trackError({message:"Connection Disconnected: "+t},!0)}})}}function startConnection(e,t,n){n?(gtag("event","forced_longpolling"),o.start({transport:"longPolling"}).done(e).fail(t)):o.start().done(e).fail(t)}function registerEventListeners(){q.addEventListener("keydown",handleKeyDown),q.addEventListener("input",handleInput),q.addEventListener("focus",function(){var e=ne.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen(),scrollToEnd(z)});var e=document.getElementById("chatWindowHeader");e&&e.addEventListener("click",function(){var e=ne.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen()});var t=document.getElementById("chatWindowBody");t&&t.addEventListener("click",function(){var e=ne.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen()}),Q&&Q.addEventListener("focus",function(){var e=ne.getAttribute("data-toggle");isMobileDevice()&&"maximize"===e&&toggleFullScreen()}),j.addEventListener("click",handleSendButton),K.addEventListener("click",handleSpeechButton),Z&&Z.addEventListener("click",function(e){handleCallButton()}),ne.addEventListener("click",function(e){e.stopPropagation(),updateLastActivity();var t=ne.getAttribute("data-toggle");toggleFullScreen(),gtag("event","Button_Minimize_Maximize",eventData("user_interaction",null,t))});var a=null,n=0,o=[],i=null,r=document.getElementById("cameraContainer"),s=document.getElementById("capturedImageContainer"),l=document.getElementById("videoElement"),d=document.getElementById("canvasElement"),c=document.getElementById("capturedImage"),u=document.getElementById("statusMessage");function showStatus(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2e3;u.textContent=e,u.style.display="block",setTimeout(function(){u.style.display="none"},t)}function startCamera(e){a&&a.getTracks().forEach(function(e){return e.stop()});var t={video:{deviceId:e?{exact:e}:void 0,width:{ideal:1920},height:{ideal:1080}}};return navigator.mediaDevices.getUserMedia(t).then(function(e){a=e,l.srcObject=a,document.getElementById("switchCameraBtn").style.display=1<o.length?"block":"none"}).catch(function(e){throw new Error("Unable to start camera: "+e.message)})}function closeCamera(){resetCameraOverlayAsFormCssOveride(),J.style.display="none",a&&(a.getTracks().forEach(function(e){return e.stop()}),a=null),i=null}Y.addEventListener("click",function(){J.style.display="flex",r.style.display="flex",s.style.display="none",showStatus("Initializing camera...",1e3),navigator.mediaDevices.enumerateDevices().then(function(e){if(0===(o=e.filter(function(e){return"videoinput"===e.kind})).length)throw new Error("No camera found");var t=o.findIndex(function(e){return e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("environment")});return startCamera(o[n=-1!==t?t:0].deviceId)}).catch(function(e){throw e}).then(function(){}).catch(function(e){console.error("Camera error:",e),showStatus("Failed to access camera",3e3),setTimeout(closeCamera,3e3)})}),document.getElementById("captureBtn").addEventListener("click",function(){if(a){var e=d,t=l,n=e.getContext("2d");e.width=t.videoWidth,e.height=t.videoHeight,n.drawImage(t,0,0,e.width,e.height),i=e.toDataURL("image/png"),c.src=i,r.style.display="none",s.style.display="flex",a&&(a.getTracks().forEach(function(e){return e.stop()}),a=null),showStatus("Image captured!",1500)}}),document.getElementById("sendBtn").addEventListener("click",function(){if(i)try{var e=function(e){var t=e.width/e.height,n=Math.round(320/t);console.log("Original dimensions: "+e.width+"x"+e.height),console.log("Resized dimensions: 320x"+n);var a=document.createElement("canvas");a.width=320,a.height=n,a.getContext("2d").drawImage(e,0,0,320,n);var o=a.toDataURL("image/jpeg",.7);return o.length<1e4&&console.warn("Captured image seems to be blank or very small"),o}(d);addToChatWindow(createUserChatBubble("","",!1,e)),we.push({id:St++,isUserMessage:!0,message:"",displayMessage:"",messageTimestamp:getCurrentTimeString(),imageData:e});var t=e.match(/^data:(image\/[a-zA-Z0-9.+-]+);base64,(.+)$/);if(!t)return void alert("Invalid image data");var n=t[1],a=t[2];sendMessageToServer("iamge sent","",!1,!1,!1,{FileName:"captured_image_"+Date.now()+".png",MimeType:n,Base64Format:a},"File"),showStatus("Image sent successfully!",2e3),setTimeout(closeCamera,2e3)}catch(e){console.error("Error sending image:",e),showStatus("Error sending image",2e3)}}),document.getElementById("retakeBtn").addEventListener("click",function(){i=null,s.style.display="none",r.style.display="flex",startCamera(o[n].deviceId).then(function(){}).catch(function(e){console.error("Error restarting camera:",e),showStatus("Error restarting camera",2e3)})}),document.getElementById("closeCameraBtn").addEventListener("click",function(){closeCamera()}),document.getElementById("switchCameraBtn").addEventListener("click",function(){o.length<=1||(n=(n+1)%o.length,startCamera(o[n].deviceId).then(function(){showStatus("Camera switched",1500)}).catch(function(e){console.error("Error switching camera:",e),showStatus("Error switching camera",2e3)}))}),oe.addEventListener("click",function(e){e.stopPropagation(),hideChatWindow()}),ie.addEventListener("click",goBackFromChatWindow),be.addEventListener("mouseover",function(){m&&clearTimeout(m)}),be.addEventListener("mouseleave",function(){setAnnouncementTimeout()}),Te.addEventListener("click",function(){return toggleAnnouncementVisibility(!1)}),window.addEventListener("beforeunload",handleWindowClose),W.addEventListener("click",hideChatWindow),H.addEventListener("click",hideChatWindow),_.parentElement.addEventListener("click",hideChatWindow),document.addEventListener("keydown",function(e){var t=void 0;"key"in e?"Escape"!==e.key&&"Esc"!==e.key||(t=!0):t=e.keyCode===y,t&&hideChatWindow(),updateLastActivity()}),document.addEventListener("click",function(e){updateLastActivity()}),window.addEventListener("message",function(e){if(e.data&&"[object Object]"===Object.prototype.toString.call(e.data)&&e.data.type){var t=e.data;if("openWhatsAppWindow"===t.type)return t.channelDetails&&(Qt=t.channelDetails),void createWhatsAppWindow();if("closeWhatsAppWindow"===t.type)return void closeWhatsAppWindowInFrame();if("openEmailWindow"===t.type)return t.channelDetails&&(en=t.channelDetails),void createEmailWindow();if("closeEmailWindow"===t.type)return void closeEmailWindowInFrame();if("openPhoneWindow"===t.type)return t.channelDetails&&(nn=t.channelDetails),void createPhoneWindow();if("closePhoneWindow"===t.type)return void closePhoneWindowInFrame();if(t.type===at.IsWindowMinimizedResponse){if(!t.value)"minimize"===ne.getAttribute("data-toggle")&&toggleFullScreen();ut=t.value,saveStateLocally(),ut||updateLastActivity()}else if(t.type===at.WindowHover)updateLastActivity();else if(t.type===at.GetPageTitle)pt.pageTitle=t.value;else if(t.type===at.GetReferrer)pt.pageReferrer=t.value;else if(t.type===at.PageInfoResponse)t.value&&sendTrackingUpdate(t.value);else if(t.type===at.SettingsUpdate)t.value&&applyWindowStyling(t.value,!1,!0);else if(t.type===at.MediaStreamingCommand)relayWebRtcSignalFromParent(t.value);else if(t.type===at.SendMessage){var n=t.value;n.messageToSend?sendMessageToServerRequest(n):sendMessageToServer(n,"",!1,!0)}else if(t.type===at.ReportGoogleAnalyticsEvent)isLocalEnvironment()||(t.value.isException?gtag("event",t.value.eventName,t.value.details):gtag("event",t.value.eventName));else if(t.type===at.SubmitRazorpayPayment){sendMessageToServerRequest({messageToSend:"Kcomplete paymenttransaction",displayMessage:"Payment completed",payload:t.value}),Jt.removeRazorpayButton()}else if(t.type===at.SubmitCashfreePayment){sendMessageToServerRequest({messageToSend:"Kcomplete paymenttransaction",displayMessage:"Payment completed",payload:t.value}),Jt.removeCashfreeButton()}else if(t.type===at.FirebaseToken)t.value&&updateUserFcmToken(t.value);else if(t.type===at.SetCustomContext)t.hasOwnProperty("disableCustomMessage")&&!1!==t.disableCustomMessage||(t.hasOwnProperty("intent")&&t.intent?sendMessageToServer(t.intent,"",!1,!0,!1,t):sendMessageToServer("","",!0,!0,!0,t));else if(t.type===at.UserGeneratedEvent){sendEventsToServerAsBase64({globalUserId:se,botId:ce,data:t.value})}else if(t.type===at.UpdateSssionPing){var a=new XMLHttpRequest;a.open("GET",Qe+"?botId="+ce+"&globalUserId="+se,!0),a.send()}}})}function sendEventsToServerAsBase64(e){e=btoa(JSON.stringify(e));var t=new XMLHttpRequest;t.open("POST",Ze+"?botId="+ce,!0),t.setRequestHeader("Content-Type","application/octet-stream"),t.send(e)}function updateUserFcmToken(e){var t={fcmToken:e,globalUserId:se},n=new XMLHttpRequest,a=Xe.replace("<botId>",ce);n.open("POST",a,!0),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t))}function disconnectFromServer(){if(o)try{o.stop()}catch(e){}}function disconnectOnIdle(){var e=document.hasFocus();Wt&&Wt.idleTimeSec&&Se.isConnected&&Wt.lastFocusedAt&&!e&&(((new Date).valueOf()-Wt.lastFocusedAt.valueOf())/1e3>Wt.idleTimeSec&&(disconnectFromServer(),gtag("event",Ne.DISCONNECT_IDLE_USER),Se.isConnected=!1,Se.tryingToReconnect=!1,Se.reason="idle",clearConnectionIssues(),notifyConnectionIssues("Connection disconnected (Idle User)",!0),document.getElementById("chatWindow").addEventListener("focus",handleDocumentFocus)))}function updateLastActivity(){if(Wt){Wt.lastFocusedAt=new Date;var e={BotClientId:T?T.BotId:0,ConversationId:de,UserId:se,IsActive:"true"};Se&&Se.isConnected?(Wt.isActiveSignalSent||(Wt.isActiveSignalSent=!0,l.invoke("SendUserActivity",e)),Wt.stopTimingTimeOut||clearTimeout(Wt.stopTimingTimeOut),Wt.stopTimingTimeOut=setTimeout(function(){sendInActiveResponse(e)},5e3)):initializeServerConnection()}handleDocumentFocus()}function sendInActiveResponse(e){Wt.isActiveSignalSent=!1,e.IsActive=!1,Se&&Se.isConnected?l.invoke("SendUserActivity",e):initializeServerConnection()}function handleDocumentFocus(){document.getElementById("chatWindow").removeEventListener("focus",handleDocumentFocus),!Se.isConnected&&Se.reason&&"idle"===Se.reason&&initializeServerConnection()}function onSuccessfulServerConnection(){if(mt=!1,gtag("event",o&&o.transport&&o.transport.name||"unknown",eventData("transport_type")),clearConnectionIssues(),Se.isConnected=!0,Se.tryingToReconnect=!1,Se.isInitializing=!1,T){var e={BotClientId:T.BotId,Conversation:{ConversationId:de},User:{UserId:se}};l.invoke("Subscribe",e),sendSuspendedMessagesIfAny()}}function onFailedServerConnection(e){Se.isInitializing=!1,e.message=e.message||"",e.message="Failed Server Connection: "+e.message,trackError(e)}function handleWindowClose(){disconnectFromServer();var e=retrieveLocalStateIfExists();e&&e.messages&&(we=e.messages),saveStateLocally()}function autoMessageAnalytics(){}function handleMessageReceived(){E&&(removeTimestamp(E),E=null)}function handleBotResponse(n){if(zt=!1,n){if(r=new Date,d){var e=(r.valueOf()-d.valueOf())/1e3;He<e&&gtag("event",Ne.EVENT_MESSAGE_DELAY,eventData("messages",null,e))}if(c&&!s&&(s=!0,gtag("event",Ne.EVENT_FIRST_BOT_RESPONSE)),n.ClearChat&&clearChat(),renderBotMenu(n.BotMenu),n.Messages&&0<n.Messages.length){var a=-1,o="";n.Messages.forEach(function(e,t){e.DisplayName=n.DisplayName,e.IsPartial=n.IsPartial,(0<e.RichCards.length||null!=e.Text&&0<e.Text.length)&&(e.IsLastMessage=!0,a=t),null!=e.Id&&(o=e.Id)}),-1<a&&0<o.length&&(n.Messages[a].IsLastMessage=!0,n.Messages[a].MessageItemId=o),n.Messages.forEach(function(e){addToMessageQueue(e)}),saveStateLocally()}else hideTypingIndicator();Me&&gtag("event",Ne.EVENT_MESSAGE_RECEIVED,eventData("messages"));var t=document.getElementsByClassName(Ve);if(t)for(var i=0;i<t.length;i++)enableElement(t[i]);dispatchEventToParent(ot.UserQueryResponse,{query:n.QueryScore})}dispatchEventToParent(ot.BotMessage,{botMessages:n.Messages})}function handleManualReply(e){var t={Text:e.Text,RichCards:[],CardsType:et.None,DisplayName:e.SenderName};t.Text&&x.SETTINGS_OVERRIDE.Pattern.test(t.Text.trim())?applyWindowStyling(parseWindowConfig(t.Text),!0):(t.Text&&(renderNewMessage(t),notifyUnreadMessages(t.Text)),e.Suggestion&&(e.Suggestion.DisplayName=e.SenderName,renderNewMessage(e.Suggestion),notifyUnreadMessages(e.Suggestion.Text)))}function handleFormValues(e,t,n,a){var o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],i=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",r=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"";console.debug("Received values from form"),console.debug(t),disableElement(e.target,[Ve]);var s={},l=!0;t.forEach(function(e){var t=e.inputElementRef?e.inputElementRef.value:e.defaultValue||"";if(t&&"checkbox"===e.datatype&&(t=e.inputElementRef.checked?"true":"false"),e.isMandatory||isNonEmptyString(t)){e.validationPattern&&!isRegExp(e.validationPattern)&&(e.validationPattern=new RegExp(e.validationPattern)),e.antiValidationPattern&&!isRegExp(e.antiValidationPattern)&&(e.antiValidationPattern=new RegExp(e.antiValidationPattern));var n=!0;(n=e.validationPattern?e.validationPattern.test(t):isNonEmptyString(t))&&e.antiValidationPattern&&(n=!e.antiValidationPattern.test(t)),e.validationSource&&e.pluginObj&&e.validationSource===k&&(n=e.pluginObj.isValidNumber(),t=e.pluginObj.getNumber()),e.prefixAttribute&&e.prefixAttribute.value&&n&&(t=e.prefixAttribute.value+"_"+t),n?(setFormFieldAsValid(e),e.field?s[e.field]=t:s[e.displayName]=t):(setFormFieldAsInvalid(e),l=!1)}});var d=!0;if(l&&o){var c={};if(n){if(c.submit=n,c.values=s,a&&"values"===a){var u=[];Object.keys(s).forEach(function(e){u.push(""+s[e])});var p=u.join("\n");isNonEmptyString(c.payload=p)&&(sendMessageToServer(n,null,!1,!1,!1,p),d=!1)}else if(0<Object.keys(s).length){var m=n;0<r.trim().length&&(m=r),sendMessageToServer(n,m,!1,!1,!1,s),d=!1}}else{var g=convertToCSV(s);i&&(g+=", OnSubmit::"+i),isNonEmptyString(g)&&(sendMessageToServer(g,null,!1,!0),d=!1,c.csvString=g)}dispatchEventToParent(ot.GenericFormSubmit,c)}return d&&enableElement(e.target),{isFormValid:l,values:s}}function handleCustomFormValues(e,t,n,a){var o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];disableElement(e.target,[Ve]);var i={},r=!0;t.forEach(function(e){var t=e.inputElementRef?e.inputElementRef.value:"";if(t&&"checkbox"===e.datatype&&(e.inputElementRef.checked||(t="")),e.isMandatory||isNonEmptyString(t)){e.validationPattern&&!isRegExp(e.validationPattern)&&(e.validationPattern=new RegExp(e.validationPattern)),e.antiValidationPattern&&!isRegExp(e.antiValidationPattern)&&(e.antiValidationPattern=new RegExp(e.antiValidationPattern));var n=!0;(n=e.validationPattern?e.validationPattern.test(t):isNonEmptyString(t))&&e.antiValidationPattern&&(n=!e.antiValidationPattern.test(t)),e.validationSource&&e.pluginObj&&e.validationSource===k&&(n=e.pluginObj.isValidNumber(),t=e.pluginObj.getNumber()),n?(setFormFieldAsValid(e),i[e.displayName]=t):(setFormFieldAsInvalid(e),r=!1)}});var s=!0;if(r&&o){var l={};if(n)if(l.submit=n,l.values=i,a&&"values"===a){var d=[];Object.keys(i).forEach(function(e){d.push(""+i[e])});var c=d.join("\n");isNonEmptyString(l.payload=c)&&(sendMessageToServer(n,null,!1,!1,!1,c),s=!1)}else 0<Object.keys(i).length&&(sendMessageToServer(n,null,!1,!1,!1,i),s=!1);else{var u=convertToCSV(i);isNonEmptyString(u)&&(sendMessageToServer(u,null,!1,!0),s=!1,l.csvString=u)}dispatchEventToParent(ot.GenericFormSubmit,l)}return s&&enableElement(e.target),{isFormValid:r,values:i}}function enableElement(e){e&&e.classList&&(e.disabled=!1,e.classList.remove(Ve))}function disableElement(t,e){t&&t.classList&&(t.disabled=!0,e&&e.forEach(function(e){return t.classList.add(e)}))}function handleError(e){console.error(e),e&&(e.message=e.message||"",e.message="Handle Error: "+e.message),trackError(e)}function handleUserId(e,t){return se=e,le=!!t,saveStateLocally(),!0}function handleConversationId(e){return de=e,notifyParent(at.Initialize,de),saveStateLocally(),!0}function handleLanguageSettings(e){if(e){if(e.LanguageCode&&changeConversationLanguage(e.LanguageCode,e.PreventHiMessage),e.Personas&&!isEmpty(e.Personas))for(var t in e.Personas)updatePersona(t,e.Personas[t],!0);else updatePersona("user",re.UserPersona,!0),updatePersona("bot",re.BotPersona,!0);updateButtonTexts(e.Buttons&&!isEmpty(e.Buttons)?e.Buttons:Lt);var n=void 0;n=e.WindowContents&&!isEmpty(e.WindowContents)?e.WindowContents:At,e.WindowContents&&(applyWindowStyling(n,!0),notifyParent(at.UpdateAttentionMessage,n.AttentionMessage)),changeContentDirection(e.RightToLeft)}}function changeContentDirection(e){var t=e?"rtl":"ltr";document.documentElement&&(getCurrentDirection()!=t&&(document.documentElement.setAttribute("dir",t),vt.rtl=!!e))}function getCurrentDirection(){var e="ltr";if(document.documentElement){var t=document.documentElement.getAttribute("dir");t&&(e=t)}return e}function extractWindowConfig(a){var o={};return a&&Object.keys(a).forEach(function(e){var t=a[e].Value,n=a[e].Key;n in ft&&(o[n]=t)}),o}function sendMessageToServerRequest(e){sendMessageToServer(e.messageToSend,e.displayMessage,e.isAutoMessage,e.preventMessageRender,e.isHidden,e.payload,e.payloadType,e.isPostback)}function sendMessageToServer(e,t,n,a,o,i,r,s,l,d,c,u){if((n||!e||0!==e.trim().length)&&!zt){n||(updateLastActivity(),le=!1);var p=void 0;if(t&&!a){p=createUserChatBubble(t,'<span class="fa fa-spin fa-circle-o-notch"></span> sending..'),"user"!==b&&(addSenderDetails("user",getCurrentTimeString(),!0),b="user"),addToChatWindow(p),showTypingIndicator(ct.name)}if(fe.UserId=se,i&&i.type&&i.type===at.SetCustomContext){var m=["Name","Mobile","Email","type","intent"],g=["selectedConversationId","conversationMessages"],f=i.Name,v=i.Mobile,h=i.Email;for(var y in i)i.hasOwnProperty(y)&&-1===m.indexOf(y)&&-1===g.indexOf(y)&&(ge[y]=i[y]);f&&(fe.Name=f),v&&(fe.Mobile=v),h&&(fe.Email=h)}var C={RequestType:n?nt.AutoMessage:nt.UserMessage,Text:e,IsPostback:s,BotClientId:T?T.BotId:0,Conversation:{IsLocal:xt,SourceUrl:me,ConversationId:de,Context:ge},User:fe,IsTest:pe,ConversationLanguage:Ie||"",IsHidden:!!o};d&&l&&(C.MessageFeedback=d,C.MessageItemId=l),u&&c&&(C.AgentChatRating=c,C.MessageItemId=l,C.AgentChatFeedback=u),i&&(C.Payload=i,r&&(C.PayloadType=r)),gt.pageStartAt=new Date,Se.isConnected?makeBotRequest(C,E=p,t,a):(console.warn("[Kenyt.AI] Connection not yet initiated, suspending message.."),suspendMessage(C,p||null,t,a),initializeServerConnection())}}function sendMessageFeedbackToServer(e,t,n){sendMessageToServer(e,"",!0,!0,!0,null,null,!1,t,n)}function sendAgentChatFeedbackToServer(e,t,n,a){sendMessageToServer(e,"",!0,!0,!0,null,null,!1,t,"",n,a)}function makeBotRequest(a,o,i,r,s){if(l&&!zt){if(s||(s=0),c||a.RequestType!=nt.UserMessage||(c=!0,gtag("event",Ne.EVENT_FIRST_USER_REQUEST)),!Me&&a.RequestType!==nt.AutoMessage){Me=!0,dispatchEventToParent(ot.ChatStart,{messageText:i||a.Text});var e=getBrowserInformation();isObject(e)&&(a.BrowserInformation=e)}se&&!a.User.UserId&&(a.User.UserId=se),de&&!a.Conversation.ConversationId&&(a.Conversation.ConversationId=de),a.Conversation.TimezoneOffsetMinutes=-1*(new Date).getTimezoneOffset(),a.BotUserWebContext=st,zt=!0,l.invoke("UserMessage",T,a).done(function(e){if(zt=!1,e)d=new Date,removeTimestamp(o),a.RequestType===nt.AutoMessage&&(gt.isSentAck=!0),a.RequestType===nt.UserMessage&&(Mt||pe||window.setTimeout(function(){notifyParent(at.PageInfoRequest)},100),dispatchEventToParent(ot.UserMessage,{messageText:a.Text}));else{if(notifyConnectionIssues("Send failed. Reconnecting..."),window.setTimeout(function(){initializeServerConnection()},5e3),a.RequestType===nt.UserMessage)if(s<3){suspendMessage(a,o,i,r,"",s+1),r=!0;var t=a.BotClientId+"_"+a.Text;gtag("event",Ne.EVENT_MESSAGE_UNSUCCESSFUl,eventData("user_interaction",null,t))}else{var n=a.BotClientId+"_"+a.Text;gtag("event",Ne.EVENT_MESSAGE_ABANDONED,eventData("user_interaction",null,n))}Se.isConnected=!1,Se.reason="UserMessageFalse"}}).fail(function(e){if(zt=!1,notifyConnectionIssues("Send failed. Reconnecting..."),window.setTimeout(function(){initializeServerConnection()},5e3),a.RequestType===nt.UserMessage)if(s<3){suspendMessage(a,o,i,r,"",s+1),r=!0;var t=a.BotClientId+"_"+a.Text;gtag("event",Ne.EVENT_MESSAGE_UNSUCCESSFUl,eventData("user_interaction",null,t))}else{var n=a.BotClientId+"_"+a.Text;gtag("event",Ne.EVENT_MESSAGE_ABANDONED,eventData("user_interaction",null,n))}Se.isConnected=!1,Se.reason="UserMessageFail",handleFailedMessage(e),r=!0}),r||we.push({id:St++,isUserMessage:!0,message:a.Text,displayMessage:i,messageTimestamp:getCurrentTimeString()}),clearSilenceTimer(),Me&&gtag("event",Ne.EVENT_MESSAGE_SENT,eventData("messages")),saveStateLocally()}else console.error("[Kenyt.AI] Cannot send message - HubProxy is null")}function showTypingIndicator(e){hideTypingIndicator();var t=getTypingIndicator(e);kt.indicatorView=t[0],kt.senderDetailsView=t[1],V.appendChild(kt.senderDetailsView),V.appendChild(kt.indicatorView)}function hideTypingIndicator(){kt.senderDetailsView&&(kt.senderDetailsView.remove(),kt.senderDetailsView=null),kt.indicatorView&&(kt.indicatorView.remove(),kt.indicatorView=null)}function getTypingIndicator(e){var t=document.createElement("div"),n=createBotChatBubble();n.appendChild(getTemplate(ze.TYPING_INDICATOR)),t.classList.add("col-12"),t.appendChild(n);var a=getTemplate(ze.SENDER_DETAILS);return a.querySelector("[data-persona]").textContent=e,[t,a]}function removeTimestamp(e){if(e&&e instanceof HTMLDivElement){var t=e.querySelector(".message-timestamp");t&&t.remove()}}function handleFailedMessage(e){e&&(console.error(e),e.message=e.message||"",e.message="Failed Message: "+e.message,trackError(e))}function addToMessageQueue(e){0<ht.length?ht.push(e):0<e.SendWithDelayMs?(ht.push(e),window.setTimeout(function(){processMessageQueue()},e.SendWithDelayMs)):0<e.SendOnSilenceMs?(ht.push(e),window.setTimeout(function(){processMessageQueue()},10)):renderNewMessage(e)}function processMessageQueue(){if(0<ht.length){var e=ht.splice(0,1)[0];0<e.SendOnSilenceMs?startSilenceTimer(e.SendOnSilenceMs,function(){renderNewMessage(e),notifyUnreadMessages(e.Text)}):(renderNewMessage(e),notifyUnreadMessages(e.Text)),0<ht.length&&0===ht[0].SendWithDelayMs?processMessageQueue():0<ht.length&&0<ht[0].SendWithDelayMs&&window.setTimeout(function(){processMessageQueue()},ht[0].SendWithDelayMs)}}function startSilenceTimer(e,t){clearSilenceTimer(),i=window.setTimeout(function(){t()},e)}function clearSilenceTimer(){i&&(window.clearTimeout(i),i=0)}function renderNewMessage(e){showTypingIndicator("bot"===e.DisplayName?ct.name:e.DisplayName),window.setTimeout(function(){hideTypingIndicator(),renderMessage(e,!1),b=e.DisplayName,we.push({id:St++,isUserMessage:!1,message:e,messageTimestamp:getCurrentTimeString(),displayMessage:null}),g[e.MessageItemId]=we[we.length-1].id,saveStateLocally()},Pe)}function renderMessage(e,t){if(e.IsPartial&&Ht)addMessageToLastCarousel(e);else{if(e.DisplayName===b||t||addSenderDetails(e.DisplayName,getCurrentTimeString()),e.Command&&e.Command.Name)if(e.Command.Name===x.CONTACT_FORM.Trigger)addFormToChatHistory((o=jt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings);else if(e.Command.Name===x.APPOINTMENT_FORM.Trigger){addFormToChatHistory((o=jt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings)}else if(e.Command.Name===x.ADDRESS_FORM.Trigger){addFormToChatHistory((o=jt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings)}else if(e.Command.Name===x.LATLONG_FORM.Trigger)t||requestGeoLocation();else if(e.Command.Name===x.FIREBASE_FORM.Trigger)t||requestFirebaseNotification();else if(e.Command.Name===x.FILE_UPLOAD.Trigger){var a=getFormSettings(e.Command.Value),r=getUploadFormTemplate();r.onSubmit=function(e){e.preventDefault();var t=e.target.getElementsByTagName("button");if(t&&t.length)for(var n=0;n<t.length;n++)disableElement(t[n]);var o=!0,i=[];r.fields.forEach(function(a){var t=[];t.push({inputElementRef:a.inputElementRef,feedbackElementRef:a.feedbackElementRef}),a.extraInputs&&a.extraInputs.forEach(function(e){t.push(e)}),t.forEach(function(e){var t=e.inputElementRef.value;if(a.isMandatory&&0==i.length||isNonEmptyString(t)){var n=isNonEmptyString(t);if(n&&"file"==a.datatype){20971520<e.inputElementRef.files[0].size&&(n=!1)}n?(setFormFieldAsValid(e),i.push(e.inputElementRef.files[0])):(setFormFieldAsInvalid(e),o=!1)}})}),o||(i=[]),handleUploadDocument(i,a,e)},renderForm(r,a),addFormToChatHistory(r,e.DisplayName)}else if(e.Command.Name===x.CALLER.Trigger)t||openWebRtcCaller(e);else if(e.Command.Name===x.OTP.Trigger){if(e.Command.Value){var n=null;try{n=JSON.parse(e.Command.Value).phone}catch(e){console.error("Error parsing command value",e)}addToChatWindow(convertToBotChatBubble(createOTPForm(n)))}}else if(e.Command.Name===x.GENERIC_FORM.Trigger){var o;if(e.Command.Value)addFormToChatHistory((o=jt.getFormDetailsFromCommand(e.Command)).template,e.DisplayName),renderForm(o.template,o.setttings)}else if(e.Command.Name===x.NAVIGATE.Trigger){if(!t){var i={url:e.Command.Value};notifyParent(at.NavigateToPage,i)}}else if(e.Command.Name===x.SETTINGS_OVERRIDE.Trigger){applyWindowStyling(parseWindowConfig(e.Command.Value),!0)}else if(e.Command.Name===x.SET_SESSION.Trigger)t||updateSession(getFormSettings(e.Command.Value));else if(e.Command.Name===x.NOTIFY_LEAD_CAPTURE.Trigger){if(!t){var s=getFormSettings(e.Command.Value);dispatchEventToParent(ot.ContactFormSubmit,s)}}else if(e.Command.Name===x.OPEN_RAZORPAY_BUTTON.Trigger){(l=getFormSettings(e.Command.Value)).FrameColor=getFrameColor(),Jt.addRazorpayButton(l)}else if(e.Command.Name===x.OPEN_CASHFREE_BUTTON.Trigger){var l;(l=getFormSettings(e.Command.Value)).FrameColor=getFrameColor(),Jt.addCashfreeButton(l)}else if(e.Command.Name===x.NOTIFY_TYPING.Trigger){var d=getFormSettings(e.Command.Value);d.isTyping?showTypingIndicator(d.name):hideTypingIndicator()}else if(e.Command.Name===x.PRINT.Trigger){printDocument(e.Command.Value),e.Text="Printing..."}else if(e.Command.Name===x.IMAGE_CAPTURE.Trigger){var c="Capture Image",u="";if(e.Command.Value)try{var p=JSON.parse(e.Command.Value);p&&(c="string"==typeof p.title?p.title:"Capture Image",u="string"==typeof p.description?p.description:"")}catch(e){console.error("Invalid JSON in botMessage.Command.Value:",e)}J&&(cameraOverlayAsFormCssOveride(),showElements(J)),Y.click();var m=document.createElement("span"),g=document.createElement("p");m.classList.add("h6","font-weight-bold"),g.classList.add("m-0"),m.textContent=c,g.textContent=u;var f=document.createElement("div");f.appendChild(rowContainer(["mt-1"],columnContainer(["text-center"],m,g)));var v=createBotChatBubble();v.classList.add("w-95"),v.appendChild(f),v.appendChild(J),addToChatWindow(v)}if(e.Text||0<e.RichCards.length){var h=!1;(e.IsLastMessage||t&&0<e.MessageFeedback)&&(h=!0);var y=createBotChatBubble(e.Text,e.RichCards,e.CardsType,e.ContentType,e.XPath||"",e.Name,e.MultipleOptionsSettings,h,e);e.CardsType&&e.CardsType===et.FooterMenu&&(Ct.footerMenu.content=e),addToChatWindow(y),It&&isNonEmptyString(e.Text)&&speakText(e.Text)}}}function createMessageFeedbackContainer(e){if(e.MessageItemId){var t=e.MessageFeedback,n=e.MessageItemId,a=document.createElement("div");a.className="user-feedback-container";var o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="8px";var i=document.createElement("span");i.innerHTML=1===t?'<i class="fas fa-thumbs-up"></i>':'<i class="far fa-thumbs-up"></i>',i.style.fontSize="18px",i.style.cursor="pointer",i.style.transition="transform 0.2s ease",i.style.color="#00c000",i.addEventListener("mouseover",function(){i.style.transform="scale(1.2)"}),i.addEventListener("mouseleave",function(){i.style.transform="scale(1)"}),i.addEventListener("click",function(){0===t&&(we[g[n]-1].message.MessageFeedback=1,saveStateLocally(),sendMessageFeedbackToServer("/userLikedMessage",n,t=1),i.querySelector("i").classList.replace("far","fas"),r.querySelector("i").classList.replace("fas","far"))});var r=document.createElement("span");r.innerHTML=2===t?'<i class="fas fa-thumbs-down" style="transform: scaleX(-1);"></i>':'<i class="far fa-thumbs-down" style="transform: scaleX(-1);"></i>',r.style.fontSize="18px",r.style.cursor="pointer",r.style.transition="transform 0.2s ease",r.style.color="#f64343",r.addEventListener("mouseover",function(){r.style.transform="scale(1.2)"}),r.addEventListener("mouseleave",function(){r.style.transform="scale(1)"}),r.addEventListener("click",function(){0===t&&(t=2,we[g[n]-1].message.MessageFeedback=2,saveStateLocally(),sendMessageFeedbackToServer("/userDislikedMessaage",n,t),i.querySelector("i").classList.replace("fas","far"),r.querySelector("i").classList.replace("far","fas"))}),o.appendChild(i),o.appendChild(r);var s=document.createElement("span");return s.innerHTML="Did this help ?",s.style.marginRight="10px",s.style.color="#8e8e8e",a.appendChild(s),a.appendChild(o),a}}function addMessageToLastCarousel(e){e&&e.RichCards&&addCardsToLastCarousel(e.RichCards,e.CardsType)}function createAgentChatFeedbackContainer(e){e.MessageFeedback;var a=e.MessageItemId;if(document.querySelector(".agent-chat-feedback-container"))return null;var t=document.createElement("div");t.className="agent-chat-feedback-container";var n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.alignItems="center",n.style.flexDirection="column",n.style.justifyContent="center";var o=document.createElement("div"),i=document.createElement("span");i.innerHTML='<i class="fas fa-times" style="font-size: 14px"></i>',i.style.cursor="pointer",o.style.display="flex",o.style.justifyContent="flex-end",o.style.width="100%",i.addEventListener("click",function(){hideAgentChatFeedback()}),o.appendChild(i);var l=document.createElement("div");l.style.display="flex",l.style.gap="8px",l.classList.add("rating-box"),l.style.padding="14px";var r=document.createElement("div");r.innerText="Submit Agent Feedback",r.style.padding="10px";var s=document.createElement("textarea");s.classList.add("chat-agent-feedback"),s.style.minHeight="70px",s.style.maxHeight="70px",s.style.width="100%",s.style.borderRadius="",s.style.overflowY="scroll";var d=document.createElement("div");d.style.display="flex",d.style.justifyContent="center";var c=document.createElement("button");c.innerText="Submit",c.classList.add("btn","primary-button"),c.style.cursor="pointer",c.style.marginTop="10px",c.addEventListener("click",function(){for(var e=s.value,t=0,n=1;n<=5&&l.querySelector("#rate_"+n).classList.contains("fas");n++)t++;s.innerText="",sendAgentChatFeedbackToServer("/agentchatfeedback",a,t,e),hideAgentChatFeedback()}),d.appendChild(c);for(var u=0;u<5;u++){var p=document.createElement("span");p.classList.add("far","fa-star"),p.style.cursor="pointer",p.style.fontSize="16px",p.setAttribute("id","rate_"+(u+1)),l.appendChild(p),p.addEventListener("click",function(e){var t=e.target.id;if(t){for(var n=1;n<=5;n++){var a=l.querySelector("#rate_"+n);a.classList.replace("fas","far"),a.style.color="black"}for(var o=parseInt(t.split("_")[1]),i=getRatingColor(o),r=1;r<=o;r++){var s=l.querySelector("#rate_"+r);s.classList.add("fas"),s.style.color=i}}})}return n.appendChild(o),n.appendChild(r),n.appendChild(l),n.appendChild(s),n.appendChild(d),t.appendChild(n),t}function getRatingColor(e){return e<=2?"red":3==e?"gold":"green"}function hideAgentChatFeedback(){document.querySelector(".agent-chat-feedback-container").classList.add("dis-none")}function selectChatRating(e){for(var t=1;t<=e;t++)thumbsUp.querySelector("i").classList}function handleUploadDocument(t,n,a){if(t&&0<t.length){var e=t[0];t.shift();var o=new FormData;o.append("UploadFile",e);var i=n.FailureCallback||"submit file failure",r={};r.FileName=e.name,$.ajax({url:Ye+"?botId="+ce+"&userId="+se,type:"POST",data:o,success:function(e){e&&e.item2?sendMessageToServer(n.SubmitCallback||e.item1,null,!1,!0,!1,e.item2,"file"):sendMessageToServer(i,null,!1,!0,!1,r)},error:function(e){r.message=e,sendMessageToServer(i,null,!1,!0,!1,r)},complete:function(e){handleUploadDocument(t,n,a)},cache:!1,contentType:!1,processData:!1})}else{var s=a.target.getElementsByTagName("button");if(s&&s.length)for(var l=0;l<s.length;l++)enableElement(s[l])}}function renderBotMenu(e){e&&e.HeaderMenu&&renderHeaderMenu(e.HeaderMenu)}function renderHeaderMenu(e){if(Ct.headerMenu.container&&e&&e.RichCards){Ct.headerMenu.content=e;var o=Ct.headerMenu.container.getElementsByClassName("dropdown-menu");if(0<o.length){for(var t=[],n=o[0].children,a=0;a<n.length;a++){var i=n[a];"DIV"==i.tagName&&t.push(i)}t.forEach(function(e){o[0].removeChild(e)});var r=e.RichCards,s=0;r&&r.length&&r.forEach(function(e){if(e){s++;var t=createCardByTemplate(e,ze.HEADER_MENU_ITEM,s,r.length),n=t.innerText;n&&(n=n.trim());var a=t.getAttribute("message");a||(a=t.innerText)&&(a=a.trim()),t.addEventListener("click",function(){sendMessageToServer(a,n)}),o[0].appendChild(t)}})}}}function renderInteractiveMenu(e,t){var n=document.getElementById("footer-menu");if(e&&(yt.previousStateLoaded||Ct.footerMenu.isOpened)){var a=e.getElementsByClassName("interactive-menu-options");if(a&&0<a.length)a=a[0],Ct.footerMenu.optionsContainer.appendChild(a),a.classList.remove("d-none"),n.classList.remove("footer-hidden"),t=t||"Menu",document.getElementById("footer-menu-title").innerText=t,document.getElementById("chatWindow").classList.add("footer-menu"),n.classList.add("open"),n.classList.remove("footer-minimized"),Ct.footerMenu.menuline.style.display="none",Ct.footerMenu.isOpen=!0,Ct.footerMenu.referenceElement=e}}function renderCards(e,t,n,a,o,i){var r=6<arguments.length&&void 0!==arguments[6]&&arguments[6];if(0<e.length){var s=document.createElement("div"),l=void 0;return t===et.None||t===et.Thumbnail?(l=e[0].Image?createCarousel(e):equalsIgnoreCase(n,"MultipleChoice")?createMultipleChoiceCard(e,o):equalsIgnoreCase(n,"Dropdown")?createDropdownCard(e):createOptionGroup(e,i,r)).classList.add("text-center"):t===et.SmallButton?l=createOptionGroupByTemplate(e,ze.SMALL_BUTTON_CARD):t===et.MediumButton?l=createOptionGroupByTemplate(e,ze.MEDIUM_BUTTON_CARD):t===et.VisitingCard?l=createOptionGroupByTemplate(e,ze.VISITING_CARD):t===et.VerticalCard?l=createOptionGroupByTemplate(e,ze.VERTICAL_CARD):t===et.Hero||(t===et.Image||t===et.Gif||t===et.Video?l=createCarousel(e):t===et.QuickLink||(t===et.Location?l=createOptionGroupByTemplate(e,ze.LOCATION_CARD):t===et.File?l=createOptionGroupByTemplate(e,ze.FILE_CARD):t===et.FooterMenu?l=createOptionGroupByTemplate(e,ze.FOOTER_MENU,a):t===et.InteractiveList?l=createOptionGroupByTemplate(e,ze.INTERACTIVE_CARD,a):(console.error("Cannot render card"),console.error("Unknown card type: "+t)))),l&&(Ht={container:l,size:e.length},l.classList.add("mt-1"),s.appendChild(l)),s}}function addCardsToLastCarousel(e,t){Ht&&0<e.length&&(t===et.None||t===et.Thumbnail?e[0].Image&&addToCarousel(e):t===et.SmallButton?addOptionGroupByTemplate(e,ze.SMALL_BUTTON_CARD):t===et.MediumButton?addOptionGroupByTemplate(e,ze.MEDIUM_BUTTON_CARD):t===et.VisitingCard?addOptionGroupByTemplate(e,ze.VISITING_CARD):t===et.VerticalCard?addOptionGroupByTemplate(e,ze.VERTICAL_CARD):t===et.Hero||(t===et.Image||t===et.Gif||t===et.Video?addToCarousel(e):t===et.QuickLink||(t===et.Location?addOptionGroupByTemplate(e,ze.LOCATION_CARD):t===et.File?addOptionGroupByTemplate(e,ze.FILE_CARD):t===et.FooterMenu?addOptionGroupByTemplate(e,ze.FOOTER_MENU):t===et.InteractiveList?addOptionGroupByTemplate(e,ze.INTERACTIVE_CARD):(console.error("Cannot render card"),console.error("Unknown card type: "+t)))))}function createOptionGroup(e,a,o){var i=document.createElement("div");i.classList.add("card-thumbnail");var r=0;if(e&&e.length&&e.forEach(function(e){if(o){var t=structuredClone(e);e=new Proxy(t,{get:function(e,t){return e[t]?e[t]:e[t.replace(/^./,function(e){return e.toLowerCase()})]?e[t.replace(/^./,function(e){return e.toLowerCase()})]:e[t.replace(/^./,function(e){return e.toUpperCase()})]?e[t.replace(/^./,function(e){return e.toUpperCase()})]:void 0}})}if(e){r++;var n=createOptionContainerGroupItem(e.Title,e.Options.tap,e.IsNavigational,a);i.appendChild(n),10<r&&n.classList.add("extra-option")}}),10<r){i.classList.add("show-less");var t=getTemplate(ze.SHOW_MORE_BUTTON);t.addEventListener("click",function(){i.classList.remove("show-less")}),i.appendChild(t)}return modifyLinksToOpenInNewTab(i),i}function createOptionGroupByTemplate(e,n,t){var a=document.createElement("div"),o=0,i=10,r=getTemplate(n),s=r.getAttribute("data-max-cards");if(s&&(i=parseInt(s,10))<=0&&(i=10),e&&e.length){var l=getCarouselLength(e);e.forEach(function(e){if(e){var t=createCardByTemplate(e,n,++o,l);a.appendChild(t),i<o&&t.classList.add("extra-option")}})}var d=r.getAttribute("data-container");d||(d="");var c=r.getAttribute("data-container-class");switch(d){case"CarouselContainer":a.classList.add("custom-carousel");var u=getCurrentDirection();if(a.setAttribute("dir",u),c&&a.classList.add(c),e.length<=1){var p=JSON.parse(JSON.stringify(vt));p.arrows=!1,p.autoplay=!1,p.dots=!1,$(a).slick(p)}else $(a).slick(vt);$(a).slick("setPosition");break;case"FooterMenu":a.classList.add("interactive-menu-options"),a.classList.add("d-none"),Ct.footerMenu.contentElement.innerHTML="",Ct.footerMenu.contentElement.appendChild(a),Ct.footerMenu.hidden=!1,Ct.footerMenu.container.classList.remove("footer-hidden"),renderInteractiveMenu(Ct.footerMenu.contentElement,t);var m=document.createElement("div");a=m;break;case"InteractiveMenu":a.classList.add("interactive-menu-options"),a.classList.add("d-none");var g=document.createElement("div"),f={};f.Title=t||"Menu",f.Image="icon:bars",f.Options=[];var v=createCardByTemplate(f,ze.SMALL_BUTTON_CARD,1,1);v.addEventListener("click",function(e){renderInteractiveMenu(g,t)}),g.appendChild(v),g.appendChild(a),a=g;break;default:if(a.classList.add("card-thumbnail"),i<o){a.classList.add("show-less");var h=getTemplate(ze.SHOW_MORE_BUTTON);h.addEventListener("click",function(){a.classList.remove("show-less")}),a.appendChild(h)}}return modifyLinksToOpenInNewTab(a),a}function addOptionGroupByTemplate(e,n){var t=getTemplate(n).getAttribute("data-container");switch(t||(t=""),t){case"CarouselContainer":var a=Ht.size;$(Ht.container).slick("slickRemove",a-1);var o=e.length+a-1,i=getCarouselLength(e);e.forEach(function(e){var t=createCardByTemplate(e,n,a,i);t&&($(Ht.container).slick("slickAdd",t),a++)}),$(Ht.container).slick("slickGoTo",Ht.size-1),Ht.size=o}}function getCarouselLength(e){var t=e.length;return e[e.length-1].IsNavigational&&(t=e[e.length-1].Total),t}function createOptionGroupItem(n,a,o,i){var e=document.createElement("div");return n=getButtonsText(n),e.textContent=n,e.classList.add("option-pill"),a&&(e.classList.add("pointer"),e.addEventListener("click",function(e){var t={messageToSend:a,displayMessage:n,preventMessageRender:o,isPostback:!0};i?i(e,t):sendMessageToServerRequest(t)})),e}function createOptionContainerGroupItem(e,t,n,a){var o=createOptionGroupItem(e,t,n,a),i=document.createElement("div");return i.classList.add("option-pill-container"),i.appendChild(o),i}function isValidUrl(e){try{return new URL(e),!0}catch(e){return!1}}function getFileIcon(e){return{pdf:{icon:"file-pdf",color:"red"},ppt:{icon:"file-powerpoint",color:"#c7421d"},pptx:{icon:"file-powerpoint",color:"#c7421d"},xls:{icon:"file-excel",color:"green"},xlsx:{icon:"file-excel",color:"green"},zip:{icon:"file-archive",color:"purple"},txt:{icon:"file-alt",color:"black"},doc:{icon:"file-word",color:"#325b9d"},docx:{icon:"file-word",color:"#325b9d"}}[e.split(".").pop().toLowerCase()]||{icon:"file",color:"black"}}function createCardByTemplate(r,e,t,n){var s=getTemplate(e);if(r.ElementId&&(s.id=r.ElementId),s.querySelectorAll("[data-card-title]").forEach(function(e){e&&r.Title&&(e.textContent=r.Title.trim(),e.innerHTML=marked(e.textContent))}),s.querySelectorAll("[data-card-subtitle]").forEach(function(e){if(e&&r.SubTitle){e.textContent=r.SubTitle;var t=s.querySelectorAll("[data-card-file-icon]");if(null!=t&&0<t.length){var n;t=t[0];var a=getFileIcon(r.SubTitle),o=a.icon,i=a.color;(n=t.classList).remove.apply(n,_toConsumableArray(t.classList)),t.classList.add("fa"),t.classList.add("fa-"+o),t.style.color=i}}}),r.Coordinates){var a=s.querySelector("[data-card-coordinates]");if(a||s.hasAttribute("data-card-coordinates")&&(a=s),a){var o="https://www.google.com/maps?q="+r.Coordinates.Item1+","+r.Coordinates.Item2;a.addEventListener("click",function(){window.open(o,"_blank")})}}s.querySelectorAll("[data-card-fileurl]").forEach(function(e){e&&r.FileUrl&&e.addEventListener("click",function(){if(isValidUrl(r.FileUrl))window.open(r.FileUrl,"_blank");else try{for(var e=r.MIMEType,t=atob(r.FileUrl),n=new Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);var o=new Uint8Array(n),i=new Blob([o],{type:e});window.open(URL.createObjectURL(i),"_blank")}catch(e){console.error("Error converting Base64 to Blob:",e)}})}),s.querySelectorAll("[data-card-description]").forEach(function(e){e&&r.Description&&(e.innerHTML=marked(r.Description))});var i=s.querySelector("[data-card-tapbutton]");i||s.hasAttribute("data-card-tapbutton")&&(i=s);var l=createIconElement(r.Image);if(l)s.querySelectorAll("[data-card-icon-container]").forEach(function(e){e&&(e.firstChild?e.insertBefore(l,e.firstChild):e.appendChild(l))});else if(r.Image){s.querySelectorAll("[data-card-image]").forEach(function(e){e&&(e.src=r.Image)})}else s.classList.add("no-image");if(i&&r.OnClick)i.addEventListener("click",function(e){r.OnClick(e)});else if(i&&r.Options){var d=Object.keys(r.Options);if(0<d.length){var c=r.Options.tap;c||(c=r.Options[d[0]]),i.addEventListener("click",function(){sendMessageToServerRequest({messageToSend:c,displayMessage:r.Title,preventMessageRender:r.IsNavigational,isPostback:!0})})}}var u=s.querySelector("[data-card-add-btns]");u&&r.Options&&Object.keys(r.Options).forEach(function(e){switch(e){case"Open":break;default:var t=getTemplate(ze.CARD_BUTTON);t&&(t.textContent=e,t.addEventListener("click",function(){sendMessageToServerRequest({messageToSend:r.Options[e],displayMessage:e,preventMessageRender:r.IsNavigational,isPostback:!0})}),u.appendChild(t))}});var p=r.Total||n;p&&1<p&&s.querySelectorAll("[data-card-slide-number]").forEach(function(e){e&&(r.IsNavigational||(e.textContent=t+"/"+p))});return s.querySelectorAll("[data-marked-content]").forEach(function(e){e&&e.innerHTML&&(e.innerHTML=marked(e.innerHTML))}),modifyLinksToOpenInNewTab(s),s}function updateCardById(e,t){var n=document.getElementById(e);if(n){if(t.Title)n.querySelectorAll("[data-card-title]").forEach(function(e){e&&(e.textContent=t.Title)});var a=n.querySelector("[data-card-tapbutton]");a||n.hasAttribute("data-card-tapbutton")&&(a=n),t.RemoveId&&n.removeAttribute("id"),a&&t.RemoveClick&&(n.removeAttribute("class"),a.outerHTML=a.outerHTML)}}function createCarousel(e,a){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=document.createElement("div");if(e&&0<e.length){var r=getCarouselLength(e),s=1;e.forEach(function(e){if(o){var t=structuredClone(e);e=new Proxy(t,{get:function(e,t){return e[t]?e[t]:e[t.replace(/^./,function(e){return e.toLowerCase()})]?e[t.replace(/^./,function(e){return e.toLowerCase()})]:e[t.replace(/^./,function(e){return e.toUpperCase()})]?e[t.replace(/^./,function(e){return e.toUpperCase()})]:void 0}})}var n=createCarouselItem(e,s,r,a);n&&(i.appendChild(n),s++)})}i.classList.add("custom-carousel");var t=getCurrentDirection();if(i.setAttribute("dir",t),e.length<=1){var n=JSON.parse(JSON.stringify(vt));n.arrows=!1,n.autoplay=!1,n.dots=!1,$(i).slick(n)}else $(i).slick(vt);return $(i).slick("setPosition"),modifyLinksToOpenInNewTab(i),i}function createCarouselItem(t,e,n,a){var o=document.createElement("div"),i=createVideoCard(t);if(i||(t.Image&&isNonEmptyString(t.Image)?(i=document.createElement("img")).src=t.Image:t.Gif&&isNonEmptyString(t.Gif)&&((i=document.createElement("img")).src=t.Gif)),i){o=document.createElement("div");var r=document.createElement("div");r.classList.add("img-container");var s=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),c=null,u=document.createElement("div"),p=document.createElement("span");if(!t.IsNavigational){var m=t.Total||n;p.textContent=e+"/"+m}i.setAttribute("data-index",e);var g=i.tagName&&"VIDEO"===i.tagName.toUpperCase();if(g||(i.alt=t.Title||t.Description||"AI Agent carousel image"),i.classList.add("custom-carousel-image","loading"),g){var f=function handleVideoReady(){i.classList.remove("loading"),i.removeEventListener("loadeddata",handleVideoReady),i.removeEventListener("loadedmetadata",handleVideoReady)};i.addEventListener("loadeddata",f),i.addEventListener("loadedmetadata",f)}else i.classList.add("pointer"),i.addEventListener("load",function(){i.classList.remove("loading")});if(i.addEventListener("error",function(){trackError({message:"Media not found: "+mediaUrl},!1)}),t.Options){var v=[],h=!1;if(Object.keys(t.Options).forEach(function(e){switch(e){case"Open":g||(o.setAttribute("data-open-imageurl",t.Options.Open),o.setAttribute("data-open-caption",t.Title),o.addEventListener("click",function(e){openImages(o)}),h=!0);break;default:v.push({title:e,value:t.Options[e]})}}),0<v.length){if(!h&&!g){var y=v[0];i.addEventListener("click",function(){sendMessageToServerRequest({messageToSend:y.value,displayMessage:y.title,preventMessageRender:t.IsNavigational,isPostback:!0})})}(c=document.createElement("div")).classList.add("text-center"),v.forEach(function(e){return c.appendChild(createOptionGroupItem(e.title,e.value,t.IsNavigational,a))})}}s.textContent=t.Title,l.textContent=t.SubTitle,d.textContent=t.Description,s.textContent&&(s.innerHTML=marked(s.textContent)),d.textContent&&(d.innerHTML=marked(d.textContent)),o.classList.add("card-border"),s.classList.add("text-center"),s.classList.add("data-title"),l.classList.add("text-center"),l.classList.add("data-subtitle"),d.classList.add("text-center"),p.classList.add("text-center"),u.classList.add("text-center","card-index","primary-border"),u.appendChild(p),u.style.height=u.style.width,s.textContent&&o.appendChild(genericContainer([],s)),r.appendChild(i),o.appendChild(r),1<n&&r.appendChild(u),l.textContent&&o.appendChild(genericContainer([],l)),d.textContent&&o.appendChild(genericContainer([],d)),c&&o.appendChild(genericContainer([],c))}return o}function createVideoCard(t){if(t&&isNonEmptyString(t.Video))try{var e=new URL(t.Video).searchParams.get("v");if(e)return createYoutubeEmbedIframe(e);var n=document.createElement("video");n.setAttribute("controls",""),n.setAttribute("playsinline",""),n.setAttribute("webkit-playsinline",""),n.setAttribute("preload","metadata"),n.setAttribute("aria-label",t.Title||t.Description||"Video content");for(var a=[t.Poster,t.PosterUrl,t.VideoPoster,t.Image,t.Thumbnail,t.ThumbnailUrl,t.CoverImage],o=null,i=0;i<a.length;i++){var r=a[i];if(isNonEmptyString(r)){o=r;break}}o&&n.setAttribute("poster",o);var s=document.createElement("source");if(s.src=t.Video,"string"==typeof t.Video&&t.Video.toLowerCase().endsWith(".mp4")&&(s.type="video/mp4"),n.appendChild(s),isIOSDevice()){var l=function ensurePreviewFrame(){if(2<=n.readyState){try{n.currentTime=0,n.pause()}catch(e){console.debug("[Kenyt.AI] Unable to prime iOS video preview frame",e)}n.removeEventListener("loadeddata",ensurePreviewFrame),n.removeEventListener("loadedmetadata",ensurePreviewFrame)}};n.addEventListener("loadeddata",l),n.addEventListener("loadedmetadata",l),requestAnimationFrame(function(){try{n.load()}catch(e){console.debug("[Kenyt.AI] Unable to trigger iOS video metadata load",e)}})}return n}catch(e){console.error("[Kenyt.AI] Error rendering Youtube Video: "+t.Video),console.error(e)}return null}function createYoutubeEmbedIframe(e){var t=document.createElement("iframe");return t.src="https://www.youtube-nocookie.com/embed/"+e,t.setAttribute("title","YouTube video player for video "+e),t.setAttribute("frameborder","0"),t.setAttribute("allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"),t.setAttribute("allowfullscreen",""),t.setAttribute("playsinline",""),t}function openImages(e){var t=getImageIndex(e);if(0<=t){for(var n=[],a=e.previousElementSibling;a;){var o=getImageIndex(a);if(0<=o&&o<t){if(c=a.getAttribute("data-open-imageurl")){var i={imageUrl:c,caption:a.getAttribute("data-open-caption")};n.push(i)}a=a.previousElementSibling}else a=null}for(var r=[],s=e,l=t;s;){var d=getImageIndex(s);if(0<=d&&l<=d){var c;if(l=d,c=s.getAttribute("data-open-imageurl")){var u={imageUrl:c,caption:s.getAttribute("data-open-caption")};r.push(u)}s=s.nextElementSibling}else s=null}var p={};for(p.currentSlideNumber=n.length+1,p.slides=[];n.length;){var m=n.pop();p.slides.push(m)}for(var g=0;g<r.length;g++)p.slides.push(r[g]);notifyParent(at.FullScreenImage,p)}}function getImageIndex(e){var t=-1,n=e.getElementsByClassName("custom-carousel-image");return n&&(n=n[0])&&(t=n.getAttribute("data-index")),t}function addToCarousel(e){if(Ht&&e&&0<e.length){var n=Ht.size;$(Ht.container).slick("slickRemove",n-1);var t=e.length+n-1,a=getCarouselLength(e);e.forEach(function(e){var t=createCarouselItem(e,n,a);t&&($(Ht.container).slick("slickAdd",t),n++)}),$(Ht.container).slick("slickGoTo",Ht.size-1),Ht.size=t}}function createOTPForm(e){var n=getTemplate(ze.OTP_FORM),a=n.querySelector("[data-input-field]"),o=n.querySelector("[data-submit]").querySelector("span"),t=n.querySelector("[data-mobile-number]"),i=n.querySelector("[data-error-description]"),r=n.querySelector("[data-change-mobile-number]"),s=n.querySelector("form");return t.textContent=e||"your mobile",a.pattern=Ae.source,a.addEventListener("change",function(){i.textContent=""}),r.addEventListener("click",function(){var e=n.parentElement,t=convertToBotChatBubble(createPhoneNumberForm());n.remove(),e.appendChild(t)}),s.addEventListener("submit",function(e){e.preventDefault();var t=a.value;i.textContent="",o.classList.remove("fa-paper-plane"),o.classList.add("fa-spin","fa-spinner"),Ae.test(t)?(sendMessageToServer(t,t,!1,!1,!1),n.remove()):(console.warn("OTP Invalid"),i.textContent="The OTP you entered is invalid, try again")}),n}function createPhoneNumberForm(){var t=getTemplate(ze.PHONE_NUMBER_FORM),n=t.querySelector("[data-input-field]"),a=t.querySelector("[data-error-description]"),e=t.querySelector("form");return window.intlTelInput(n,{geoIpLookup:function(e){e("IN")},hiddenInput:"full_number",initialCountry:"auto",placeholderNumberType:"MOBILE",separateDialCode:!0,utilsScript:L}),n.addEventListener("change",function(){a.textContent=""}),e.addEventListener("submit",function(e){e.preventDefault(),a.textContent="",n.value?(sendMessageToServer(""+M+n.value,n.value,!1,!1,!1),t.remove()):a.textContent="Please enter a valid mobile number"}),t}function createMultipleChoiceCard(e,a){var t=document.createElement("div");t.classList.add("multiplechoices");var o=document.createElement("div");t.appendChild(o);var i=document.createElement("button");null!=a&&0<a.MinimumChoices&&i.classList.add("k-hide"),i.textContent=getButtonsText("None of the above")+" ",i.classList.add("btn","primary-button","submit","mt-2");var n=document.createElement("span");return n.classList.add("fa","fa-send"),i.appendChild(n),i.addEventListener("click",function(){submitMultipleChoices(o)}),t.appendChild(i),e&&e.length&&e.forEach(function(e){if(e){var t=document.createElement("div");t.textContent=e.Title,t.classList.add("option-pill"),e.Options.tap&&(t.setAttribute("content",e.Options.tap),t.classList.add("pointer"),t.addEventListener("click",function(){t.classList.toggle("isSelected"),updateMultipleChoiceSubmitContent(i,o,a)}));var n=document.createElement("div");n.classList.add("option-pill-container"),n.appendChild(t),o.appendChild(n)}}),modifyLinksToOpenInNewTab(t),t}function getMultipleChoiceSelection(e){var t=[],n=[];if(e&&e.children)for(var a=e.children,o=0;o<a.length;o++){var i=a[o].children[0];i.classList.contains("isSelected")&&(t.push(i.getAttribute("content")),n.push(i.textContent))}var r={};return r.selected=t.join(),r.display=n.join(),r}function updateMultipleChoiceSubmitContent(e,t,n){var a=getMultipleChoiceSelection(t);e&&a&&(null==n||0==n.MinimumChoices?a.selected?e.textContent=getButtonsText("Submit")+" ":e.textContent=getButtonsText("None of the above")+" ":a.selected&&a.selected.split(",").length>=n.MinimumChoices?(e.textContent=getButtonsText("Submit")+" ",e.classList.remove("k-hide")):e.classList.add("k-hide"))}function submitMultipleChoices(e){var t=getMultipleChoiceSelection(e);t.selected?sendMessageToServer(t.selected,t.display):sendMessageToServer("None of the above",getButtonsText("None of the above"))}function createDropdownCard(e){var t=document.createElement("div");t.classList.add("dropdown");var n=[];e&&e.length&&e.forEach(function(e){if(e&&e.Options.tap){var t=e.Title+":"+e.Options.tap;n.push(t)}});var a=createDropdownElement(n,"");t.appendChild(a),a=converDropdowntToSearchDropDown(a);var o=document.createElement("button");o.textContent=getButtonsText("Submit")+" ",o.classList.add("btn","primary-button","submit","mt-2");var i=document.createElement("span");return i.classList.add("fa","fa-send"),o.appendChild(i),o.addEventListener("click",function(){submitSelectedChoice(a)}),t.appendChild(o),modifyLinksToOpenInNewTab(t),t}function converDropdowntToSearchDropDown(e){var t=e.parentNode,n=document.createElement("div");n.classList.add("dropdown-search"),t.insertBefore(n,e);var a=document.createElement("input");a.classList.add("primary-border"),a.classList.add("pointer"),n.appendChild(a);var o=document.createElement("div");o.classList.add("options"),o.classList.add("smooth-scroll"),o.classList.add("thin-scroll"),o.classList.add("empty-input"),o.classList.add("primary-border"),n.appendChild(o),e.childNodes.forEach(function(e){var t=document.createElement("div");t.classList.add("no-match"),t.setAttribute("data-value",e.value),t.classList.add("primary-hover"),t.classList.add("pointer"),t.innerText=e.innerText,e.value?(o.appendChild(t),t.addEventListener("click",function(e){!function(e){var t=e.target,n=t.parentNode,a=n.previousSibling;a.value=t.innerText;var o=t.getAttribute("data-value");a.setAttribute("data-value",o),t.parentNode.classList.add("empty-input");var i=n.nextSibling;i.classList.add("fa-caret-down"),i.classList.remove("fa-caret-up"),e.stopPropagation(),updateLastActivity(),scrollToEnd(z)}(e)})):a.placeholder=e.innerText}),a.addEventListener("keyup",function(e){showOptions(e.target)}),a.addEventListener("keydown",function(e){showOptions(e.target)}),a.addEventListener("focus",function(e){showOptions(e.target)});var i=document.createElement("span");i.classList.add("fa"),i.classList.add("fa-caret-down"),i.classList.add("icon"),i.classList.add("pointer"),n.appendChild(i),i.addEventListener("focus",function(e){showOptions(e.target.previousSibling.previousSibling)});var r=document.createElement("span");function showOptions(e){e.removeAttribute("data-value");var t=e.nextSibling,n=t.nextSibling.nextSibling;if(e.value){t.classList.remove("empty-input"),n.classList.remove("d-none");for(var a=!1,o=t.getElementsByTagName("div"),i=0;i<o.length;i++)o[i].innerText.toLowerCase().includes(e.value.toLowerCase())?(o[i].classList.remove("no-match"),a=!0):o[i].classList.add("no-match");a||t.classList.add("empty-input")}else{t.classList.remove("empty-input"),n.classList.add("d-none");for(o=t.getElementsByTagName("div"),i=0;i<o.length;i++)o[i].classList.remove("no-match")}var r=t.nextSibling;r.classList.remove("fa-caret-down"),r.classList.add("fa-caret-up"),scrollToEnd(z)}return r.innerText="close",r.classList.add("material-icons-outlined"),r.classList.add("remove-icon"),r.classList.add("pointer"),r.classList.add("d-none"),r.addEventListener("click",function(e){var t=e.target.previousSibling.previousSibling.previousSibling;t.value="",t.focus(),showOptions(t)}),n.appendChild(r),t.removeChild(e),a}function submitSelectedChoice(e){var t=e.value,n="";if(e.options&&e.selectedIndex)n=e.options[e.selectedIndex].text;else if(e.list&&e.list.options)for(var a=0;a<e.list.options.length;a++)e.list.options[a].value==t&&(n=e.list.options[a].innerText);else e.hasAttribute("data-value")&&(t=e.getAttribute("data-value"),n=e.value);t&&(n||(n=t),sendMessageToServer(t,n))}function handleKeyDown(e){e.which===v||e.keyCode===v?e.target.value&&(e.preventDefault(),handleSendButton()):auto_grow(e.target)}function handleSendButton(){if(!zt){var e=q.value;e&&(It=!1,sendMessageToServer(e,e),q.value=""),auto_grow(q)}}function addToChatWindow(e){if(V){var t=document.createElement("div");t.classList.add("col-12"),lt?lt=!1:t.classList.add("mt-2");for(var n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];a.forEach(function(e){t.classList.add(e)}),t.appendChild(e),fitChatWindowBubble(t),V.appendChild(t),window.setTimeout(function(){scrollToEnd(z)},100)}}function fitChatWindowBubble(e){Yt.setFittingClassByText(e)}function toggleAnnouncementVisibility(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];be&&(be.style.display=e?"block":"none")}function showAnnouncement(){toggleAnnouncementVisibility(!0),setAnnouncementTimeout()}function setAnnouncementTimeout(){m=setTimeout(function(){toggleAnnouncementVisibility(!1)},1e4)}function applyWindowStyling(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],a=[],o=isMobileDevice(),i="py-1";if(e){if(isNonEmptyString(e.Announcement)){var r=document.querySelector("#announcementText"),s=document.querySelector("#announcementContainer");be&&s&&r&&(r.innerText=e.Announcement,s.style.borderColor=e.FrameColor,s.style.backgroundColor=e.FrameColor+"7a")}if(isNonEmptyString(e.FontFamily)&&a.push({elementSelector:"#chatWindow",properties:[{property:"font-family",value:"'"+e.FontFamily+"'"}]}),isNonEmptyString(e.BotPosition)&&notifyParent(at.UpdateBotPosition,e.BotPosition),isNonEmptyString(e.FrameColor)){var l=$t.getThemeSettings(e.FrameColor,e.FrameColorGradient);if(l){var d=$t.getThemeSettings("#ffffff","#ffffff");l.backgroundColor?D.style.backgroundColor=l.backgroundColor:D.style.backgroundImage=l.backgroundGradient,D.style.color=l.textColor,j.style.color=l.textColor,j.style.backgroundColor=l.color,checkIfColorIsWhitish(l.color)?(Q.style.borderColor="#f3f3f3",oe.style.setProperty("color","#000000","important"),ne.style.setProperty("color","#000000","important"),ae.style.setProperty("color","#000000","important"),ie.style.setProperty("color","#000000","important"),q.style.borderColor="#f3f3f3"):(Q.style.borderColor=l.color,oe.style.setProperty("color",l.color,"important"),ne.style.setProperty("color",l.color,"important"),ae.style.setProperty("color",l.color,"important"),ie.style.setProperty("color",l.color,"important"),q.style.borderColor=l.color),notifyParent(at.UpdateChatBubbleColor,l.color),notifyParent(at.TextColor,l.textColor),a.push(),a.push({elementSelector:".option-pill:hover",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.buttonBackgroundColorHover,override:!0},{property:"background-color",value:""+l.buttonBackgroundColorHover,override:!0}]},{elementSelector:".option-pill.isSelected",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.buttonBackgroundColorHover,override:!0},{property:"background-color",value:""+l.buttonBackgroundColorHover,override:!0}]},{elementSelector:".option-pill",properties:[{property:"color",value:""+l.buttonColor,override:!0},{property:"border-color",value:""+l.buttonBorderColor,override:!0},{property:"background-color",value:""+l.buttonBackgroundColor,override:!0}]},{elementSelector:".bg-accent",properties:[{property:"background-image",value:""+l.backgroundGradient,override:!0}]},{elementSelector:".text-accent",properties:[{property:"color",value:""+d.textColor,override:!0}]},{elementSelector:".bot-chat-bubble",properties:[{property:"color",value:d.textColor+" !important"}]},{elementSelector:".interactivelist-card:hover",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.colorTo,override:!0},{property:"background-color",value:""+l.colorTo,override:!0}]},{elementSelector:".primary-border",properties:[{property:"border-color",value:l.color+" !important"}]},{elementSelector:".primary-background",properties:[{property:"background-color",value:l.color+" !important"}]},{elementSelector:".primary-color",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".primary-text",properties:[{property:"color",value:l.textColor+" !important"}]},{elementSelector:".primary-button",properties:[{property:"color",value:l.textColor+" !important"},{property:"background-color",value:l.color+" !important"}]},{elementSelector:".style3 .text-center.data-subtitle",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".style3 .user-chat-bubble",properties:[{property:"background-color",value:l.color+" !important"},{property:"color",value:l.textColor+" !important"}]},{elementSelector:".style3 .send-btn",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".style3 #chatWindowHeader",properties:[{property:"background-color",value:l.color+" !important"}]},{elementSelector:".style3 .slick-next:before",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".style3 .slick-prev:before",properties:[{property:"color",value:l.color+" !important"}]},{elementSelector:".primary-hover:hover",properties:[{property:"color",value:""+l.buttonColorHover,override:!0},{property:"border-color",value:""+l.buttonBackgroundColorHover,override:!0},{property:"background-color",value:""+l.buttonBackgroundColorHover,override:!0}]})}}if(isNonEmptyString(e.BubbleBackgroundColor)&&F&&(F.style.backgroundColor=e.BubbleBackgroundColor),isNonEmptyString(e.EnableSpeech)&&window.hasOwnProperty("webkitSpeechRecognition")&&(equalsIgnoreCase(e.EnableSpeech,"true")?showElements(K):hideElements(K)),isNonEmptyString(e.EnableQRFeature)&&(equalsIgnoreCase(e.EnableQRFeature,"true")?(showElements(Y),showElements(J)):(hideElements(Y),hideElements(J))),isNonEmptyString(e.ManualModeAtStart)&&st&&(equalsIgnoreCase(e.ManualModeAtStart,"true")?st.ManualModeAtStart=!0:st.ManualModeAtStart=!1),applyStyle(e.WindowStyle),isNonEmptyString(e.UserPersona)&&(t&&(e.UserPersona=replaceImageLink(e.UserPersona)),updatePersona("user",e.UserPersona,t)),isNonEmptyString(e.BotPersona)&&(t&&(e.BotPersona=replaceImageLink(e.BotPersona)),updatePersona("bot",e.BotPersona,t)),isNonEmptyString(e.FontSize)&&(V.style.fontSize=""+e.FontSize),isNonEmptyString(e.HeaderTextColor)&&(H.style.color=e.HeaderTextColor,W.style.color=e.HeaderTextColor),isNonEmptyString(e.HeaderTitle)&&(e.HeaderTitle===A?(H.innerHTML="&nbsp;",D.classList.contains(i)||D.classList.add(i)):H.textContent=e.HeaderTitle),isNonEmptyString(e.HeaderSubTitle)&&(e.HeaderSubTitle===A?W.innerHTML="&nbsp;":(W.textContent=e.HeaderSubTitle,D&&e.HeaderTitle!==A&&D.classList.contains(i)&&D.classList.remove(i))),isNonEmptyString(e.HeaderFontSize)&&(H.style.fontSize=e.HeaderFontSize),!t&&(equalsIgnoreCase(e.ShowPoweredBy,"true")?ee.classList.remove("d-none"):ee.classList.add("d-none"),e.PoweredBy&&e.PoweredBy.Name&&e.PoweredBy.Website)){var c=document.getElementById("brand-link");c&&(ee.classList.remove("d-none"),c.setAttribute("href",e.PoweredBy.Website),c.innerText=e.PoweredBy.Name)}if(isNonEmptyString(e.PlaceholderText)&&setInputPlaceholderText(e.PlaceholderText),isNonEmptyString(e.BackgroundImage)&&setChatBackgroundImage(e.BackgroundImage),isNonEmptyString(e.BackgroundColor)&&setChatBackgroundColor(e.BackgroundColor),isNonEmptyString(e.UserChatBubbleColor)){var u=$t.getThemeSettings(e.UserChatBubbleColor,e.UserChatBubbleColorGradient);u&&a.push({elementSelector:".user-chat-bubble",properties:[{property:"background-color",value:u.color+" !important"},{property:"color",value:u.textColor+" !important"}]})}if(isNonEmptyString(e.HeaderImage)&&(_.src=e.HeaderImage),isNonEmptyString(e.HeaderShowOnline)&&(equalsIgnoreCase(e.HeaderShowOnline,"true")?showElements(U):hideElements(U)),isNonEmptyString(e.LiveAgentCall)&&equalsIgnoreCase(e.LiveAgentCall,"true")&&equalsIgnoreCase(e.HideMenuInHeader,"false")&&Ct.headerMenu.container&&showElements(Ct.headerMenu.container.parentElement),Et&&(e.DesktopMinimizeBotAtStart=e.DesktopMinimizeBotAtStart||"",e.MobileMinimizeBotAtStart=e.MobileMinimizeBotAtStart||"",e.OpenWindowAfterMilliSeconds||(e.OpenWindowAfterMilliSeconds=0),n||(o?((""==e.MobileMinimizeBotAtStart||equalsIgnoreCase(e.MobileMinimizeBotAtStart,"false")||0<e.OpenWindowAfterMilliSeconds)&&setTimeout(function(){maximizeChatWindow()},e.OpenWindowAfterMilliSeconds),toggleFullScreen()):(""==e.DesktopMinimizeBotAtStart||equalsIgnoreCase(e.DesktopMinimizeBotAtStart,"false")||0<e.OpenWindowAfterMilliSeconds)&&setTimeout(function(){maximizeChatWindow()},e.OpenWindowAfterMilliSeconds))),0<a.length&&injectStyles(a),isNonEmptyString(e.Languages)){var p=e.Languages.trim().split(",");if(p&&0<p.length){var m=getLanguageItems(p);m&&1<=m.length&&(m[0].value,m.forEach(function(e){e.value===Ie&&e.value})),addLanguageDropdown(m)}}if(e.CustomPanelCss){var g=document.createElement("style");g.innerText=e.CustomPanelCss,document.head.appendChild(g)}e.IdleTimeoutSeconds&&(Wt.idleTimeSec=e.IdleTimeoutSeconds,Wt.disconnectOnIdleId&&window.clearInterval(Wt.disconnectOnIdleId),Wt.disconnectOnIdleId=window.setInterval(disconnectOnIdle,1e3*Wt.idleTimeSec))}}function changeMaterialIcon(e){}function changeFontAwesomeIcon(e,t){var n=e.classList,a=!0,o=!1,i=void 0;try{for(var r,s=n[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){var l=r.value;l.startsWith("fa-")&&e.classList.remove(l)}}catch(e){o=!0,i=e}finally{try{!a&&s.return&&s.return()}finally{if(o)throw i}}e.classList.add(t)}function addStyle(e){document.body.classList.remove("style1"),document.body.classList.remove("style3"),document.body.classList.add(e)}function calculateLength(e,t){if(e.textContent){for(var n=0,a=0;a<e.textContent.length;a++){var o=e.textContent.charAt(a);" "==o?n+=4:o==o.toLowerCase()?n+=9:n+=12}var i=1;"style3"==Pt?n<=50?i=3:n<=100&&(i=2):n<=90?i=3:n<=160&&(i=2),t.push(i)}else t.push(-1);return t}function bubbleResize(){var e=document.querySelectorAll(".option-pill-container");if(e&&e.length){var t=[];Array.prototype.forEach.call(e,function(e){t=calculateLength(e,t)});for(var n=3,a=0;a<t.length;){for(var o=t[a],i=t[a],r=!0,s=1;s<o;s++)a+s<t.length?t[a+s]>=i||(r=!1):r&&0<a&&i==n?(o=s,s+=t[a]):r=!1;if(r){var l="option-pill-"+i;for(s=0;s<o;s++)e[a+s].className=e[a+s].className.replace(/option-pill-\d+/g,l);a+=o,i<n&&(n=i)}else t[a]=t[a]-1}}}function applyStyle(e){if(isNonEmptyString(e)){Pt=e;var t=document.querySelectorAll(".fa-fw"),n=["fa-paper-plane","fa-play"],a=Array.from(t).filter(function(e){var t=Array.from(e.classList);return n.some(function(e){return t.includes(e)})});equalsIgnoreCase(e,"style3")?(addStyle(e),changeMaterialIcon("more_horiz"),a.forEach(function(e){changeFontAwesomeIcon(e,"fa-play")}),replaceChatwindowCssWithNewFile("chatwindow_style3"),bubbleResize()):(addStyle(e),changeMaterialIcon("more_vert"),a.forEach(function(e){changeFontAwesomeIcon(e,"fa-paper-plane")}))}}function replaceChatwindowCssWithNewFile(e){var t=document.createElement("link");t.href="./dist/css/"+e+".css",t.rel="stylesheet",document.head.appendChild(t)}function replaceImageLink(e){var t=e;if(isNonEmptyString(e)){var n=e.match(O);if(n&&0<n.length){var a=n[0],o=a.match(R);o&&0<o.length&&(t=e.replace(a,o[0]))}}return t}function chooseColor(e){var t=$t.normalizeColor(e);return t&&$t.getPercievedBrightness(t)>=$t.BRIGHTNESS_THRESHOLD?"#000000ff":e}function setWindowTitle(e){e&&H&&(H.textContent=e)}function setInputPlaceholderText(e){e&&q&&(q.placeholder=e)}function getHeaderImage(){return re&&re.HeaderImage&&"string"==typeof re.HeaderImage?re.HeaderImage:defaultWindowConfig.HeaderImage}function getFrameColor(){return isNonEmptyString(re.FrameColor)?re.FrameColor:ft.FrameColor}function setChatBackgroundImage(e){e&&z&&(z.style.backgroundImage="url("+e+")")}function setChatBackgroundColor(e){isNonEmptyString(e)&&(z.style.backgroundColor=e)}function hideChatWindow(){notifyParent(at.ChatWindowClose),dispatchEventToParent(ot.ChatWindowClose,{source:"userClick"})}function goBackFromChatWindow(){b=null,notifyPortalWindow(at.ChatWindowBack,"user-click"),document.getElementById("chatWindow").classList.add("k-hide"),document.getElementById("chatWindowHeader").style.display="none",document.getElementById("chatWindowBody").style.zIndex="",document.getElementById("chatWindowFooter").style.zIndex="",document.getElementById("headerBackButton").classList.add("k-hide")}function notifyPortalWindow(e,t){var n={type:e,value:t||null};window.postMessage(n,"*")}function maximizeChatWindow(){notifyParent(at.ChatWindowOpen)}function createUserChatBubble(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=document.createElement("div");if(o.classList.add("d-inline-block","px-2","py-2","float-right","user-chat-bubble"),a){var i=document.createElement("img");i.src=a,i.alt="User sent image",i.classList.add("user-sent-image"),i.style.maxWidth="200px",i.style.display="block",i.style.marginTop="5px",o.appendChild(i)}else if(e){var r=document.createElement("p");r.textContent=e,o.appendChild(r)}return n||o.appendChild(getMessageTimestamp(t)),o}function createBotChatBubble(e,t,n,a,o,i,r){var s=7<arguments.length&&void 0!==arguments[7]&&arguments[7],l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null;e||(e="");var d=document.createElement("div");if(d.classList.add("d-inline-block","px-2","py-2","bot-chat-bubble"),d.innerHTML=marked(e),modifyLinksToOpenInNewTab(d),t&&0<t.length){var c=renderCards(t,n,a,i,r);c&&d.appendChild(c),n&&(n!==et.MediumButton&&n!==et.VerticalCard||d.classList.add("chat-bubble-fullwidth"),n===et.File&&d.classList.add("min-width-50"),n===et.Location&&(d.classList.add("min-width-50"),d.classList.add("chat-bubble-flexible-width")))}if(o){var u=pe;if(!u){var p=(isLocalEnvironment()?_e.LOCAL:_e.PROD)+"/create/bot";me&&me.startsWith(p)&&(u=!0)}if(u&&T){var m=document.createElement("div");m.classList.add("pointer","intent-edit");var g=(isLocalEnvironment()?_e.LOCAL:_e.PROD)+"/settings/agent-builder?orgid="+T.OrganizationId+"&botid="+T.BotId+"&xpath="+o;m.innerHTML='<span class="fa fa-pencil intent-edit-icon"></span>',m.addEventListener("click",function(){var e={url:g,openInSamePage:!1};notifyParent(at.NavigateToPage,e)}),d.appendChild(m)}}if(s&&l&&Vt){var f=createMessageFeedbackContainer(l);f&&d.appendChild(f)}if("Agent has left the conversation."==e&&l&&h){var v=createAgentChatFeedbackContainer(l);v&&d.appendChild(v)}return d}function convertToBotChatBubble(e){return e&&e.classList.add("d-inline-block","px-2","py-2","bot-chat-bubble"),e}function modifyLinksToOpenInNewTab(e){if(e){var t=Array.from(e.querySelectorAll("a"));t&&0<t.length&&t.forEach(function(e){e.target||(e.target="_blank")})}}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}function isString(e){return e&&"string"==typeof e}function isNonEmptyString(e){return isString(e)&&0<e.trim().length}function getCurrentState(){return{botName:ce,lastConversationId:de,conversationLanguage:Ie,timestamp:new Date,botUserWebContext:st,messages:pe?[]:we}}function getCurrentSessionState(){return{conversationId:de,isMinimized:ut,menu:Ct.headerMenu.content,userPersona:dt,botName:ce,expandType:ne&&ne.getAttribute("data-toggle")||null,timestamp:new Date,pageUrl:me,queryUserDenied:p}}function restoreUserIdIfExists(){if(xe){var e=window.localStorage.getItem(C);if(e){se=e;var t=window.localStorage.getItem(S);le=!(!t||"true"!==t)}}}function restoreState(e,t){e&&(e.timestamp&&(e.timestamp=new Date(e.timestamp)),e.lastConversationId&&e.lastConversationId!==de&&(differenceInMinutes(e.timestamp,new Date)<We?(de=e.lastConversationId,notifyParent(at.Initialize,de),e.messages&&0<e.messages.length&&(restoreChatHistory(e.messages,t),window.setTimeout(function(){scrollToEnd(z)},0))):(we=[],st.SessionCount?st.SessionCount=st.SessionCount+1:st.SessionCount=1)),e.conversationLanguage&&(Ie=e.conversationLanguage))}function restoreSessionState(e){if(e&&e.botName&&e.botName===ce){if(e.conversationId&&(de=e.conversationId),e.userPersona&&updatePersona("user",e.userPersona),e.expandType)ne.getAttribute("data-toggle")!==e.expandType&&toggleFullScreen();e.isMinimized||!1===ut||maximizeChatWindow(),renderHeaderMenu(e.menu)}}function restoreChatHistory(e,t){t||e.forEach(function(e){if(e.message)if(e.isUserMessage){"user"!==b&&addSenderDetails("user",e.messageTimestamp,!0);var t=null;e&&(t=e.imageData),addToChatWindow(createUserChatBubble(e.displayMessage?e.displayMessage:e.message,e.messageTimestamp,!0,t)),b="user"}else{if(b!==e.message.DisplayName&&addSenderDetails(e.message.DisplayName,e.messageTimestamp),e.customMessage&&e.customMessage.messageType===it.Form&&isArray(e.customMessage.values)){var n=shallowClone(e.customMessage.values);n.fields.forEach(function(e){e&&isNonEmptyString(e.validationPattern)&&(e.validationPattern=new RegExp(e.validationPattern))}),b!==e.customMessage.displayName&&addSenderDetails(e.customMessage.displayName,e.messageTimestamp),renderForm(n)}(isObject(e.message)||isNonEmptyString(e.message))&&renderMessage(e.message,!0),b=e.message.DisplayName}}),0<(we=e||[]).length&&!isNaN(we[we.length-1].id)&&(St=we[we.length-1].id+1||St)}function saveStateLocally(){if(xe){window.localStorage.setItem(C,se||""),le?window.localStorage.setItem(S,"true"):window.localStorage.removeItem(S);var e=getCurrentState();window.localStorage.setItem(ye,JSON.stringify(e)),saveSessionState()}else console.warn("[Kenyt.AI] Unable to store state, Cookies are disabled")}function saveSessionState(){var e=getCurrentSessionState();window.sessionStorage.setItem(he,JSON.stringify(e))}function retrieveLocalStateIfExists(){if(xe){var e=window.localStorage.getItem(ye);return e?JSON.parse(e):e}return null}function retrieveSessionStateIfExists(){if(xe){var e=window.sessionStorage.getItem(he);return e?JSON.parse(e):e}return null}function getParentUrl(){var e=getUrlParam("origin")||document.referrer;return e||console.warn("Cannot retrieve parent URL"),e}function isLocalEnvironment(){var e=window.location.href;return 0<=e.indexOf("http://localhost")||e.startsWith("file:///")}function isNgrokEnvironment(){return 0<=window.location.href.indexOf("ngrok-free.app")}function isIOSDevice(){var t=window.navigator.platform||"",e=window.navigator.userAgent||"",n=["iPhone","iPad","iPod"].some(function(e){return 0<=t.indexOf(e)}),a="MacIntel"===t&&1<window.navigator.maxTouchPoints,o=/iPad|iPhone|iPod/.test(e);return n||o||a}function detectAppName(){return isLocalEnvironment()?De:isNgrokEnvironment()?"https://"+window.location.hostname+Fe:Fe}function isDate(e){return e&&!isNaN(e.getTime())}function disableLoggingIfProduction(e){}function createForm(n,r,t,e){var a=n.tag||"div",s=document.createElement(a);s.classList.add("form"),s.style.backgroundColor=n.formBgColor||"#ffffff",checkIfBackgroundDark(s.style.backgroundColor)&&(s.style.color="White");var o=document.createElement("span"),i=document.createElement("p");o.classList.add("h6","font-weight-bold"),i.classList.add("m-0"),o.textContent=null!=r.Title?r.Title:n.title,i.textContent=null!=r.Description?r.Description:n.description,s.appendChild(rowContainer(["mt-1"],columnContainer(["text-center"],o,i)));var l=document.querySelector(".portal-header-title");if(l instanceof HTMLElement&&(l.textContent=n.description),r.Slots){var d=r["Appointment Date"];d||(d={}),d.datetimepickersettings||(d.datetimepickersettings={}),d.datetimepickersettings.beforeShowDay=function(e){var t=Kt.getDateKeys(e),n=!1;return t.every(function(e){return!r.Slots[e]||(n=0<r.Slots[e].length,!1)}),[n,""]},r["Appointment Date"]=d;var c=r["Appointment Time"];c||(c={}),c.datatype="dropdown",c.need="Appointment Date",c.beforeShow=function(e){var n=this,t=Kt.getDateKeys(e),a=c.value;t.every(function(e){return!r.Slots[e]||(a=r.Slots[e],!1)}),a||(a="10 AM, 11 AM, 12 PM, 1 PM, 2 PM, 3 PM, 4 PM, 5 PM, 6 PM, 7 PM, 8 PM"),this.inputElementRef.innerHTML="",a.forEach||(a=a.split(",")),a.forEach(function(e){var t=document.createElement("option");t.innerText=e,t.value=e,n.inputElementRef.appendChild(t)})},r["Appointment Time"]=c}var u=void 0,p="";n.fields.forEach(function(i){var e=createInputRowFromField(i,r),a=e.colEle;if("submit"===e.inputElementRef.type&&(p=e.inputElementRef.placeholder),a&&"true"!==i.hide){if(i.inputElementRef=e.inputElementRef,i.inputContainer=e.inputContainer,i.feedbackElementRef=e.feedbackElementRef,i.takeHalfRow&&a.classList.add("col-6"),u)u.appendChild(a),s.appendChild(u),u=null;else{var t=rowContainer(["mt-2"],a);s.appendChild(t),i.takeHalfRow&&(u=t)}if(i.need&&n.fields.forEach(function(o){if(i.need===o.field&&o&&o.inputElementRef){if("datetime"===o.datatype){!i.beforeShow&&o.Slots&&(i.beforeShow=function(e){var n=this,t=Kt.getDateKeys(e),a=i.value;t.every(function(e){return!o.Slots[e]||(a=o.Slots[e],!1)}),a||(a="10 AM, 11 AM, 12 PM, 1 PM, 2 PM, 3 PM, 4 PM, 5 PM, 6 PM, 7 PM, 8 PM"),this.inputElementRef.innerHTML="",a.forEach||(a=a.split(",")),a.forEach(function(e){var t=document.createElement("option");t.innerText=e,t.value=e,n.inputElementRef.appendChild(t)})});var t=o.datetimepickersettings.onChangeDateTime;o.datetimepickersettings.onChangeDateTime=function(e){t&&t(e),i.beforeShow&&i.beforeShow(e),showElements(i.inputContainer),scrollToEnd(z)}}else o.inputElementRef.addEventListener("change",function(){showElements(i.inputContainer),scrollToEnd(z)},!1);hideElements(i.inputContainer)}}),i.addMore){i.extraInputs=i.extraInputs||[];var o=document.createElement("button");o.textContent=" + ",o.classList.add("btn","primary-button","add-more-btn"),o.addEventListener("click",function(e){e.preventDefault();var t=createInputRowFromField(i,r),n=rowContainer(["mt-2"],t.colEle);a.parentNode.parentNode.insertBefore(n,a.parentNode.nextSibling),i.extraInputs.push({inputElementRef:t.inputElementRef,feedbackElementRef:t.feedbackElementRef}),4==i.extraInputs.length&&hideElements(o)}),a.appendChild(o)}}});var m=document.createElement("button");m.textContent="Cancel",m.classList.add("btn","btn-secondary"),e&&m.addEventListener("click",function(){e()});var g=document.createElement("button");return g.textContent=" "+(p||n.submit||getButtonsText("Submit"))+" ",g.classList.add("btn","primary-button"),e||g.classList.add("mr-2"),n.onSubmit?s.onsubmit=n.onSubmit:t&&g.addEventListener("click",function(e){n.OnSubmit?t(e,n.fields,n.submit,n.submitType,!0,n.OnSubmit,p):t(e,n.fields,n.submit,n.submitType,!0,"",p)}),e?s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],g,m))):s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],g))),s}function createInputRowFromField(t,n,e){if(n[t.field]){if(n[t.field].value&&(t.value=n[t.field].value),n[t.field].isMandatory&&(t.isMandatory=n[t.field].isMandatory),n[t.field].need&&(t.isMandatory=n[t.field].need),n[t.field].beforeShow&&(t.beforeShow=n[t.field].beforeShow),n[t.field].telSettings)if(t.telSettings)Object.keys(n[t.field].telSettings).forEach(function(e){t.telSettings[e]=n[t.field].telSettings[e]});else t.telSettings=n[t.field].telSettings;if(n[t.field].datetimepickersettings)if(t.datetimepickersettings)Object.keys(n[t.field].datetimepickersettings).forEach(function(e){t.datetimepickersettings[e]=n[t.field].datetimepickersettings[e]});else t.datetimepickersettings=n[t.field].datetimepickersettings;n[t.field].errorMessage&&(t.errorMessage=n[t.field].errorMessage),n[t.field].validationPattern&&(t.validationPattern=n[t.field].validationPattern),n[t.field].image&&(t.image=n[t.field].image),n[t.field].imageClass&&(t.imageClass=n[t.field].imageClass)}var a=document.createElement("label"),o=document.createElement("input"),i=document.createElement("div");if(t.dataType&&(t.datatype=t.dataType),"dropdown"===t.datatype){t.options=t.options||t.value;var r=t.displayName||t.field;(o=createDropdownElement(t.options,r)).name=t.field}else o.type=t.datatype,t.placeholder?a.innerHTML=t.placeholder:a.textContent=t.displayName||t.field,o.placeholder=t.placeholder||t.displayName||t.field,o.placeholder=getButtonsText(o.placeholder),t.value&&(o.value=t.value);t.name&&(o.name=t.name),o.classList.add("form-control"),o.style.fontStyle="inherit",t.readonly&&o.setAttribute("readonly","readonly"),t.min&&(o.min=t.min),t.max&&(o.max=t.max),i.classList.add("invalid-feedback","d-none"),i.textContent=t.errorMessage;var s=void 0,l=void 0,d=void 0;if("money"===t.datatype){(d=document.createElement("div")).classList.add("currency-container");var c=createDropdownElement(tt,"");c.style.width="25%",c.style.border="1px solid #ced4da",c.value="INR",d.appendChild(c),d.appendChild(o),o.type="number",t.prefixAttribute=c}if(t.image){var u=createIconElement(t.image);if(u){var p="icon-container";t.imageClass&&(p=p+","+t.imageClass),p=p.split(","),o.placeholder&&u.setAttribute("title",o.placeholder);var m=genericContainer(p,u);l=genericContainer(["input-container"],m,d||o)}}if(l||(l=d?genericContainer(["input-container"],d):genericContainer([],o)),"checkbox"===t.datatype?(o.name=t.field,o.classList.remove("form-control"),equalsIgnoreCase(t.value,"true")&&(o.checked=!0),(s=columnContainer([],l,a,i)).classList.add("checkbox"),i.style.display="block"):s=t.useLabel?columnContainer([],a,l,i):columnContainer([],l,i),n&&n.Mandatory&&n.Mandatory.includes(t.field)&&(t.isMandatory=!0),"tel"===t.datatype&&t.validationSource===k){var g="IN";n&&n.CountryCode&&(g=n.CountryCode);var f={geoIpLookup:function(e){e(g)},hiddenInput:"full_number",initialCountry:"auto",placeholderNumberType:"MOBILE",preferredCountries:["in","us"],separateDialCode:!0,utilsScript:L};if(t.telSettings)Object.keys(t.telSettings).forEach(function(e){f[e]=t.telSettings[e]});o.value||(o.setAttribute("type","number"),o.setAttribute("onkeydown","javascript: return event.keyCode == 69 ? false : true"));var v=window.intlTelInput(o,f);o.style.paddingLeft="85px",i.style.display="block",t.pluginObj=v}return o.addEventListener("change",handleFormInputChange),{colEle:s,inputElementRef:o,inputContainer:l,feedbackElementRef:i}}function createDropdownElement(e,t){var a=document.createElement("select");if(e){e.forEach||(e=e.split(","));var n=document.createElement("option");n.innerText=t||"Please select",n.value="",a.appendChild(n),e.forEach(function(e){var t=document.createElement("option"),n=e.split(":");t.value=1<n.length?n[1]:n[0],t.innerText=n[0],a.appendChild(t)})}return a}function handleFormInputChange(e){if(window.KENYT_API&&window.KENYT_API.onFormInputChange){var t={event:e,state:window.KENYT_API};window.KENYT_API.onFormInputChange(t)}}function rowContainer(e){e.push("row");for(var t=arguments.length,n=Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return genericContainer.apply(void 0,[e].concat(n))}function getButtonsText(e){var t=e;return e&&Nt&&Nt[e]&&(t=Nt[e]),t}function columnContainer(e){e.push("col");for(var t=arguments.length,n=Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return genericContainer.apply(void 0,[e].concat(n))}function genericContainer(e){var t=document.createElement("div");e.forEach(function(e){return t.classList.add(e)});for(var n=arguments.length,a=Array(1<n?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return a.forEach(function(e){return t.appendChild(e)}),t}function hideElements(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e&&!e.classList.contains("d-none")&&e.classList.add("d-none")})}function showElements(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e&&e.classList.contains("d-none")&&e.classList.remove("d-none")})}function setFormFieldAsValid(e){var t=e.inputElementRef;t&&(t.classList.contains("is-invalid")?replaceClass(t,"is-invalid","is-valid"):t.classList.add("is-valid")),hideElements(e.feedbackElementRef)}function setFormFieldAsInvalid(e){var t=e.inputElementRef;t&&(t.classList.contains("is-valid")?replaceClass(t,"is-valid","is-invalid"):t.classList.add("is-invalid")),showElements(e.feedbackElementRef)}function convertToCSV(t){var n=[];return t&&"object"===(void 0===t?"undefined":a(t))&&Object.keys(t).forEach(function(e){n.push(e+"::"+t[e])}),n.join(", ")}function notifyParent(e,t){var n={type:e,value:t||null};window.parent.postMessage(n,"*")}function notifyParentAndListenCallback(e,t,n,a){var o={type:e,value:t||null},i=!1;function handleMessage(e){e&&e.data&&e.data.type===at.SetCustomContext&&(window.removeEventListener("message",handleMessage),i||(a(e.data),i=!0)),i||(window.removeEventListener("message",handleMessage),a())}if("true"===n){window.addEventListener("message",handleMessage);setTimeout(function(){i||(window.removeEventListener("message",handleMessage),a(),i=!0)},3e3)}else a();window.parent.postMessage(o,"*")}function notifyInFrameWindow(e,t){var n={type:e,value:t||null};window.parent.postMessage(n,"*");var a=document.querySelector("#kenytInWindow").contentWindow;if(a){var o={type:at,value:value};a.postMessage(o,"*")}}function getCurrentTimeString(){var e=new Date,t=e.getHours()%12;return 0===t&&(t=12),t+":"+("0"+e.getMinutes()).slice(-2)+" "+(12<=e.getHours()?"PM":"AM")}function getMessageTimestamp(e){var t=document.createElement("span");return t.classList.add("float-right","text-muted","message-timestamp"),t.innerHTML=e||getCurrentTimeString(),t}function scrollToEnd(e){e&&(e.scrollTop=e.scrollHeight)}function notifyUnreadMessages(e){ut&&(e&&(e=marked(e)),notifyParent(at.UnreadMessage,e))}function injectStyles(e){if(e&&0<e.length){var n="";e.forEach(function(e){var t="";e.properties&&(e.properties.forEach(function(e){t+=e.property+":"+e.value+" "+(e.override?"!important":"")+";"}),n+=e.elementSelector+"{"+t+"}")}),$("<style>"+n+"</style>").appendTo("head")}}function sendSuspendedMessagesIfAny(){bt&&0<bt.length&&(bt.forEach(function(e){e.invokeType?l.invoke(e.invokeType,e.botRequest):makeBotRequest(e.botRequest,e.viewRef,e.displayText,e.skipHistory,e.count)}),bt=[])}function testLocalStorage(){var e="__feature_test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}function notifyConnectionIssues(e,t){var n=document.querySelector("#errorbar");if(n){e=e||"Lost connection due to inactivy. ",t||(e+=' <span class="fa fa-spin fa-spinner fa-pulse"></span>'),n.innerHTML=e;var a=new Date;if(gt&&gt.pageStartAt)10<(a.valueOf()-gt.pageStartAt.valueOf())/1e3?showElements(n):console.log(e)}}function clearConnectionIssues(){var e=document.querySelector("#errorbar");e&&(hideElements(e),e.innerHTML="")}function sendTrackingUpdate(e){if(e&&!Mt){for(var t=0;t<e.length;t++)e[t].UserId=se,t===e.length-1&&(e[t].EndTime=new Date);l.invoke("TrackingUpdate",se,ce,e).done(function(e){e||trackError({message:"Tracking update returned false"},!1)}).fail(function(e){trackError({message:"Tracking update failed: "+e},!1)}),Mt=!0}}function isMobileDevice(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function eventData(e,t,n){return{event_category:e||null,event_label:t||null,value:n||null}}function changeConversationLanguage(e,t){isNonEmptyString(e)&&(Ie=e,Ee&&(Ee.lang=e),0<we.length&&(t||sendMessageToServer("start conversation",null,!1,!0)),gtag("event","language_change",eventData("user_interaction",null,e)),Q&&(Q.textContent=e.substr(0,2).toUpperCase()))}function requestLanguageChange(e,t){t||(t=!1);var n={UserId:se,ConversationId:de,BotId:T?T.BotId:0,LanguageCode:e,PreventHiMessage:t};Se.isConnected?l.invoke("ChangeChatLanguage",n):(console.warn("[Kenyt.AI] Connection not yet initiated, suspending message.."),suspendMessage(n,null,!1,!0,"ChangeChatLanguage"),initializeServerConnection())}function getLanguageItems(e){var n=[];return e&&0<e.length&&e.forEach(function(t){if(isNonEmptyString(t)){var e=qe.find(function(e){return e.value===t.trim().toLowerCase()||e.value===t.trim()});e?n.push(e):console.warn("ignoring Unknown language code: "+t)}}),n}function addLanguageDropdown(e){var a=document.querySelector("#languageMenu");if(e&&a){for(;a.hasChildNodes();)a.removeChild(a.firstChild);if(e.length<=1)hideElements(Q);else{showElements(Q);var t=document.createElement("h6");t.classList.add("dropdown-header"),t.textContent="Choose language",a.appendChild(t),e.forEach(function(t){var n=document.createElement("button");n.textContent=t.displayText?t.displayText:t.text,n.addEventListener("click",function(){requestLanguageChange(t.value);var e=Array.from(a.querySelectorAll(".dropdown-item.active"));e&&0<e.length&&e.forEach(function(e){return e.classList.remove("active")}),n.classList.add("active")}),n.classList.add("dropdown-item"),a.appendChild(n)})}}}function updateSession(e){e.setNewUser&&(de=se="",saveStateLocally(),sendMessageToServer("start conversation",null,!1))}function restartSession(t){var e=$e+"?botId="+ce,n=new XMLHttpRequest;n.open("POST",e,!0),n.setRequestHeader("Content-type","application/json");var a={IsTest:pe,SessionUserId:se,QueryClientUserId:ue,ConversationId:t.NewConversationId,ConversationLanguage:"",TimezoneOffsetMinutes:-1*(new Date).getTimezoneOffset(),SourceUrl:me,TriggerAutoMessage:!0,AutoMessageText:t.AutoMessageText,InitializeConnection:!0,ConversationContext:ge},o=JSON.stringify(a);n.onload=function(e){t.ClearWindow&&clearChat(),handleLoadChatWindowResponse(e)},n.send(o)}function toggleFullScreen(){var e=ne.getAttribute("data-toggle"),t=ne.querySelector("span");notifyParent(at.ToggleFullScreen,e),"maximize"===e?(ne.setAttribute("data-toggle","minimize"),t&&replaceClass(t,"fa-window-maximize","fa-window-minimize")):(ne.setAttribute("data-toggle","maximize"),t&&replaceClass(t,"fa-window-minimize","fa-window-maximize")),saveStateLocally()}function addSenderDetails(e,t,n){if(isNonEmptyString(e)&&isNonEmptyString(t)){var a=document.createElement("div"),o=document.createElement("span"),i=document.createElement("span");if(o.textContent=e,o.classList.add("persona"),i.textContent=""+t,i.classList.add("timestamp","mx-1"),"user"===e||"bot"===e){var r=document.createElement("img"),s="bot"===e?ct:dt,l="bot"===e?"bot-persona":"user-persona",d=document.createElement("span");"bot"===e?d.classList.add("fa","fa-robot"):d.classList.add("fa","fa-user"),o.textContent=s.name,o.classList.add(l),r.classList.add(l),isNonEmptyString(s.imageUrl)?(r.src=s.imageUrl,r.alt=s.name+" avatar",d.classList.add("d-none")):(r.classList.add("d-none"),r.alt=""),r.addEventListener("error",function(){r.classList.add("d-none"),console.warn("Image not found: "+imageUrl)}),15==ce&&a.appendChild(d),a.appendChild(r)}a.appendChild(o),a.appendChild(i),a.classList.add("message-sender","px-3","w-100","mt-2"),n&&a.classList.add("text-right"),V.appendChild(a),lt=!0}}function differenceInMinutes(e,t){if(isDate(e)&&isDate(t)){var n=Math.abs(e.valueOf()-t.valueOf());return Math.floor(n/1e3/60)}return NaN}function forceFullHeight(){notifyParent(at.ForceFullHeight)}function replaceClass(e,t,n){return!!(e&&t&&n&&e.classList.contains(t))&&(e.classList.remove(t),e.classList.add(n),!0)}function updatePersona(e,t,n){if(isNonEmptyString(e)&&isNonEmptyString(t)){var a=t.match(R),o=a&&0<a.length?a[0]:null,i=void 0;o&&(t=" "+t.replace(o,"").trim());var r={name:t,imageUrl:o};if(equalsIgnoreCase(e,"bot")?(ct=r,i="bot-persona"):equalsIgnoreCase(e,"user")&&(dt=r,i="user-persona"),!n&&isNonEmptyString(i)){var s=Array.from(V.querySelectorAll("span."+i));Array.from(V.querySelectorAll("img."+i)).forEach(function(e){isNonEmptyString(r.imageUrl)?(e.src=r.imageUrl,e.classList.remove("d-none")):e.classList.add("d-none")}),s.forEach(function(e){e.textContent=r.name})}}}function createIconElement(e){var t=null;if(e)if(e.startsWith("icon:")){var n=e.substr(5);n&&(t=document.createElement("span")).classList.add("fa","fa-"+n)}else e.startsWith("fa-")&&(t=document.createElement("span")).classList.add("fa",""+e);return t}function equalsIgnoreCase(e,t){return isString(e)&&isString(t)&&e.toLowerCase()===t.toLowerCase()}function parseWindowConfig(e){var t={};if(e)for(var n=e.split(";"),a=0;a<n.length;a++){var o=n[a];if(o){var i=o.split("=");if(1<i.length){var r=i[0].trim(),s=i[1].trim();t[r]=s}}}return t}function renderForm(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(e){jt.sanitizeFormTemplate(e);var o=createForm(e,t,n=n||handleFormValues);if(a)return o;var i=createBotChatBubble();i.classList.add("w-95"),i.appendChild(o),addToChatWindow(i),e.fields.forEach(function(e){e.afterAppend&&e.afterAppend()})}else console.warn("Invalid form"),console.warn(e)}function getFormSettings(e){var t=[];return e&&(t=JSON.parse(e)),t}function addFormToChatHistory(e,t){var n=shallowClone(e);n.fields.forEach(function(e){e&&e.validationPattern&&isRegExp(e.validationPattern)&&(e.validationPattern=e.validationPattern.source)}),we.push({id:St++,isUserMessage:!1,message:" ",messageTimestamp:getCurrentTimeString(),displayMessage:null,customMessage:{messageType:it.Form,values:n,displayName:t}})}function clearChatWindow(){if(V)for(var e=V.childElementCount;1<e;){var t=V.lastElementChild;V.removeChild(t),e-=1}}function clearChat(){we=[],b=null,clearChatWindow(),ht=[],saveStateLocally()}function isObject(e){return e&&"object"===(void 0===e?"undefined":a(e))}function isFunction(e){return e&&"function"==typeof e}function isArray(e){return isObject(e)&&e instanceof Array}function isRegExp(e){return isObject(e)&&e instanceof RegExp}function isEmpty(e){return 0===Object.keys(e).length}function shallowClone(t){var n=void 0;return isArray(t)?(n=[],t.forEach(function(e){n.push(shallowClone(e))})):isFunction(t)||(isObject(t)?(n={},Object.keys(t).forEach(function(e){n[e]=shallowClone(t[e])})):n=t),n}function handleAgentJoin(e,t){addToChatWindow(createTextSpan("⛊ You are now chatting with "+(t||e||"Agent")),"text-strip")}function handleAgentExit(e,t){addToChatWindow(createTextSpan("⛊ "+(t||e||"Agent")+" has left the conversation"),"text-strip")}function createTextSpan(e){var t=document.createElement("span");return t.textContent=e,t}function deleteChild(e){if(e)for(var t=e.lastElementChild;t;)e.removeChild(t),t=e.lastElementChild}function handleSpeechButton(){Ee&&(Ee.abort(),Ee.start(),gtag("event","Button_Speech_Start",eventData("user_interaction",null,null)))}function handleCallButton(){sendMessageToServer("Caller form","Contact Agent",!1,!1,!1)}function onStopSpeechRecognition(){Ee.stop(),gtag("event","Button_Speech_Stop",eventData("user_interaction",null,null))}function speakText(e){if(window.speechSynthesis){var t=new SpeechSynthesisUtterance(e);t.lang=Ie+"-IN",t.pitch=1,t.rate=1,t.volume=1,speechSynthesis.paused&&speechSynthesis.resume(),window.speechSynthesis.speak(t)}}function getDateValue(e,t,n){var a=new Date,o=String(a.getDate()+e).padStart(2,"0"),i=String(a.getMonth()+t+1).padStart(2,"0");return a=String(a.getFullYear()+n)+"-"+i+"-"+o}function getBrowserInformation(){window.navigator||(window.navigator={});var e=window.navigator.userAgent.toLowerCase(),t="";t=0<=e.indexOf("windows")?"Windows":0<=e.indexOf("linux")?"Linux":0<=e.indexOf("mac")?"macOS":0<=e.indexOf("blackberry")?"BlackBerry":0<=e.indexOf("android")?"Android":0<=e.indexOf("iphone")||0<=e.indexOf("ipad")?"iOS":"unknown";var n="Desktop";return isMobileDevice()&&(n="Mobile"),{Browser:window.navigator.browserInfo||"",OperatingSystem:t,Referrer:pt.pageReferrer||"",Device:n,RawUserAgent:window.navigator.userAgent||"",PageUrl:getParentUrl()||"",PageTitle:pt.pageTitle||""}}function getContactFormTemplate(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=[{field:"Name",datatype:"text",errorMessage:"please enter a valid name",isMandatory:!1,image:"icon:user"},{field:"Email",datatype:"email",errorMessage:"please enter a valid email address",validationPattern:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,isMandatory:!1,image:"icon:envelope"},{field:"Mobile",datatype:"tel",errorMessage:"please enter a valid phone number",validationSource:k,isMandatory:!1,image:"icon:phone"}],n={title:getButtonsText("Contact Information"),description:getButtonsText("Please enter your contact details"),fields:t};if(e){var a=JSON.parse(e);a.OnSubmit&&(n.OnSubmit=a.OnSubmit)}return n}function getTemplate(e){var t=void 0,n=document.querySelector("#"+e);return n&&(t=document.importNode(n.content.firstElementChild,!0)),t}function getUploadFormTemplate(){return{title:"Please upload your file(s)",description:"",fields:[{field:"File",datatype:"file",name:"file",errorMessage:"please select a valid file",isMandatory:!0,addMore:{limit:5}}],tag:"form"}}function dispatchEventToParent(e,t){var n={EventName:e,EventData:t||null};notifyParent(at.CustomEventDispatch,n)}function suspendMessage(e,t,n,a,o,i){bt||(bt=[]),bt.push({botRequest:e,viewRef:t,displayText:n,skipHistory:a,invokeType:o,count:i})}function isSafariBrowser(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function getlocaltime(){return new Date}function get2_DigitFormatting(e){return("0"+e).slice(-2)}function chatwindowHeaderTitleFix(){document.getElementById("header-content").offsetWidth?H.style.whiteSpace="nowrap":window.setTimeout(function(){chatwindowHeaderTitleFix()},1e3)}var jt={getFormDetailsFromCommand:function(e){var t,n,a;switch(e.Name){case x.APPOINTMENT_FORM.Trigger:n=(new Date).getTimezoneOffset(),a=Math.abs(n),o={title:"Select Appointment Date and Time UTC"+(n=(n<0?"+":"-")+("00"+Math.floor(a/60)).slice(-2)+":"+("00"+a%60).slice(-2)),description:"",fields:[{field:"Appointment Date",datatype:"datetime",errorMessage:"please select a valid date",isMandatory:!0,readonly:!0,image:"icon:calendar"},{field:"Appointment Time",datatype:"dropdown",errorMessage:"please select a valid time",isMandatory:!0,value:["10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM"],need:"Appointment Date",image:"icon:clock-o"}]},t=getFormSettings(e.Value);break;case x.CONTACT_FORM.Trigger:o=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=[{field:"Name",datatype:"text",placeholder:"Your Name",errorMessage:"please enter a valid name",isMandatory:!1,image:"icon:user"},{field:"Email",datatype:"email",placeholder:"Email Address",errorMessage:"please enter a valid email address",validationPattern:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,isMandatory:!1,image:"icon:envelope"},{field:"Mobile",datatype:"tel",placeholder:"Mobile Number",errorMessage:"please enter a valid phone number",validationSource:k,isMandatory:!1,image:"icon:phone"}],n={title:getButtonsText("Contact Information"),description:getButtonsText("Please enter your contact details"),fields:t};if(e){var a=JSON.parse(e);a.OnSubmit&&(n.OnSubmit=a.OnSubmit)}return n}(e.Value),t=getFormSettings(e.Value);break;case x.ADDRESS_FORM.Trigger:o={title:"Address Information",description:"Please enter your address details",fields:[{field:"Address Line 1",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!0},{field:"Address Line 2",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!1},{field:"City",datatype:"text",errorMessage:"Please enter a valid City",isMandatory:!0,takeHalfRow:!0},{field:"State",datatype:"text",errorMessage:"please enter a valid State",isMandatory:!0,takeHalfRow:!0},{field:"Country",datatype:"text",errorMessage:"please enter a valid Country",isMandatory:!0,takeHalfRow:!0},{field:"Zip Code",datatype:"text",errorMessage:"Please enter a valid Zip Code",validationPattern:/^[1-9][0-9]{5}$/,isMandatory:!0,takeHalfRow:!0}],submit:"address form submission",submitType:"values"},t=getFormSettings(e.Value);break;case x.GENERIC_FORM.Trigger:var o;e.Value&&(o=JSON.parse(e.Value))&&(t=getFormSettings(o.settings))}return{template:o,setttings:t}},sanitizeFormTemplate:function(e){e&&e.fields&&e.fields.forEach(function(a){if(a.dataType&&(a.datatype=a.dataType),a.datatype)if("email"===a.datatype)a.validationPattern||(a.validationPattern=Ge.EMAIL_VALIIDATION_PATTERN);else if("tel"===a.datatype)a.validationSource||(a.validationSource=Ge.PHONE_VALIDATION_SOURCE);else if("url"===a.datatype)a.validationSource||(a.validationPattern=Ge.URL_VALIIDATION_PATTERN,a.antiValidationPattern=Ge.EMAIL_VALIIDATION_PATTERN);else if("datetime"===a.datatype){if(a.datetimepickersettings){var t={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};Object.keys(t).forEach(function(e){a.datetimepickersettings[e]||(a.datetimepickersettings[e]=t[e])})}else a.datetimepickersettings={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};a.Slots&&(a.datetimepickersettings.beforeShowDay=function(e){var t=Kt.getDateKeys(e),n=!1;return t.every(function(e){return!a.Slots[e]||(n=0<a.Slots[e].length,!1)}),[n,""]}),a.readonly=!0,a.image="icon:calendar",a.afterAppend=function(){this.inputElementRef&&($(this.inputElementRef).datetimepicker(this.datetimepickersettings),this.inputContainer&&this.datetimepickersettings&&this.datetimepickersettings.inline&&this.inputContainer.classList.add("inline-datetime"))}}})}},Kt=function(){function getFullDateKey(e){var t=e.getMonth()+1,n=e.getDate();return[e.getFullYear(),(9<t?"":"0")+t,(9<n?"":"0")+n].join("-")}return{getDateKeys:function(e){var t,n,a,o,i=[];return e&&(getFullDateKey(e)==getFullDateKey(new Date)?i.push("today"):(i.push(getFullDateKey(e)),i.push((a=(n=e).getMonth()+1,o=n.getDate(),["****",(9<a?"":"0")+a,(9<o?"":"0")+o].join("-"))),i.push(["****","**",(9<(t=e.getDate())?"":"0")+t].join("-")),i.push(e.getDay()))),i}}}(),$t=function(){var i=150,r="#000000ff",s="#ffffffff",l=/^#[0-9a-f]{6}$/i,d=/^#[0-9a-f]{6}$/i,c=/^#[0-9a-f]{8}$/i,u=/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/i,p=/^rgba\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*(\d|\d\.\d+)\s*\)$/i;function normalizeColor(e){if(!e)return e;var t={red:0,green:0,blue:0,alpha:1};if(e=e.trim(),c.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2)),t.alpha=hexToDecimal(e.substr(7,2));else if(l.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2));else if(d.test(e))t.red=hexToDecimal(e[1]+"{"+e[1]),t.green=hexToDecimal(e[2]+"{"+e[2]),t.blue=hexToDecimal(e[3]+"{"+e[3]);else if(p.test(e)){var n=replaceAll(e," ",""),a=(n=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(a[0]),255),t.green=Math.min(parseInt(a[1]),255),t.blue=Math.min(parseInt(a[2]),255),t.alpha=Math.min(parseFloat(a[3]),1)}else if(u.test(e)){var o=replaceAll(e," ",""),i=(o=o.substring(o.indexOf("(")+1,o.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(i[0]),255),t.green=Math.min(parseInt(i[1]),255),t.blue=Math.min(parseInt(i[2]),255),t.alpha=1}else console.warn("color format unsupported: "+e),t=null;return t}function getPercievedBrightness(e){return e?Math.floor(Math.sqrt(.241*e.red*e.red+.691*e.green*e.green+.068*e.blue*e.blue)):0}function getColorInFullHex(e){if(!e)return e;return"#"+padString(decimalToHex(e.red),"0",2)+padString(decimalToHex(e.green),"0",2)+padString(decimalToHex(e.blue),"0",2)+padString(decimalToHex(e.alpha),"0",2)}function decimalToHex(e){return e.toString(16)}function hexToDecimal(e){return parseInt("0x"+e)}function replaceAll(e,t,n){if(e&&t)for(n||(n="");0<=e.indexOf(t);)e=e.replace(t,n);return e}function padString(e,t,n){return e&&t&&n&&(e=e.padStart(n,t[0])),e}function increase_brightness(e,t){3==(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),i="#"+padString((0|256+n+(256-n)*t/100).toString(16).substr(1),"0",2);return i+=padString((0|256+a+(256-a)*t/100).toString(16).substr(1),"0",2),i+=padString((0|256+o+(256-o)*t/100).toString(16).substr(1),"0",2)}return{getThemeSettings:function(e,t){var n=null,a=getColorInFullHex(normalizeColor(e));if(a){a=a.substr(0,7),(n={}).color=a;var o=getColorInFullHex(normalizeColor(t));n.backgroundColor=o?(o=o.substr(0,7))===a?(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",a):(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""):(n.colorFrom=increase_brightness(a,-30),n.colorTo=increase_brightness(a,30),n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""),n.percievedBrightness=getPercievedBrightness(normalizeColor(n.colorFrom)),n.percievedBrightness1=getPercievedBrightness(normalizeColor(n.color)),n.percievedBrightness2=getPercievedBrightness(normalizeColor(n.colorTo)),n.textColor=n.percievedBrightness<=i?s:r,n.buttonColor=(n.percievedBrightness,r),n.buttonBorderColor=(n.percievedBrightness,a),n.buttonBackgroundColor=(n.percievedBrightness,s),n.buttonColorHover=(n.percievedBrightness,s),n.buttonBackgroundColorHover=n.percievedBrightness<=i?a:"#525252"}return n},getTextColorForBackground:function(e){var t="#000000ff";if(!e)return t;var n=normalizeColor(e);return n&&getPercievedBrightness(n)<=150?"#ffffffff":t},setAlpha:function(e,t){if(!e||isNaN(t))return e;t=Math.floor(255*Math.min(Math.max(0,t),1));var n=normalizeColor(e);return n.alpha=t,getColorInFullHex(n)},normalizeColor:normalizeColor,getPercievedBrightness:getPercievedBrightness,BRIGHTNESS_THRESHOLD:i}}(),Yt={isMessageFitting:function(e,t,n){var a=!0,o=e.cloneNode(!0);if(o.getElementsByClassName(t)){var i=document.getElementById("roughMessageContainer");i.appendChild(o);var r=o.getElementsByClassName("option-pill-container");Array.prototype.forEach.call(r,function(e){var t=e.firstElementChild;t.scrollHeight>t.clientHeight&&(a=!1)}),a||(r=e.getElementsByClassName("option-pill-container"),Array.prototype.forEach.call(r,function(e){e.classList.remove(t),e.classList.add(n)})),i.removeChild(o)}return a},setFittingClassByText:function(e){var t=e.getElementsByClassName("option-pill-container");if(t&&t.length){var i=[];Array.prototype.forEach.call(t,function(e){if(e.textContent){for(var t=0,n=0;n<e.textContent.length;n++){var a=e.textContent.charAt(n);" "==a?t+=4:a==a.toLowerCase()?t+=9:t+=12}var o=1;"style3"==Pt?t<=50?o=3:t<=100&&(o=2):t<=90?o=3:t<=160&&(o=2),i.push(o)}else i.push(-1)});for(var n=3,a=0;a<i.length;){for(var o=i[a],r=i[a],s=!0,l=1;l<o;l++)a+l<i.length?i[a+l]>=r||(s=!1):s&&0<a&&r==n?(o=l,l+=i[a]):s=!1;if(s){var d="option-pill-"+r;for(l=0;l<o;l++)t[a+l].classList.add(d);a+=o,r<n&&(n=r)}else i[a]=i[a]-1}}}},Jt=function(){function removeRazorpayButton(){updateCardById("krazorpay-btn",{Title:"Transaction Completed",RemoveClick:!0,RemoveId:!0})}function removeCashfreeButton(){updateCardById("kcashfree-btn",{Title:"Transaction Completed",RemoveClick:!0,RemoveId:!0})}return{addRazorpayButton:function(t){removeRazorpayButton();var e={Title:"Make Payment",OnClick:function(e){notifyParent(at.OpenRazorpayForm,t),e.stopPropagation(),updateLastActivity()},ElementId:"krazorpay-btn"},n=[];n.push(e),renderMessage({RichCards:n,Text:"Please make the payment",CardsType:et.SmallButton}),notifyParent(at.OpenRazorpayForm,t),scrollToEnd(z)},removeRazorpayButton:removeRazorpayButton,addCashfreeButton:function(t){removeCashfreeButton();var e={Title:"Make Payment",OnClick:function(e){notifyParent(at.OpenCashfreeForm,t),e.stopPropagation(),updateLastActivity()},ElementId:"kcashfree-btn"},n=[];n.push(e),renderMessage({RichCards:n,Text:"Please make the Cashfree payment",CardsType:et.SmallButton}),scrollToEnd(z)},removeCashfreeButton:removeCashfreeButton}}();function openWebRtcCaller(e){e.Command&&relayWebRtcSignalToParent({Type:"UserChat",Command:"StartCall",Data:e})}function relayWebRtcSignalToParent(e){notifyParent(at.MediaStreamingCommand,e)}function relayWebRtcSignalFromParent(e){var t={UserId:se||"",ConversationId:de||"",BotClientName:ce||""};l.invoke("OnMediaSignal",e,t).done().fail(function(e){console.error("Message sending failed: "+e)})}function auto_grow(e){e.style.height="5px",e.style.height=e.scrollHeight+"px"}function checkIfBackgroundDark(e){if("string"==typeof e&&e.trim().startsWith("#")){var t=$t.normalizeColor(e);e="rgb("+t.red+", "+t.green+", "+t.blue+")"}var n=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(n){var a=parseInt(n[1]),o=parseInt(n[2]),i=parseInt(n[3]);return.2126*(a/=255)+.7152*(o/=255)+.0722*(i/=255)<.5}return!1}function checkIfColorIsWhitish(e){if("string"==typeof e&&e.trim().startsWith("#")){var t=$t.normalizeColor(e);e="rgb("+t.red+", "+t.green+", "+t.blue+")"}var n=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(n){var a=parseInt(n[1]),o=parseInt(n[2]),i=parseInt(n[3]);return 220<=a&&220<=o&&220<=i}return!1}var Zt=null,Qt=null,Xt=null,en=null,tn=null,nn=null,an=!1,on=null;function createWhatsAppWindow(){Zt&&Zt.remove(),(Zt=document.createElement("div")).className="whatsapp-window";var e=rt&&rt.website||"https://www.kenyt.ai",t=rt&&rt.name||"Kenyt.AI",n=!(!rt||!rt.show),a=Qt&&Qt.initialMessage?Qt.initialMessage:"Hi";Zt.innerHTML='\n        <div class="whatsapp-header">\n            \x3c!-- Icon Container --\x3e\n            <div class="whatsapp-icon-container">\n                <div>\n                    <i class="fab fa-whatsapp"></i>\n                </div>\n            </div>\n            \n            \x3c!-- Header Content --\x3e\n            <div class="whatsapp-header-content">\n                <div class="whatsapp-header-content-title">\n                    <div class="whatsapp-header-content-title-text">'+(Qt&&Qt.headerTitle||"WhatsApp Support")+'</div>\n                    </div>\n                </div>\n            \n            \x3c!-- Close Button Container --\x3e\n            <div class="whatsapp-close-button-container">\n                <div class="whatsapp-close-button" onclick="closeWhatsAppWindowInFrame()" onmouseover="this.style.backgroundColor=\'rgba(255, 255, 255, 0.3)\'" onmouseout="this.style.backgroundColor=\'transparent\'">\n                    <span class="whatsapp-close-button-icon material-icons-outlined">close</span>\n                </div>\n            </div>\n        </div>\n        <div class="whatsapp-content-container">\n            \x3c!-- Message Time Indicator --\x3e\n            <div class="whatsapp-time-indicator">\n                <span>Today</span>\n            </div>\n            \n            \x3c!-- Support Message Bubble --\x3e\n            <div class="whatsapp-message-bubble whatsapp-message-incoming">\n                <div class="whatsapp-message-content">\n                    '+(Qt&&Qt.contentTitle?'<div class="whatsapp-message-text"><strong>'+Qt.contentTitle+"</strong></div>":'<div class="whatsapp-message-text"><strong>WhatsApp Support</strong></div>')+"\n                    "+(Qt&&Qt.contentSubtitle?'<div class="whatsapp-message-text">'+Qt.contentSubtitle+"</div>":'<div class="whatsapp-message-text">Type your message below and click send to open WhatsApp with your message ready to send!</div>')+'\n                </div>\n                <div class="whatsapp-message-time">\n                    <span>Just now</span>\n                </div>\n            </div>\n        </div>\n        <div class="whatsapp-footer-container">\n            <div class="whatsapp-input-row">\n                <div class="whatsapp-input-wrapper">\n                    <textarea id="whatsappInput" placeholder="Type your WhatsApp message here" onkeypress="handleWhatsAppKeyPress(event)" class="whatsapp-input">'+a+'</textarea>\n                </div>\n                <button onclick="sendWhatsAppMessageInFrame()" class="whatsapp-send-button">\n                    <i class="fas fa-paper-plane whatsapp-send-button-icon"></i>\n                </button>\n            </div>\n            <div class="row m-0">\n                <div class="col-12 px-0 text-right text-muted'+(n?"":" d-none")+'" id="poweredByText">\n                    <span>\n                        <span class="lightning-icon">⚡by</span> <a href="'+e+'" id="brand-link"\n                            target="_blank" tabindex="-1">'+t+"</a>\n                    </span>\n                </div>\n            </div>\n        </div>\n    ",document.body.appendChild(Zt)}function adjustBrightness(e,t){3==(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16);return"#"+(0|256+n+(256-n)*t/100).toString(16).substr(1)+(0|256+a+(256-a)*t/100).toString(16).substr(1)+(0|256+o+(256-o)*t/100).toString(16).substr(1)}function createEmailWindow(){Xt&&Xt.remove(),(Xt=document.createElement("div")).className="email-window-container";var e=en&&en.link||"mailto:support@kenyt.ai",t=en&&en.number||"support@kenyt.ai",n=en&&en.windowThemeColor||"#007bff",a="#007bff"!==n?adjustBrightness(n,-20):"#0056b3",o=checkIfColorIsWhitish(n),i=o?"#000000":n,r=o?"#000000":"#ffffff",s=o?"#000000":"#ffffff",l=rt&&rt.website||"https://www.kenyt.ai",d=rt&&rt.name||"Kenyt.AI",c=!(!rt||!rt.show);Xt.innerHTML='\n        <div class="email-header" style="background: '+n+' !important;">\n            \x3c!-- Icon Container --\x3e\n            <div class="email-icon-container">\n                <div style="color: '+r+';">\n                    <i class="fas fa-envelope"></i>\n                </div>\n            </div>\n\n            \x3c!-- Header Content --\x3e\n            <div class="email-header-content">\n                <div class="email-header-content-title">\n                    <div class="email-header-content-title-text" style="color: '+s+';">'+(en&&en.headerTitle||"Email Support")+'</div>\n                </div>\n            </div>\n\n            \x3c!-- Close Button Container --\x3e\n            <div class="email-close-button-container">\n                <div class="email-close-button" onclick="closeEmailWindowInFrame()" onmouseover="this.style.backgroundColor=\'rgba(0, 0, 0, 0.25)\'" onmouseout="this.style.backgroundColor=\'white\'">\n                    <span style="color: '+i+' !important;" class="material-icons-outlined">close</span>\n                </div>\n            </div>\n        </div>\n        <div class="email-content-container">\n            <div class="email-content-card">\n                <div style="margin-bottom: 18px;">\n                    <p style="margin-bottom: 10px; color: #666; line-height: 1.5;">\n                        '+(en&&en.contentTitle||"Need help? Send us an email and we'll get back to you within 24 hours.")+'\n                    </p>\n                    <p style="margin-bottom: 15px; color: #888; font-size: 14px;">\n                        '+(en&&en.contentSubtitle||"Our support team is available Monday to Friday, 9 AM - 6 PM EST.")+'\n                    </p>\n                    <div style="display: flex; align-items: center; padding: 10px 12px; background: #f5f5f5; border-radius: 8px; color: #333; font-weight: 600;">\n                        <i class="fas fa-envelope" style="margin-right: 10px; color: '+n+';"></i>\n                        <span>'+t+'</span>\n                    </div>\n                </div>\n                <button\n                    class="email-btn"\n                    onclick="sendEmail(\''+e+"')\" onmouseover=\"this.style.backgroundColor='"+a+"'\" onmouseout=\"this.style.backgroundColor='"+n+'\'" style="background: '+n+';">\n                    <i class="fas fa-envelope" style="margin-right: 8px;"></i>\n                    Email '+t+'\n                </button>\n            </div>\n        </div>\n        <div class="email-footer-container">\n            <div class="row m-0">\n                <div class="col-12 px-0 text-right text-muted'+(c?"":" d-none")+'" id="poweredByText">\n                    <span>\n                        <span class="lightning-icon">⚡by</span> <a href="'+l+'" id="brand-link"\n                            target="_blank" tabindex="-1">'+d+"</a>\n                    </span>\n                </div>\n            </div>\n        </div>\n    ",document.body.appendChild(Xt)}function createPhoneWindow(){tn&&tn.remove(),(tn=document.createElement("div")).className="phone-window",tn.id="phoneWindowContainer";var e=nn&&nn.link||"tel:+1234567890",t=nn&&nn.number;if(!t&&e){var n=e.match(/^tel:(\+?\d[\d\-]*)$/i);t=n?n[1]:"+1234567890"}t||(t="+1234567890");var a,o,i=nn&&nn.windowThemeColor||"#007bff",r="#007bff"!==i?adjustBrightness(i,-20):"#0056b3",s=(a=i,o=.3,"rgba("+parseInt(a.slice(1,3),16)+", "+parseInt(a.slice(3,5),16)+", "+parseInt(a.slice(5,7),16)+", "+o+")"),l=checkIfColorIsWhitish(i),d=l?"#000000":i,c=l?"#000000":"#ffffff",u=l?"#000000":"#ffffff",p=rt&&rt.website||"https://www.kenyt.ai",m=rt&&rt.name||"Kenyt.AI",g=!(!rt||!rt.show);tn.innerHTML='\n        <div class="phone-header" style="background: '+i+' !important;">\n            \x3c!-- Icon Container --\x3e\n            <div class="phone-icon-container">\n                <div style="color: '+c+';">\n                    <i class="fas fa-phone"></i>\n                </div>\n            </div>\n            \n            \x3c!-- Header Content --\x3e\n            <div class="phone-header-content">\n                <div class="phone-header-content-title">\n                    <div class="phone-header-content-title-text" style="color: '+u+';">'+(nn&&nn.headerTitle||"Call Us")+'</div>\n                </div>\n            </div>\n            \n            \x3c!-- Close Button --\x3e\n            <div class="phone-close-button-container">\n                <div class="phone-close-button" onclick="closePhoneWindowInFrame()" onmouseover="this.style.backgroundColor=\'rgba(0, 0, 0, 0.25)\'" onmouseout="this.style.backgroundColor=\'white\'">\n                    <span style="color: '+d+' !important;" class="phone-close-button-icon material-icons-outlined">close</span>\n                </div>\n            </div>\n        </div>\n        \n        \x3c!-- Phone Content --\x3e\n        <div class="phone-content-container">\n            <div class="phone-content-header">\n                <h4 class="phone-content-title">'+(nn&&nn.contentTitle||"Call Our Team")+'</h4>\n                <p class="phone-content-description">'+(nn&&nn.contentSubtitle||"Speak directly with our support specialists.")+'</p>\n                <div style="display:flex; align-items:center; padding:12px; background:#f5f5f5; border-radius:10px; color:#333; font-weight:600; margin-top:12px;">\n                    <i class="fas fa-phone" style="margin-right:10px; color:'+i+';"></i>\n                    <span>'+t+'</span>\n                </div>\n            </div>\n\n            <div class="phone-buttons-container" id="phoneButtonsContainer" style="display: flex; flex-direction: column; gap: 14px; align-items: center;">\n                <button \n                    onclick="makePhoneCall(\''+e+'\')"\n                    class="phone-call-button"\n                    onmouseover="this.style.background=\'linear-gradient(90deg, '+r+" 0%, "+i+" 100%)'\"\n                    onmouseout=\"this.style.background='linear-gradient(90deg, "+i+", "+adjustBrightness(i,16)+')\'"\n                    style="\n                        background: linear-gradient(90deg, '+i+", "+adjustBrightness(i,16)+");\n                        box-shadow: 0 6px 18px "+s+';\n                        display: flex; \n                        flex-direction: row; \n                        align-items: center; \n                        justify-content: center; \n                        min-width: 220px; \n                        max-width: 340px; \n                        width: 96%; \n                        padding: 14px 0;\n                        margin: 0 auto;\n                        font-size: 17px;\n                        font-weight: 600;\n                        border: none;\n                        transition: background 0.2s linear;\n                    "\n                >\n                    <span class="phone-call-button-icon" style="display: flex; align-items: center; margin-right: 12px;">\n                        \x3c!-- Lucide Replace: Lucide "phone-call" SVG (Call Now) --\x3e\n                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="white" stroke-width="2"><path d="M15.05 5.05a7 7 0 0 1 3.95 3.95"/><path d="M15.5 8.5a3 3 0 0 1 1.5 1.5"/><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.8 19.8 0 0 1 2 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72c.13.93.43 2.07.91 3.13a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.05-1.05a2 2 0 0 1 2.11-.45c1.06.48 2.2.78 3.13.91A2 2 0 0 1 22 16.92z"/></svg>\n                    </span>\n                    <span class="phone-call-button-text">Call '+t+'</span>\n                </button>\n\n                <button \n                    onclick="handleClickToCall()" \n                    class="phone-call-button"\n                    style="\n                        background: transparent;\n                        color: '+i+";\n                        border: 2px solid "+i+';\n                        box-shadow: none;\n                        display: flex;\n                        flex-direction: row;\n                        align-items: center;\n                        justify-content: center;\n                        min-width: 220px;\n                        max-width: 340px;\n                        width: 96%;\n                        padding: 14px 0;\n                        margin: 0 auto;\n                        font-size: 17px;\n                        font-weight: 600;\n                        transition: background 0.2s linear, color 0.2s linear;\n                    "\n                    onmouseover="this.style.backgroundColor=\''+adjustBrightness(i,30)+"'; this.style.color='#000'\"\n                    onmouseout=\"this.style.backgroundColor='transparent'; this.style.color='"+i+'\'"\n                >\n                    <span class="phone-call-button-icon" style="display: flex; align-items: center; margin-right: 12px;">\n                        \x3c!-- Lucide Replace: Lucide "phone-incoming" SVG (Click to Call) --\x3e\n                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="'+i+'" stroke-width="2"><polyline points="16 2 16 8 22 8"/><line x1="23" y1="1" x2="16" y2="8"/><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.8 19.8 0 0 1 2 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72c.13.93.43 2.07.91 3.13a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.05-1.05a2 2 0 0 1 2.11-.45c1.06.48 2.2.78 3.13.91A2 2 0 0 1 22 16.92z"/></svg>\n                    </span>\n                    <span class="phone-call-button-text">Request a Call Back</span>\n                </button>\n            </div>\n        </div>\n        \n        \x3c!-- Powered by Kenyt.ai Footer --\x3e\n        <div class="phone-footer-container">\n            <div class="row m-0">\n                <div class="col-12 px-0 text-right text-muted'+(g?"":" d-none")+'" id="poweredByText">\n                    <span>\n                        <span class="lightning-icon">⚡by</span> <a href="'+p+'" id="brand-link"\n                            target="_blank" tabindex="-1">'+m+"</a>\n                    </span>\n                </div>\n            </div>\n        </div>\n    ",document.body.appendChild(tn)}function handleClickToCall(){var e=document.getElementById("phoneWindowContainer");e&&(e.style.display="none"),sendMessageToServer("InitiateCallFromBot","Initiate Call From Bot")}function closeWhatsAppWindowInFrame(){Zt&&(Zt.remove(),Zt=null,window.parent.postMessage({type:"closeWhatsAppWindow"},"*"))}function closeEmailWindowInFrame(){Xt&&(Xt.remove(),Xt=null,window.parent.postMessage({type:"closeEmailWindow"},"*"))}function closePhoneWindowInFrame(){tn&&(tn.remove(),tn=null,window.parent.postMessage({type:"closePhoneWindow"},"*"))}function makePhoneCall(e){e&&window.open(e,"_self")}function sendEmail(e){window.location.href=e}function sendWhatsAppMessageInFrame(){var e=document.getElementById("whatsappInput");if(e&&e.value.trim()&&Qt){var t=e.value.trim();e.value="",e.style.height="35px";var n=Qt.link;if(n.includes("&text=")){var a=decodeURIComponent(n.split("&text=")[1])+" "+t;n=n.split("&text=")[0]+"&text="+encodeURIComponent(a)}else n+="&text="+encodeURIComponent(t);window.parent.postMessage({type:"openWhatsAppUrl",url:n},"*"),setTimeout(function(){closeWhatsAppWindowInFrame()},500)}else Qt||alert("WhatsApp configuration not found. Please contact support.")}function handleWhatsAppKeyPress(e){"Enter"!==e.key||e.shiftKey||(e.preventDefault(),sendWhatsAppMessageInFrame())}function cameraOverlayAsFormCssOveride(){J.style.display="flex",J.style.position="relative",J.style.background="rgba(0,0,0,0.8)",J.style.zIndex="9999",J.style.width="100%",J.style.height="50vh",cameraContainer.style.width="100%",capturedImageContainer.style.width="100%"}function resetCameraOverlayAsFormCssOveride(){J.removeAttribute("style"),cameraContainer.removeAttribute("style"),capturedImageContainer.removeAttribute("style")}function printDocument(e){var t=document.createElement("iframe");t.src=Je+"?token="+encodeURIComponent(e),t.setAttribute("title","Print document"),t.style.display="none",document.body.appendChild(t),t.onload=function(){return t.contentWindow.print()}}var rn={HeroTemplate:'<div class="portal-template-hero-container" style="background-image: url({{backgroundImage}});" trigger>\n            <div class="portal-template-hero-overlay"></div>\n            <div class="portal-template-hero-text">\n                {{text}}\n            </div>\n        </div>',ArticlePreviewTemplate:'<div class="portal-card" trigger>\n            <img src={{thumbnail}} alt="Article Image" onerror="this.style.display=\'none\';" />\n            <p class="portal-card-title">{{title}}</p>\n            <p>{{description}}</p>\n        </div>',CheckListItemTemplate:'<div class="portal-card checklist-item">\n            <div class="checklist-header" onclick="this.nextElementSibling.classList.toggle(\'k-hide\')">\n                <input {{#if isComplete}}checked{{/if}} id="checkbox-{{templateId}}" type="checkbox" class="checklist-checkbox" trigger/>\n                <p class="portal-card-title">{{title}}</p>\n            </div>\n            <div class="checklist-description k-hide">\n                <p>{{description}}</p>\n            </div>\n        </div>',SearchTemplate:'<div class="portal-template-search-container">\n            <input type="text" id={{templateId}} value="{{value}}" class="portal-template-search-input" placeholder={{placeholder}} />\n\n            <div class="portal-template-search-icon-wrapper" trigger >\n                <i class="portal-template-search-icon fas fa-search"></i>\n            </div>\n        </div>',InputTemplate:'<div class="portal-template-input-container">\n        <input type={{type}} id={{templateId}} value="{{value}}" class="portal-template-input-field" placeholder={{placeholder}} />\n\n        <div class="portal-template-input-icon-wrapper" trigger >\n            <i class="portal-template-input-icon fas fa-chevron-right"></i>\n        </div>\n    </div>',ListTemplate:'<ul class="portal-template-list-container">\n            {{#each listElements}}\n            <li>\n                <a class="portal-template-list-item" target="_blank" href={{this.relativePath}}>\n                    <div class="text">{{this.rowTitle}}</div>\n                    <i class="fas fa-chevron-right portal-template-item-icon"></i>\n                </a>\n            </li>\n            {{/each}}\n        </ul>',CarouselTemplate:'\n    <div class="portal-template-carousel" id="carousel-{{templateId}}">\n        <div class="portal-template-carousel-container" trigger>\n                {{#each carouselElements}}\n                <div class="portal-template-carousel-item">\n                    <div class="portal-template-carousel-image-container">\n                        <img src="{{this.imageUrl}}" alt="{{this.text}}" class="portal-template-carousel-image">\n                    </div>\n                    <div class="portal-template-carousel-text">{{this.text}}</div>\n                </div>\n                {{/each}}\n        </div>\n        <button class="portal-template-carousel-prev">&lt;</button>\n        <button class="portal-template-carousel-next">&gt;</button>\n    </div>',FormTemplate:'\n    <form class="portal-template-form-container" id="form-{{templateId}}">\n        <div class="mt-1 row">\n            <div class="text-center col">\n                <h2 class="h6 font-weight-bold">{{this.customForm.title}}</h2>\n                <p>{{this.customForm.description}}</p>\n            </div>\n        </div>\n        {{#each this.customForm.fields}}\n                <div class="portal-template-input-group">\n                    <i class="fas {{this.image}}"></i>\n                    <input class="form-control" type="{{this.datatype}}" placeholder="{{this.placeholder}}" />\n                </div>  \n        {{/each}}\n        <button type="submit" class="portal-template-submit-btn">Submit</button>\n    </form>',ConversationListTemplate:'\n        {{#if listElements.length}}\n            <ul class="conversation-list">\n                {{#each listElements}}\n                <li class="conversation-list-item" trigger>\n                    \x3c!-- Chat icon on the left --\x3e\n                    <span class="conversation-chat-icon">\n                        <span class="material-icons-outlined">chat</span>\n                    </span>\n                    \x3c!-- Main content area with text and timestamp --\x3e\n                    <div class="conversation-content">\n                        <div class="conversation-text">\n                            {{this.lastMessage}}\n                        </div>\n                        <div class="conversation-message-from">\n                            {{this.messageFrom}} - {{this.lastMessageTime}}\n                        </div>\n                    </div>\n\n                    \x3c!-- Arrow icon on the right --\x3e\n                    <span class="conversation-arrow-front-icon">\n                        <span class="material-icons-outlined">arrow_forward_ios</span>\n                    </span>\n                </li>\n                {{/each}}\n            </ul>\n        {{else}}\n            <div class="no-conversations-container">\n                <div class="no-conversations-content">\n                    <span class="material-icons-outlined no-conversations-chat-icon">chat</span>\n                    <p class="no-conversations-text">No Conversations</p>\n                    <p class="past-conversations-text">Your past conversations will be shown here</p>\n                </div>\n            </div>\n        {{/if}}',ButtonTemplate:'<div class="conversation-start-new" trigger>\n            <button>\n                {{label}}\n                <span class="conversation-add-icon">\n                    <span class="material-icons-outlined">add</span>\n                </span>\n            </button>\n        </div>'},sn=null,ln="kenytChatWindow",dn="chatbox-container",cn="kenytBotLoaded",un="",pn=null,mn=function(){return document.getElementById(ln)};function openChatWindowByConversationId(a){var e=kenytExtractRootUrl();clearExistingWindow(e);var t=window.location.search,n=new URLSearchParams(t),o=window.parent.document.createElement("script");o.src=e+"/ChatbotUI/dist/js/bot-loader.js",o.type="text/javascript",o.async=!0,n.has("data-position")&&o.setAttribute("data-position",n.get("data-position")),o.dataset.bot=n.get("botid"),window.parent.document.body.appendChild(o);var i=!0;window.parent.document.addEventListener("kenytEvent",function(e){if("kenyt_Load"===e.detail.eventType&&i){var t=window.parent.document.getElementById(ln),n={selectedConversationId:a,conversationMessages:sn[a],disableCustomMessage:!0,type:"kenytSetCustomContext"};t&&t.contentWindow&&t.src&&(t.contentWindow.postMessage(n,t.src),kenytOpenChatWindow()),i=!1}}),notifyParentKenytLoad()}function createNewConversation(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=kenytExtractRootUrl();clearExistingWindow(e);var t=window.location.search,n=new URLSearchParams(t),o=window.parent.document.createElement("script");o.src=e+"/ChatbotUI/dist/js/bot-loader.js",o.setAttribute("data-position","center"),o.type="text/javascript",o.async=!0,o.dataset.bot=n.get("botid"),window.parent.document.body.appendChild(o);var i=!0;window.parent.document.addEventListener("kenytEvent",function(e){if("kenyt_Load"===e.detail.eventType&&i){var t=window.parent.document.getElementById("kenytChatWindow"),n={selectedConversationId:"",disableCustomMessage:!0,type:"kenytSetCustomContext"};a&&(n.userData=a),t&&t.contentWindow&&t.src&&(t.contentWindow.postMessage(n,t.src),kenytOpenChatWindow()),i=!1}}),notifyParentKenytLoad()}function clearExistingWindow(e){for(var t=[mn()],n=0;n<document.scripts.length;n++){var a=document.scripts[n];a.src===e+"/ChatbotUI/dist/js/bot-loader.js"?t.push(a):a.src.indexOf("/chatbubble.js")&&t.push(a)}for(var o=0;o<window.parent.document.scripts.length;o++){var i=window.parent.document.scripts[o];i.src===e+"/ChatbotUI/dist/js/bot-loader.js"?t.push(i):i.src.indexOf("/chatbubble.js")&&t.push(i)}document.getElementById("messageContainer").innerHTML="",t.forEach(function(e){return e&&e.remove()})}function handleSearch(e,t){var n=document.getElementById(e).value;n&&kenytUseApiCall({url:"/api"+t,method:"GET",queryParams:{search:n}},function(){return console.debug("SEARCHING")},function(e){console.debug("API_ERROR",e)})}var gn="chatbox-container",fn="kenytChatBubble",vn="data-unreadcount",hn="portal-window-container",yn=function(){var e=window.location.search,t=new URLSearchParams(e);if("false"!==t.get("enablePortal")){var n,a,o,i,r,u='\n            <a href="#" id="portal-home" class="portal-footer-tab">\n                <i class="portal-footer-tab-icon fas fa-home"></i>\n                <div class="portal-footer-tab-name">Home</div>\n            </a>',p='\n            <div id="portal-home-section" tabId="portal-home" class="portal-section">\n            </div>',s='\n    <div id="portal-window-container">\n        <div class="portal-header">\n            <div class="portal-icon-container">\n                <img src="" class="portal-header-image" />\n            </div>\n          <div class="portal-header-title">\n            Home\n          </div>\n            <div class="header-button" id="portal-window-close">\n                <i class="fas fa-times"></i>\n            </div>\n        </div>\n        <div id="top-spinner" class="spinner k-hide"></div>\n        <div id="full-page-spinner" class="kt-overlay k-hide">\n            <div class="spinner"></div>\n        </div>\n        <div class="portal-body">\n        </div>\n\n        <div class="portal-footer">\n          <button type="button" aria-label="Previous" class="scroll-button left k-hide"></button>\n          <button type="button" aria-label="Next" class="scroll-button right k-hide"></button>\n        </div>\n    </div>',l=kenytExtractRootUrl(),d=detectAppName(),c=d+"/api/portal/getportalconfig",m=d+"/api/botsetup/websettings",g=t.get("botid"),f=l+d+"/api/botsetup/getimage?imagetype=chatbubble-icon&botid=";console.debug("PORTAL WINDOW JS FILE LOADED"),window.addEventListener("message",function(e){if(e.data&&e.data.type&&"kenytChatWindowBack"===e.data.type)try{document.querySelector("#portal-messages").dispatchEvent(new CustomEvent("customClick"))}catch(e){console.debug("TAB_TRIGGER",e)}}),(n=new URLSearchParams(window.location.search)).get("enablePortal"),a="true"===n.get("enableHomePortal"),o="true"===n.get("enableMessagePortal"),i="true"===n.get("enableTodoPortal"),r=n.get("data-portal")?n.get("data-portal"):n.get("forms")||"portal-messages",kenytUseApiCall({url:l+c,method:"GET",queryParams:{botId:g,enableHomePortal:a,enableMessagePortal:o,enableTodoPortal:i,dataPortal:r}},createPortalWindow,function(e){console.debug("API_ERROR",e)}),kenytOverrideIframeWindowForPortal()}function createPortalWindow(e){var t=kenytHtmlToElement(s),n=(e.header,e.footer);pn=n.tabs,t.querySelector("#portal-window-close").addEventListener("click",hideChatWindow),document.body.insertBefore(t,document.body.firstChild),document.getElementById("chatWindowHeader").style.display="none",kenytUseApiCall({url:l+m,method:"GET",queryParams:{botid:g}},function(e){var t=e.webSettings,n=document.querySelector(".portal-header-image");n.src=""+(t.headerimage||f)+g;var a=document.documentElement;a.style.setProperty("--portal-window-theme-color",t.framecolor);var o=xn.getThemeSettings(t.framecolor,t.framecolorgradient),i=document.querySelector(".portal-header");i.style.background=o.backgroundColor||o.backgroundGradient},function(e){console.debug("THEME_API_ERROR",e)});var a=new URLSearchParams(window.location.search),o=a.get("data-portal")?a.get("data-portal"):a.get("forms")||"portal-messages";if(-1<(un=o).indexOf("forms:")){var i=o.split(",").map(function(e){return e.replace("forms:","").trim()}),r=3;i.forEach(function(e){var t={id:"portal-forms-"+e.replace(/\s+/g,"-").toLowerCase(),name:e,order:r++,iconPath:"fa-file-text",onLoadUrl:getEndPoint(kenytExtractRootUrl(),"/api/formsportal/onload"),customParams:{FormName:e}};n.tabs.push(t)}),o="portal-forms-"+i[0].replace(/\s+/g,"-").toLowerCase()}!function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=document.querySelector(".portal-footer"),a=e.tabs,o=0,i=a.findIndex(function(e){return e.id===t});4<i+1&&(o=i-4+1);if(4<a.length){var r=n.querySelectorAll(".scroll-button")[0],s=n.querySelectorAll(".scroll-button")[1],l=function(){0===o?r.classList.add("k-hide"):r.classList.remove("k-hide"),o===a.length-4?s.classList.add("k-hide"):s.classList.remove("k-hide")};l(),r.addEventListener("click",function(){(o-=1)<0&&(o=0),l();var e=a.findIndex(function(e){return e.id===un});c(e<o||o+4<=e?a[o].id:un)}),s.addEventListener("click",function(){(o+=1)>a.length-4&&(o=a.length-4),l();var e=a.findIndex(function(e){return e.id===un});c(e<o||o+4<=e?a[o+4-1].id:un)})}var d=document.createElement("div");d.className="tab-container";var c=function(e){d.innerHTML="",document.querySelector(".portal-body").innerHTML="";var t=a.slice(o,o+4);if(t.forEach(function(e,t){var n,a,o=kenytHtmlToElement(u);if(o.id=e.id,a=e,(n=o).addEventListener("customClick",function(e){return onFooterTabClick(e,a)}),n.addEventListener("click",function(e){return onFooterTabClick(e,a)}),function(e,t){var n=document.querySelector(".portal-body"),a=kenytHtmlToElement(p);a.setAttribute("tabId",e.id),a.setAttribute("id",e.id+"-section"),t&&a.classList.add("active");n.appendChild(a)}(e),e.iconPath){var i=o.querySelector(".portal-footer-tab-icon");!function(e,t){if(t.includes("http")){var n=new Image;n.onload=function(){e.style.backgroundImage="url("+t+")",e.classList.remove("fa-home")},n.onerror=function(){console.error("Failed to load image, using fallback icon.")},n.src=t}else e.classList.remove("fa-home"),e.classList.add(t)}(i,e.iconPath)}if(e.name){var r=o.querySelector(".portal-footer-tab-name");r.textContent=capitalizeInitialCharacter(addSpacesBetweenCapitals(e.name))}d.appendChild(o)}),e){var n=document.querySelector("#"+e);n.dispatchEvent(new CustomEvent("customClick"))}};n.appendChild(d),c(t)}(n,o)}function handleTabTemplates(a,e,t){3<arguments.length&&void 0!==arguments[3]&&arguments[3];t&&(a.innerHTML=""),e.forEach(function(n){var i=void 0;if("OptionsGroupTemplate"==n.templateType)i=renderCards(n.options,et.Thumbnail,"text","Todo menu",null,function(e,t){console.log(t,"REQUEST_DATA"),n.data=t,handleTemplateClick(e,n)},!0);else if("FormTemplate"==n.templateType)i=renderForm(n.customForm,{},function(e){return handleTemplateClick(e,n)},!0);else if("ChatWindowTemplate"==n.templateId)n.data?n.data.selectedConversationId?openChatWindowByConversationId(n.data.selectedConversationId):createNewConversation(n.data):createNewConversation();else if("CarouselTemplate"===n.templateType)(i=createCarousel(n.carouselCards,function(e,t){n.data=t,handleTemplateClick(e,n)},!0)).id=n.templateId,i.classList.add("portal-card");else{var e=kenytRenderTemplate(rn[n.templateType],n);i=kenytHtmlToElement(e)}if(n.onClickUrl){var t=i.hasAttribute("trigger")?i:i.querySelector("[trigger]");t&&t.addEventListener("click",function(e){e.preventDefault(),handleTemplateClick(e,n)})}"ConversationListTemplate"===n.templateType&&(sn={},n.listElements.forEach(function(t){if(sn[t.selectedConversationId]=t.messages,t.onClickUrl){var e=t.templateId,n=parseInt(e.split("-")[1],10),a=i.querySelector("li:nth-child("+(n+1)+")"),o=a.hasAttribute("trigger")?a:a.querySelector("[trigger]");o&&o.addEventListener("click",function(e){e.preventDefault(),handleTemplateClick(e,t)})}})),a.appendChild(i),"FormTemplate"==n.templateType&&n.customForm.fields.forEach(function(e){e.afterAppend&&e.afterAppend()})})}function onFooterTabClick(t,n){document.querySelector("#top-spinner").classList.remove("k-hide"),t.stopPropagation(),t.preventDefault(),function(e){for(var t=document.getElementsByClassName("portal-section"),n=document.getElementsByClassName("portal-footer-tab"),a=document.querySelector(".portal-header-title"),o=0;o<t.length;o++)t[o].classList.remove("active"),n[o].classList.remove("active");var i=document.querySelector("#"+e),r=i.querySelector(".portal-footer-tab-name").textContent;document.querySelector("[tabId="+e+"]").classList.add("active"),i.classList.add("active"),a.textContent=r}(t.currentTarget.id);var e=Object.assign({},n.customParams||{},{botId:g,userId:window.localStorage.getItem("_kenytUserId_")||"none"});try{n.onLoadUrl&&kenytUseApiCall({url:n.onLoadUrl,method:"GET",queryParams:e},function(e){handleTabTemplates(document.querySelector("[tabId="+n.id+"]"),e.templates,!0,t.detail),document.querySelector("#top-spinner").classList.add("k-hide")},function(e){document.querySelector("#top-spinner").classList.add("k-hide"),console.debug("TabTriggerApi",e)}),un=n.id}catch(e){console.debug("TAB_TRIGGER",e)}}function handleTemplateClick(e,t){console.log("trigger clicked"),e.stopPropagation();var n=window.localStorage.getItem("_kenytUserId_")||"none",a={method:"POST",url:t.onClickUrl,queryParams:{templateId:t.templateId,botId:g}},o=!0;switch(t.templateId.startsWith("conversationListItem")&&(a.body={selectedConversationId:t.selectedConversationId}),t.templateType){case"HeroTemplate":break;case"SearchTemplate":var i=document.getElementById(t.templateId).value;a.body={searchText:i};break;case"ArticlePreviewTemplate":break;case"FormTemplate":var r=handleFormValues(e,t.customForm.fields,t.customForm.submit,t.customForm.submitType,!1),s=r.isFormValid,l=r.values;o=s,a.body=l,a.body.userId=n,t&&t.customForm&&(a.body.formName=t.customForm.title);break;case"CarouselTemplate":a.body=t.data;break;case"CheckListItemTemplate":var d=document.getElementById("checkbox-"+t.templateId);a.body={complete:d.checked,command:t.metadata.options.complete,userId:n};break;default:t.data&&(a.body=t.data)}o&&kenytUseApiCall(a,function(e){e.forEach(function(e){e.tabId&&document.querySelector("#"+e.tabId).dispatchEvent(new CustomEvent("customClick",{detail:{tabId:e.tabId,templateId:e.templateId,data:e.data}}))}),handleTabTemplates(document.querySelector("[tabId="+un+"]"),e,!0)},function(e){console.debug(e)})}}(),Cn="bot-loader.js",bn="/botapp",Tn={center:"position-center",left:"position-left",right:"position-right",bottom:"position-bottom"},En=void 0,Sn=void 0,wn=void 0,In={EMAIL_VALIIDATION_PATTERN:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,PHONE_VALIDATION_SOURCE:"Intl Tel Input Plugin",URL_VALIIDATION_PATTERN:/^(http[s]?:\/\/)?(www\.)?(\w)+\.(\w)+([\/.][\w-#]*)*$/};function kenytIsMobileDevice(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)}function kenytNotifyChatWindow(e,t){var n=document.querySelector("#kenytChatWindow").contentWindow;if(n){var a={type:e,value:t};n.postMessage(a,"*")}else console.warn("[Kenyt.AI] Iframe load error")}function kenytUpdateAmpFrameWindowSize(e){if(e){var t=100,n=100;"none"===En.style.display?n=t=100:En.classList&&(n=En.classList.contains("k-hide")?t=100:En.classList.contains("force-fullscreen")?t=1e3:En.classList.contains("full-height")?(t=370,1e3):kenytIsMobileDevice()?(t=370,350):(t=370,470)),t&&100<=t&&n&&100<=n&&window.parent.postMessage({sentinel:"amp",type:"embed-size",width:t,height:n},"*")}}function kenytGetPositionClass(e){if(e&&"string"==typeof e&&(e=e.trim().toLowerCase()))for(var t=Object.keys(Tn),n=0;n<t.length;n++)if(t[n]===e)return Tn[t[n]];return Tn.right}function kenytSetChatBubbleTrigger(t){var n=window.parent.document.getElementById(fn);n.replaceWith(n.cloneNode(!0)),(n=window.parent.document.getElementById(fn)).addEventListener("click",function(){var e=document.getElementById(t);e.classList.contains("k-hide")?(e.classList.remove("k-hide"),n.classList.add("k-hide")):(e.classList.add("k-hide"),n.classList.remove("k-hide"))})}function kenytOpenPortalWindow(){document.getElementById(hn).classList.remove("k-hide")}function kenytOpenChatWindow(){wn=document.getElementById(hn),Sn=document.getElementById(fn),document.getElementById("chatWindow").classList.remove("k-hide"),document.getElementById("headerBackButton").classList.remove("k-hide"),document.getElementById("chatWindowBody").style.zIndex="100",document.getElementById("chatWindowFooter").style.zIndex="100",document.getElementById("chatWindowHeader").style.display="",kenytUpdateAmpFrameWindowSize(0<window.location.href.indexOf("ampframe.html"))}function kenytHtmlToElement(e){e=e.trim();var t=document.createElement("template");return t.innerHTML=e,t.content.firstChild}function kenytParseHtmlTemplate(e,t,n){var a=e.find(function(e){return e.id==t}).html;for(key in n){var o="{{"+key+"}}";a=a.replaceAll(o,n[key])}return a}function kenytGetScriptParam(e){var t=Array.from(window.parent.document.scripts).find(function(e){return-1<e.src.indexOf("bot-loader.js")}),n="";if(t){var a=""+e;t.hasAttribute(a)&&(n=t.getAttribute(a))}return n}function kenytExtractRootUrl(){var e=window.location.origin,t="";if(e){e.startsWith("//www.")?e="https:"+e:(e.startsWith(".")||e.startsWith("/"))&&(e=window.location.protocol+"//"+window.location.hostname,window.location.port&&(e+=":"+window.location.port));var n=new URL(e);t=n.protocol+"//"+n.hostname,n.port&&(t+=":"+n.port)}return t}function getEndPoint(e,t){return t=0<=e.indexOf("localhost")?""+e+t:0<e.indexOf("ngrok-free.app")?"https://"+window.location.hostname+bn+t:""+e+bn+t}function kenytUseApiCall(e,t,n){var a=e.url,o=e.method,i=void 0===o?"GET":o,r=e.headers,s=void 0===r?{}:r,l=e.body,d=void 0===l?null:l,c=e.queryParams,u=void 0===c?null:c,p=a;u&&0<Object.keys(u).length&&(p=a+"?"+Object.entries(u).map(function(e){var t=f(e,2),n=t[0],a=t[1];return encodeURIComponent(n)+"="+encodeURIComponent(a)}).join("&"));var m=new XMLHttpRequest;for(var g in m.open(i,p,!0),s)m.setRequestHeader(g,s[g]);m.onreadystatechange=function(){if(m.readyState===XMLHttpRequest.DONE)if(200<=m.status&&m.status<300)try{var e=JSON.parse(m.responseText);t(e)}catch(e){n(e,"Error parsing response JSON")}else n("API error: "+m.status+" "+m.statusText)},m.onerror=function(){n("Network error occurred")},!d||"POST"!==i&&"PUT"!==i?m.send():(m.setRequestHeader("Content-Type","application/json"),m.send(JSON.stringify(d)))}function kenytRenderTemplate(e,t){try{var n=Handlebars.compile(e);return t.helpers={kenytCarouselInit:kenytCarouselInit},n(t)}catch(e){return console.log(e),"<div></div>"}}function kenytCarouselInit(e){console.log("CAROUSEL_INITIALIZED");var t=e.querySelector(".portal-template-carousel-container"),n=t.querySelectorAll(".portal-template-carousel-item"),a=e.querySelector(".portal-template-carousel-prev"),o=e.querySelector(".portal-template-carousel-next"),i=0;function showSlide(e){console.log(e,"INDEX"),t.style.transform="translateX(-"+100*e+"%)"}o.addEventListener("click",function(){console.log(i,"CURRENT_INDEX_BEFORE"),i=(i+1)%n.length,console.log(i,"CURRENT_INDEX"),showSlide(i)}),a.addEventListener("click",function(){console.log(i,"CURRENT_INDEX_BEFORE_prev"),i=(i-1+n.length)%n.length,console.log(i,"CURRENT_INDEX_prev"),showSlide(i)}),showSlide(0)}var xn=function(){var i=150,r="#000000ff",s="#ffffffff",l=/^#[0-9a-f]{6}$/i,d=/^#[0-9a-f]{6}$/i,c=/^#[0-9a-f]{8}$/i,u=/^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/i,p=/^rgba\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*(\d|\d\.\d+)\s*\)$/i;function normalizeColor(e){if(!e)return e;var t={red:0,green:0,blue:0,alpha:1};if(e=e.trim(),c.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2)),t.alpha=hexToDecimal(e.substr(7,2));else if(l.test(e))t.red=hexToDecimal(e.substr(1,2)),t.green=hexToDecimal(e.substr(3,2)),t.blue=hexToDecimal(e.substr(5,2));else if(d.test(e))t.red=hexToDecimal(e[1]+"{"+e[1]),t.green=hexToDecimal(e[2]+"{"+e[2]),t.blue=hexToDecimal(e[3]+"{"+e[3]);else if(p.test(e)){var n=replaceAll(e," ",""),a=(n=n.substring(n.indexOf("(")+1,n.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(a[0]),255),t.green=Math.min(parseInt(a[1]),255),t.blue=Math.min(parseInt(a[2]),255),t.alpha=Math.min(parseFloat(a[3]),1)}else if(u.test(e)){var o=replaceAll(e," ",""),i=(o=o.substring(o.indexOf("(")+1,o.lastIndexOf(")"))).split(",");t.red=Math.min(parseInt(i[0]),255),t.green=Math.min(parseInt(i[1]),255),t.blue=Math.min(parseInt(i[2]),255),t.alpha=1}else console.warn("color format unsupported: "+e),t=null;return t}function getPercievedBrightness(e){return e?Math.floor(Math.sqrt(.241*e.red*e.red+.691*e.green*e.green+.068*e.blue*e.blue)):0}function getColorInFullHex(e){if(!e)return e;return"#"+padString(decimalToHex(e.red),"0",2)+padString(decimalToHex(e.green),"0",2)+padString(decimalToHex(e.blue),"0",2)+padString(decimalToHex(e.alpha),"0",2)}function decimalToHex(e){return e.toString(16)}function hexToDecimal(e){return parseInt("0x"+e)}function replaceAll(e,t,n){if(e&&t)for(n||(n="");0<=e.indexOf(t);)e=e.replace(t,n);return e}function padString(e,t,n){return e&&t&&n&&(e=e.padStart(n,t[0])),e}function increase_brightness(e,t){3==(e=e.replace(/^\s*#|\s*$/g,"")).length&&(e=e.replace(/(.)/g,"$1$1"));var n=parseInt(e.substr(0,2),16),a=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),i="#"+padString((0|256+n+(256-n)*t/100).toString(16).substr(1),"0",2);return i+=padString((0|256+a+(256-a)*t/100).toString(16).substr(1),"0",2),i+=padString((0|256+o+(256-o)*t/100).toString(16).substr(1),"0",2)}return{getThemeSettings:function(e,t){var n=null,a=getColorInFullHex(normalizeColor(e));if(a){a=a.substr(0,7),(n={}).color=a;var o=getColorInFullHex(normalizeColor(t));n.backgroundColor=o?(o=o.substr(0,7))===a?(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",a):(n.colorFrom=a,n.colorTo=o,n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""):(n.colorFrom=increase_brightness(a,-30),n.colorTo=increase_brightness(a,30),n.backgroundGradient="linear-gradient(90deg,"+n.colorFrom+","+n.colorTo+")",n.backgroundGradientRev="linear-gradient(270deg,"+n.colorFrom+","+n.colorTo+")",""),n.percievedBrightness=getPercievedBrightness(normalizeColor(n.colorFrom)),n.percievedBrightness1=getPercievedBrightness(normalizeColor(n.color)),n.percievedBrightness2=getPercievedBrightness(normalizeColor(n.colorTo)),n.textColor=n.percievedBrightness<=i?s:r,n.buttonColor=(n.percievedBrightness,r),n.buttonBorderColor=(n.percievedBrightness,a),n.buttonBackgroundColor=(n.percievedBrightness,s),n.buttonColorHover=(n.percievedBrightness,s),n.buttonBackgroundColorHover=n.percievedBrightness<=i?a:"#525252"}return n},getTextColorForBackground:function(e){var t="#000000ff";if(!e)return t;var n=normalizeColor(e);return n&&getPercievedBrightness(n)<=150?"#ffffffff":t},setAlpha:function(e,t){if(!e||isNaN(t))return e;t=Math.floor(255*Math.min(Math.max(0,t),1));var n=normalizeColor(e);return n.alpha=t,getColorInFullHex(n)},normalizeColor:normalizeColor,getPercievedBrightness:getPercievedBrightness,BRIGHTNESS_THRESHOLD:i}}(),Mn={getFormDetailsFromCommand:function(e){var t,n,a,o;switch(e.Name){case x.APPOINTMENT_FORM.Trigger:a=(new Date).getTimezoneOffset(),o=Math.abs(a),i={title:"Select Appointment Date and Time UTC"+(a=(a<0?"+":"-")+("00"+Math.floor(o/60)).slice(-2)+":"+("00"+o%60).slice(-2)),description:"",fields:[{field:"Appointment Date",datatype:"datetime",errorMessage:"please select a valid date",isMandatory:!0,readonly:!0,image:"icon:calendar"},{field:"Appointment Time",datatype:"dropdown",errorMessage:"please select a valid time",isMandatory:!0,value:["10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM"],need:"Appointment Date",image:"icon:clock-o"}]},t=getFormSettings(e.Value);break;case x.CONTACT_FORM.Trigger:n=[{field:"Name",datatype:"text",placeholder:"Your Name",errorMessage:"please enter a valid name",isMandatory:!1,image:"icon:user"},{field:"Email",datatype:"email",placeholder:"Email Address",errorMessage:"please enter a valid email address",validationPattern:/^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\.)+))([a-zA-Z]{2,10}|[0-9]{1,5})(\]?)$/,isMandatory:!1,image:"icon:envelope"},{field:"Mobile",datatype:"tel",placeholder:"Mobile Number",errorMessage:"please enter a valid phone number",validationSource:k,isMandatory:!1,image:"icon:phone"}],i={title:getButtonsText("Contact Information"),description:getButtonsText("Please enter your contact details"),fields:n},t=getFormSettings(e.Value);break;case x.ADDRESS_FORM.Trigger:i={title:"Address Information",description:"Please enter your address details",fields:[{field:"Address Line 1",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!0},{field:"Address Line 2",datatype:"text",errorMessage:"please enter a valid address",isMandatory:!1},{field:"City",datatype:"text",errorMessage:"Please enter a valid City",isMandatory:!0,takeHalfRow:!0},{field:"State",datatype:"text",errorMessage:"please enter a valid State",isMandatory:!0,takeHalfRow:!0},{field:"Country",datatype:"text",errorMessage:"please enter a valid Country",isMandatory:!0,takeHalfRow:!0},{field:"Zip Code",datatype:"text",errorMessage:"Please enter a valid Zip Code",validationPattern:/^[1-9][0-9]{5}$/,isMandatory:!0,takeHalfRow:!0}],submit:"address form submission",submitType:"values"},t=getFormSettings(e.Value);break;case x.GENERIC_FORM.Trigger:var i;e.Value&&(i=JSON.parse(e.Value))&&(t=getFormSettings(i.settings))}return{template:i,setttings:t}},sanitizeFormTemplate:function(e){e&&e.fields&&e.fields.forEach(function(a){if(a.dataType&&(a.datatype=a.dataType),a.datatype)if("email"===a.datatype)a.validationPattern||(a.validationPattern=In.EMAIL_VALIIDATION_PATTERN);else if("tel"===a.datatype)a.validationSource||(a.validationPattern=In.PHONE_VALIDATION_SOURCE);else if("url"===a.datatype)a.validationSource||(a.validationPattern=In.URL_VALIIDATION_PATTERN,a.antiValidationPattern=In.EMAIL_VALIIDATION_PATTERN);else if("datetime"===a.datatype){if(a.datetimepickersettings){var t={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};Object.keys(t).forEach(function(e){a.datetimepickersettings[e]||(a.datetimepickersettings[e]=t[e])})}else a.datetimepickersettings={timepicker:!1,format:"d-M-Y",minDate:"-1970/01/1",maxDate:"+1970/06/1",scrollMonth:!1,scrollInput:!1};a.Slots&&(a.datetimepickersettings.beforeShowDay=function(e){var t=Kt.getDateKeys(e),n=!1;return t.every(function(e){return!a.Slots[e]||(n=0<a.Slots[e].length,!1)}),[n,""]}),a.readonly=!0,a.image="icon:calendar",a.afterAppend=function(){this.inputElementRef&&($(this.inputElementRef).datetimepicker(this.datetimepickersettings),this.inputContainer&&this.datetimepickersettings&&this.datetimepickersettings.inline&&this.inputContainer.classList.add("inline-datetime"))}}})},renderForm:renderForm,createInputRowFromField:function(t,n,e){n[t.field]&&(n[t.field].value&&(t.value=n[t.field].value),n[t.field].isMandatory&&(t.isMandatory=n[t.field].isMandatory),n[t.field].need&&(t.isMandatory=n[t.field].need),n[t.field].beforeShow&&(t.beforeShow=n[t.field].beforeShow),n[t.field].telSettings&&(t.telSettings?Object.keys(n[t.field].telSettings).forEach(function(e){t.telSettings[e]=n[t.field].telSettings[e]}):t.telSettings=n[t.field].telSettings),n[t.field].datetimepickersettings&&(t.datetimepickersettings?Object.keys(n[t.field].datetimepickersettings).forEach(function(e){t.datetimepickersettings[e]=n[t.field].datetimepickersettings[e]}):t.datetimepickersettings=n[t.field].datetimepickersettings),n[t.field].errorMessage&&(t.errorMessage=n[t.field].errorMessage),n[t.field].validationPattern&&(t.validationPattern=n[t.field].validationPattern),n[t.field].image&&(t.image=n[t.field].image),n[t.field].imageClass&&(t.imageClass=n[t.field].imageClass));var a=document.createElement("label"),o=document.createElement("input"),i=document.createElement("div");if(t.dataType&&(t.datatype=t.dataType),"dropdown"===t.datatype){t.options=t.options||t.value;var r=t.displayName||t.field;(o=createDropdownElement(t.options,r)).name=t.field}else o.type=t.datatype,t.placeholder?a.innerHTML=t.placeholder:a.textContent=t.displayName||t.field,o.placeholder=t.placeholder||t.displayName||t.field,o.placeholder=getButtonsText(o.placeholder),t.value&&(o.value=t.value);t.name&&(o.name=t.name),o.classList.add("form-control"),o.style.fontStyle="inherit",t.readonly&&o.setAttribute("readonly","readonly"),t.min&&(o.min=t.min),t.max&&(o.max=t.max),i.classList.add("invalid-feedback","d-none"),i.textContent=t.errorMessage;var s=void 0,l=void 0;if(t.image){var d=createIconElement(t.image);if(d){var c="icon-container";t.imageClass&&(c=c+","+t.imageClass),l=genericContainer(["input-container"],genericContainer(c=c.split(","),d),o)}}if(l||(l=genericContainer([],o)),"checkbox"===t.datatype?(o.name=t.field,o.classList.remove("form-control"),equalsIgnoreCase(t.value,"true")&&(o.checked=!0),(s=columnContainer([],l,a,i)).classList.add("checkbox"),i.style.display="block"):s=t.useLabel?columnContainer([],a,l,i):columnContainer([],l,i),n&&n.Mandatory&&n.Mandatory.includes(t.field)&&(t.isMandatory=!0),"tel"===t.datatype&&t.validationSource===k){var u="IN";n&&n.CountryCode&&(u=n.CountryCode);var p={geoIpLookup:function(e){e(u)},hiddenInput:"full_number",initialCountry:"auto",placeholderNumberType:"MOBILE",preferredCountries:["in","us"],separateDialCode:!0,utilsScript:L};t.telSettings&&Object.keys(t.telSettings).forEach(function(e){p[e]=t.telSettings[e]}),o.value||(o.setAttribute("type","number"),o.setAttribute("onkeydown","javascript: return event.keyCode == 69 ? false : true"));var m=window.intlTelInput(o,p);o.style.paddingLeft="85px",i.style.display="block",t.pluginObj=m}return o.addEventListener("change",handleFormInputChange),{colEle:s,inputElementRef:o,inputContainer:l,feedbackElementRef:i}},handleFormValues:handleFormValues};function kenytCreateForm(n,r,t,e){var a=n.tag||"div",s=document.createElement(a);s.classList.add("form");var o=document.createElement("span"),i=document.createElement("p");o.classList.add("h6","font-weight-bold"),i.classList.add("m-0"),o.textContent=null!=r.Title?r.Title:n.title,i.textContent=null!=r.Description?r.Description:n.description,s.appendChild(rowContainer(["mt-1"],columnContainer(["text-center"],o,i)));var l=void 0;n.fields.forEach(function(i){var e=Mn.createInputRowFromField(i,r),a=e.colEle;if(a){if(i.inputElementRef=e.inputElementRef,i.inputContainer=e.inputContainer,i.feedbackElementRef=e.feedbackElementRef,i.takeHalfRow&&a.classList.add("col-6"),l)l.appendChild(a),s.appendChild(l),l=null;else{var t=rowContainer(["mt-2"],a);s.appendChild(t),i.takeHalfRow&&(l=t)}if(i.need&&n.fields.forEach(function(o){if(i.need===o.field&&o&&o.inputElementRef){if("datetime"===o.datatype){!i.beforeShow&&o.Slots&&(i.beforeShow=function(e){var n=this,t=Kt.getDateKeys(e),a=i.value;t.every(function(e){return!o.Slots[e]||(a=o.Slots[e],!1)}),a||(a="10 AM, 11 AM, 12 PM, 1 PM, 2 PM, 3 PM, 4 PM, 5 PM, 6 PM, 7 PM, 8 PM"),this.inputElementRef.innerHTML="",a.forEach||(a=a.split(",")),a.forEach(function(e){var t=document.createElement("option");t.innerText=e,t.value=e,n.inputElementRef.appendChild(t)})});var t=o.datetimepickersettings.onChangeDateTime;o.datetimepickersettings.onChangeDateTime=function(e){t&&t(e),i.beforeShow&&i.beforeShow(e),kenytShowElements(i.inputContainer),scrollToEnd(z)}}else o.inputElementRef.addEventListener("change",function(){kenytShowElements(i.inputContainer),scrollToEnd(z)},!1);hideElements(i.inputContainer)}}),i.addMore){i.extraInputs=i.extraInputs||[];var o=document.createElement("button");o.textContent=" + ",o.classList.add("btn","primary-button","add-more-btn"),o.addEventListener("click",function(e){e.preventDefault();var t=createInputRowFromField(i,r),n=rowContainer(["mt-2"],t.colEle);a.parentNode.parentNode.insertBefore(n,a.parentNode.nextSibling),i.extraInputs.push({inputElementRef:t.inputElementRef,feedbackElementRef:t.feedbackElementRef}),4==i.extraInputs.length&&hideElements(o)}),a.appendChild(o)}}});var d=document.createElement("button");d.textContent="Cancel",d.classList.add("btn","btn-secondary"),e&&d.addEventListener("click",function(){e()});var c=document.createElement("button");return c.textContent=" "+getButtonsText("Submit")+" ",c.classList.add("btn","primary-button"),e||c.classList.add("mr-2"),n.onSubmit?s.onsubmit=n.onSubmit:t&&c.addEventListener("click",function(e){t(e,n.fields,n.submit,n.submitType)}),e?s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],c,d))):s.appendChild(rowContainer(["mt-2"],columnContainer(["text-center"],c))),s}function kenytShowElements(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(e){e&&e.classList.contains("d-none")&&e.classList.remove("d-none")})}function kenytOverrideIframeWindowForPortal(){document.getElementById("chatWindow").classList.add("k-hide")}function capitalizeInitialCharacter(e){return e.split(" ").map(function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}).join(" ")}function addSpacesBetweenCapitals(e){return e.replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z])([a-z])/g,"$1 $2$3")}